"use strict";(self.webpackChunkpmw=self.webpackChunkpmw||[]).push([[3052],{37673:(e,t,i)=>{i.d(t,{x:()=>l});var s=i(37785),n=i(94275),a=i(20881);let o,r=$.noop,c=!1;const l=async e=>{r=e,(0,s.QP)("loadingDropbox");try{o=await PMW.readLocal("dropbox/getAppKey"),await d(),h()}catch(e){console.error(e),PMW.openErrorModal({message:i18next.t("pmwjs_general_ajax_error")})}finally{(0,s.Zk)("loadingDropbox")}},d=()=>{if(!c)return new Promise((function(e,t){let i=document.createElement("script");i.setAttribute("type","text/javascript"),i.setAttribute("id","dropboxjs"),i.setAttribute("data-app-key",o),i.onload=()=>{c=!0,e()},i.onerror=t,i.setAttribute("src","https://www.dropbox.com/static/api/2/dropins.js"),document.getElementsByTagName("head")[0].appendChild(i)}))},h=()=>{Dropbox.choose({success:u,linkType:"direct",multiselect:!0,extensions:[".jpg",".jpeg",".png",".gif"]})},u=async e=>{let t=!1;(0,s.QP)("uploadingDropboxItems");for(let i=0;i<e.length;i++)try{let t=await PMW.writeLocal("posterimage/importDropboxPhoto",{userId:(0,n.n5)(),url:e[i].link});r([(0,a.Y)(t)])}catch(e){console.error(e),t=!0}t&&PMW.openErrorModal({message:i18next.t("pmwjs_general_ajax_error")}),(0,s.Zk)("uploadingDropboxItems")}},27769:(e,t,i)=>{i.d(t,{v:()=>u});var s=i(37785),n=i(94275),a=i(20881);let o,r,c,l=null,d=!1,h=$.noop;const u=async e=>{h=e,await p()},p=async()=>{await f(),g()},g=()=>{PMW.google.loadAccountsAPI(E)},E=()=>{PMW.google.loadFeaturesAPI(v)},f=async()=>{try{if(!r||!c){let e=await PMW.readLocal("google/getCredentials");r=e.clientId,c=e.apiKey}}catch(e){console.error(e),PMW.openErrorModal({message:i18next.t("pmwjs_general_ajax_error")})}},v=()=>{"undefined"!=typeof google?m():PMW.google.onError()},m=()=>{try{google.accounts.oauth2.initTokenClient({client_id:r,scope:"https://www.googleapis.com/auth/drive.readonly",callback:O}).requestAccessToken()}catch(e){PMW.google.onError()}},O=e=>{e&&e.access_token&&(o=e.access_token,I()),"undefined"!=typeof gapi?gapi.load("picker",{callback:b}):PMW.google.onError()},b=()=>{d=!0,!l&&o&&I()},I=()=>{if(d&&o){let e="image/jpeg,image/png,image/gif",t={width:window.innerWidth>1051?1051:window.innerWidth-40,height:window.innerHeight>650?650:window.innerHeight-40},i=PMW.util.getLanguage(),s=(new google.picker.DocsView).setIncludeFolders(!0).setOwnedByMe(!0).setMimeTypes(e),n=(new google.picker.DocsView).setIncludeFolders(!0).setOwnedByMe(!1).setMimeTypes(e),a=new google.picker.DocsView(google.picker.ViewId.RECENTLY_PICKED);l=(new google.picker.PickerBuilder).enableFeature(google.picker.Feature.MULTISELECT_ENABLED).addView(s).addView(n).addView(a).setLocale(i).setSize(t.width,t.height).setTitle(i18next.t("pmwjs_select_a_photo")).setLocale(PMW.util.getLanguage()).setOAuthToken(o).setDeveloperKey(c).setSelectableMimeTypes(e).setCallback(A).build(),w()}},w=()=>{l&&l.setVisible(!0)},A=async e=>{if(e.action===google.picker.Action.PICKED){let t=e[google.picker.Response.DOCUMENTS],i=!1;(0,s.QP)("uploadGoogleDriveItems");for(let e=0;e<t.length;e++)try{let i=await PMW.writeLocal("posterimage/importGoogleDrivePhoto",{userId:(0,n.n5)(),id:t[e].id,lastEdited:t[e].lastEditedUtc,oauthToken:o});h([(0,a.Y)(i)])}catch(e){console.error(e),i=!0}i&&PMW.openErrorModal({message:i18next.t("pmwjs_general_ajax_error")}),(0,s.Zk)("uploadGoogleDriveItems")}}},15224:(e,t,i)=>{i.d(t,{Z:()=>s});const s={"-large":"DRyL0Rdn2PjELSQHBS7J",icon:"mwviKjRRUV0CrIOFxT4D",replacePopupWidth:"UIOgCum4vXDxEZgZoB3j",replacePopupWidthSmall:"Bs2CyqvrjLVq7s5TzsHa"}},4289:(e,t,i)=>{i.d(t,{f:()=>s.f,v:()=>s.v});var s=i(9473)},56634:(e,t,i)=>{i.d(t,{l:()=>s.l});var s=i(91138)},40714:(e,t,i)=>{i.d(t,{j:()=>s.j});var s=i(82767)},73682:(e,t,i)=>{var s;i.d(t,{l:()=>s}),function(e){e.FONT="font",e.STYLE="style"}(s||(s={}))},8663:(e,t,i)=>{i.d(t,{T:()=>s.T});var s=i(99139)},48538:(e,t,i)=>{i.d(t,{E:()=>s.E});var s=i(6742)},33827:(e,t,i)=>{i.d(t,{R:()=>s.R});var s=i(35108)},95600:(e,t,i)=>{i.d(t,{E:()=>s.E});var s=i(80407)},14705:(e,t,i)=>{i.d(t,{M:()=>s.M,S:()=>s.S});var s=i(62908)},98612:(e,t,i)=>{i.d(t,{A:()=>s.A,O:()=>s.O});var s=i(13522)},36239:(e,t,i)=>{i.d(t,{t:()=>s.t});var s=i(6065)},926:(e,t,i)=>{i.d(t,{Z:()=>s.Z});var s=i(43806)},15691:(e,t,i)=>{i.d(t,{a:()=>a});var s=i(55461),n=i(36131);function a(){var e,t;const i=(0,n.C)(s.KZ),a=i?null===(t=null===(e=window.posterEditor)||void 0===e?void 0:e.whiteboard)||void 0===t?void 0:t.getItemForId(i.uid):null;return a&&a.isSlideshow()?a.getSelectedSlide():null}},54143:(e,t,i)=>{i.d(t,{d:()=>a});var s=i(55461),n=i(36131);function a(){var e,t;const i=(0,n.C)(s.KZ);return(i?null===(t=null===(e=window.posterEditor)||void 0===e?void 0:e.whiteboard)||void 0===t?void 0:t.getItemForId(i.uid):null)||null}},95421:(e,t,i)=>{var s;i.d(t,{H:()=>s}),function(e){e.DEFAULT="all",e.POSTER_EDITOR="PosterEditor",e.ITEM_SHAPE_MASKING="ItemShapeMasking",e.ITEM_TEXT_MASKING="ItemTextMasking",e.ITEM_POINT_MASKING="ItemPointMasking"}(s||(s={}))},79441:(e,t,i)=>{i.d(t,{T:()=>a});var s=i(70401),n=i.n(s);const a=(e,t={})=>{return i=void 0,s=void 0,r=function*(){const i={currentUrl:window.location.href,data:{error:e instanceof Error?e.message:e,addiontionalData:t}};e instanceof Error&&(i.stack=o(yield n().fromError(e))),console.error(i),yield window.PMW.writeLocal("logerror/logClientJson",i)},new((a=void 0)||(a=Promise))((function(e,t){function n(e){try{c(r.next(e))}catch(e){t(e)}}function o(e){try{c(r.throw(e))}catch(e){t(e)}}function c(t){var i;t.done?e(t.value):(i=t.value,i instanceof a?i:new a((function(e){e(i)}))).then(n,o)}c((r=r.apply(i,s||[])).next())}));var i,s,a,r},o=e=>e.map((e=>e.toString()))},63767:(e,t,i)=>{i.d(t,{t:()=>c});var s=i(18515);const n=["up","down","left","right","shift+up","shift+down","shift+left","shift+right","up+left","left+up","up+right","right+up","down+right","right+down","down+left","left+down"];let a=Date.now(),o=!1,r=Date.now();const c=(e,t,i)=>{(0,s.Z)(n.join(","),{scope:e,keydown:!0,keyup:!1},(e=>{e.preventDefault(),t(d())})),(0,s.Z)(n.join(","),{scope:e,keydown:!1,keyup:!0},(()=>{l(),i&&i()}))},l=()=>{r=Date.now(),o&&(o=!1)},d=()=>{const e=Date.now();e-a>=500&&(a=Date.now(),setTimeout((()=>{e>r&&(o=!0)}),500));const t=h();let i=0,n=0;return s.Z.isPressed("up")&&(n-=t),s.Z.isPressed("down")&&(n+=t),s.Z.isPressed("left")&&(i-=t),s.Z.isPressed("right")&&(i+=t),{x:i,y:n}},h=()=>s.Z.isPressed("shift")?10:o?5:1},40982:(e,t,i)=>{if(i.d(t,{AE:()=>g,Gr:()=>n,Nj:()=>E,TD:()=>a,W6:()=>p,d:()=>d,fw:()=>u,pd:()=>f,ru:()=>o}),/^(2046|330|4840)$/.test(i.j))var s=i(81679);var n,a,o,r,c,l,d,h=i(99048);!function(e){e.LOWER="lower",e.LOW="low",e.MEDIUM="medium",e.HIGH="high",e.HIGHER="higher"}(n||(n={})),function(e){e.LEFT="left",e.RIGHT="right"}(a||(a={})),function(e){e.NONE="none",e.FADE="fade",e.BLOCK="block",e.SLIDE="slide",e.RISE="rise",e.PAN="pan",e.POP="pop",e.TUMBLE="tumble",e.JELLO="jello",e.ROTATE="rotate",e.ZOOM_IN="zoom_in",e.ZOOM_OUT="zoom_out",e.BOUNCE_IN_DOWN="bounce_in_down",e.WIPE_DOWN="wipe_down",e.WIPE_UP="wipe_up",e.WIPE_LEFT="wipe_left",e.WIPE_RIGHT="wipe_right",e.PEEK_DOWN="peek_down",e.PEEK_UP="peek_up",e.PEEK_LEFT="peek_left",e.PEEK_RIGHT="peek_right",e.SHRINK="shrink",e.EXPAND="expand",e.PAN_LEFT="pan_left",e.PAN_RIGHT="pan_right",e.PAN_UP="pan_up",e.PAN_DOWN="pan_down"}(o||(o={})),function(e){e[e.LOWER=2.5]="LOWER",e[e.LOW=1.7]="LOW",e[e.MEDIUM=1]="MEDIUM",e[e.HIGH=.5]="HIGH",e[e.HIGHER=.2]="HIGHER"}(r||(r={})),function(e){e[e.LOWER=2.7]="LOWER",e[e.LOW=2.2]="LOW",e[e.MEDIUM=1.7]="MEDIUM",e[e.HIGH=1]="HIGH",e[e.HIGHER=.3]="HIGHER"}(c||(c={})),function(e){e[e.LOWER=1.2]="LOWER",e[e.LOW=.95]="LOW",e[e.MEDIUM=.7]="MEDIUM",e[e.HIGH=.45]="HIGH",e[e.HIGHER=.2]="HIGHER"}(l||(l={})),function(e){e.LEFT="LEFT",e.RIGHT="right",e.TOP="top",e.BOTTOM="bottom",e.TOP_LEFT="top-left",e.TOP_RIGHT="top-right",e.BOTTOM_LEFT="bottom-left",e.BOTTOM_RIGHT="bottom-right"}(d||(d={}));class u extends(/^(2046|330|4840)$/.test(i.j)?s.v:null){static create(e){return new u(e)}constructor(e={}){super(),this.type=o.NONE,this.slideType=a.LEFT,this.speed=n.MEDIUM,this.copyVals(e)}getDuration(){if(this.type===o.FADE)switch(this.speed){case n.LOWER:return c.LOWER;case n.LOW:return c.LOW;case n.MEDIUM:return c.MEDIUM;case n.HIGH:return c.HIGH;case n.HIGHER:return c.HIGHER;default:return 0}else if(this.hasSequentialDesignAnimationEffect())switch(this.speed){case n.LOWER:return l.LOWER;case n.LOW:return l.LOW;case n.MEDIUM:return l.MEDIUM;case n.HIGH:return l.HIGH;case n.HIGHER:return l.HIGHER;default:return 0}else switch(this.speed){case n.LOWER:return r.LOWER;case n.LOW:return r.LOW;case n.MEDIUM:return r.MEDIUM;case n.HIGH:return r.HIGH;case n.HIGHER:return r.HIGHER;default:return 0}}getMaxItemAnimationDelay(){const e=this.getDuration();return this.hasSequentialDesignAnimationEffect()?e*h.z5*h.CN:h.iU*e}hasAnimation(){return p(this.type)}hasSequentialDesignAnimationEffect(){return this.type===o.BLOCK||this.type===o.POP||this.type===o.TUMBLE||this.type===o.JELLO||this.type===o.ROTATE||this.type===o.PAN}toObject(){return{type:this.type,slideType:this.slideType,speed:this.speed}}updateFromObject(e){this.copyVals(e)}}const p=e=>e!==o.NONE,g=e=>e===o.WIPE_DOWN||e===o.WIPE_UP||e===o.WIPE_LEFT||e===o.WIPE_RIGHT||e===o.PEEK_DOWN||e===o.PEEK_UP||e===o.PEEK_LEFT||e===o.PEEK_RIGHT,E=e=>e===o.BLOCK,f=e=>{switch(e){case o.SLIDE:case o.RISE:case o.PAN:case o.PAN_RIGHT:case o.PAN_LEFT:case o.PAN_DOWN:case o.PAN_UP:case o.SHRINK:case o.EXPAND:case o.TUMBLE:case o.ROTATE:return window.fabric.util.ease.easeOutCubic;case o.BLOCK:return window.fabric.util.ease.easeInOutQuint;case o.FADE:return window.fabric.util.ease.easeOutQuad;case o.POP:case o.JELLO:return window.fabric.util.ease.easeOutElastic;case o.BOUNCE_IN_DOWN:case o.ZOOM_IN:case o.ZOOM_OUT:return window.fabric.util.ease.easeOutBack;case o.WIPE_DOWN:case o.WIPE_UP:case o.WIPE_LEFT:case o.WIPE_RIGHT:case o.PEEK_DOWN:case o.PEEK_UP:case o.PEEK_LEFT:case o.PEEK_RIGHT:return window.fabric.util.ease.easeOutSine;case o.NONE:return window.fabric.util.ease.easeOutCubic;default:return console.error("Unknown animation type: ",e),window.fabric.util.ease.easeOutCubic}}},49432:(e,t,i)=>{if(i.d(t,{Cs:()=>n,FZ:()=>d,Gn:()=>l,aC:()=>c,n6:()=>o,v5:()=>a}),/^(2046|330|4840)$/.test(i.j))var s=i(81679);var n,a,o,r=i(67055);!function(e){e[e.NONE=0]="NONE",e[e.UNORDERED=1]="UNORDERED",e[e.ORDERED=2]="ORDERED"}(n||(n={})),function(e){e[e.NUMBERED_DECIMAL=1]="NUMBERED_DECIMAL",e[e.NUMBERED=2]="NUMBERED",e[e.ALPHA_UPPER=3]="ALPHA_UPPER",e[e.ALPHA_LOWER=4]="ALPHA_LOWER",e[e.ROMAN_UPPER=5]="ROMAN_UPPER",e[e.ROMAN_LOWER=6]="ROMAN_LOWER"}(a||(a={})),function(e){e[e.CIRCLE_1=1]="CIRCLE_1",e[e.CIRCLE_2=2]="CIRCLE_2",e[e.CIRCLE_3=3]="CIRCLE_3",e[e.SQUARE_1=4]="SQUARE_1",e[e.SQUARE_2=5]="SQUARE_2",e[e.SQUARE_3=6]="SQUARE_3",e[e.SQUARE_4=7]="SQUARE_4",e[e.ARROW_1=8]="ARROW_1",e[e.ARROW_2=9]="ARROW_2",e[e.ARROW_3=10]="ARROW_3",e[e.TICK_1=11]="TICK_1",e[e.TICK_2=12]="TICK_2",e[e.AESTERISK=13]="AESTERISK",e[e.LEAF=14]="LEAF",e[e.FLOWER=15]="FLOWER",e[e.EDIT=16]="EDIT",e[e.STAR=17]="STAR"}(o||(o={}));const c=new Map([[o.CIRCLE_1,"41"],[o.CIRCLE_3,"42"],[o.CIRCLE_2,"43"],[o.AESTERISK,"44"],[o.LEAF,"45"],[o.ARROW_1,"46"],[o.ARROW_3,"47"],[o.ARROW_2,"48"],[o.EDIT,"49"],[o.FLOWER,"4A"],[o.SQUARE_1,"4B"],[o.SQUARE_2,"4C"],[o.SQUARE_3,"4D"],[o.SQUARE_4,"4E"],[o.STAR,"4F"],[o.TICK_1,"50"],[o.TICK_2,"51"]]);class l extends(/^(2046|330|4840)$/.test(i.j)?s.v:null){constructor(e){super(),this.type=n.NONE,this.style=a.NUMBERED_DECIMAL,this.width=0,this.fill=new r.de,this.copyVals(e)}copyVals(e={}){const{fill:t}=e,i=function(e,t){var i={};for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&t.indexOf(s)<0&&(i[s]=e[s]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var n=0;for(s=Object.getOwnPropertySymbols(e);n<s.length;n++)t.indexOf(s[n])<0&&Object.prototype.propertyIsEnumerable.call(e,s[n])&&(i[s[n]]=e[s[n]])}return i}(e,["fill"]);super.copyVals(i),this.fill.copyVals(t)}toObject(){return{type:this.type,style:this.style,width:this.width,fill:this.fill.toObject()}}hasSolidBulletFill(){return this.fill.fillType===r.fz.SOLID}hasLinearGradientBulletFill(){return this.fill.fillType===r.fz.LINEAR_GRADIENT}hasRadialGradientBulletFill(){return this.fill.fillType===r.fz.RADIAL_GRADIENT}hasGradientBulletFill(){return this.hasLinearGradientBulletFill()||this.hasRadialGradientBulletFill()}isOrdered(){return this.type===n.ORDERED}isUnordered(){return this.type===n.UNORDERED}hasList(){return this.type!==n.NONE}getDefaultListStyleFromType(){return this.isOrdered()?a.NUMBERED_DECIMAL:o.CIRCLE_1}getDefaultStyleForType(e){return e===n.ORDERED?a.NUMBERED_DECIMAL:o.CIRCLE_1}}const d=()=>{return e=void 0,t=void 0,s=function*(){const e=yield navigator.clipboard.read();for(const t of e)if(t.types.includes("text/html")){const e=yield t.getType("text/html"),i=yield e.text();if(i.includes("<ol")&&i.includes("<li"))return n.ORDERED;if(i.includes("<ul")&&i.includes("<li"))return n.UNORDERED}return n.NONE},new((i=void 0)||(i=Promise))((function(n,a){function o(e){try{c(s.next(e))}catch(e){a(e)}}function r(e){try{c(s.throw(e))}catch(e){a(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(o,r)}c((s=s.apply(e,t||[])).next())}));var e,t,i,s}},98249:(e,t,i)=>{i.d(t,{T:()=>L});var s=i(29311);if(/^(2046|330|4840)$/.test(i.j))var n=i(28721);var a=i(27254),o=i(71721),r=i(72680),c=i(56566),l=i(99048),d=i(59632);if(/^(2046|330|4840)$/.test(i.j))var h=i(58343);if(/^(2046|330|4840)$/.test(i.j))var u=i(64611);if(/^(2046|330|4840)$/.test(i.j))var p=i(72179);if(/^(2046|330|4840)$/.test(i.j))var g=i(74834);var E=i(70986),f=i(30147),v=i(71038),m=i(14173),O=i(91171),b=i(98577),I=i(81189),w=i(20656),A=i(51430),R=i(91048),P=i(82555),C=i(89091),_=i(85518),T=i(37526),D=i(55461),y=i(13572),M=(i(50840),function(e,t,i,s){return new(i||(i=Promise))((function(n,a){function o(e){try{c(s.next(e))}catch(e){a(e)}}function r(e){try{c(s.throw(e))}catch(e){a(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(o,r)}c((s=s.apply(e,t||[])).next())}))});const S={hoverCursor:"pointer",selection:!0,uniScaleKey:void 0,controlsAboveOverlay:!0,preserveObjectStacking:!0,allowTouchScrolling:!0,stopContextMenu:!0};class L extends(/^(2046|330|4840)$/.test(i.j)?c.M:null){constructor(e,t){super(),this.hashedID="",this.duration=0,this.initRenderOnEachFrame=()=>{if(!this.poster.mode.isGeneration()){const e=()=>{this.isVideo()&&this.poster.isPlaying()?(this.fabricCanvas.renderAll(),window.fabric.util.requestAnimFrame(e)):setTimeout((()=>{window.fabric.util.requestAnimFrame(e)}),100)};window.fabric.util.requestAnimFrame(e)}},this.getFabricCanvas=()=>this.poster.mode.isGeneration()?new window.fabric.StaticCanvas(this.getHTMLCanvas(),{renderOnAddRemove:!1}):new window.fabric.Canvas(this.getHTMLCanvas(),S),this.selectAllUnlockedItems=()=>{var e,t;const i=null===(e=this.fabricCanvas)||void 0===e?void 0:e.getObjects();if(!i||0===i.length)return;if(null===(t=this.activeSelection)||void 0===t||t.clearSelection(),1===i.length){const e=i[0],t=this.items.getItem(e.__PMWID);return void(t&&!t.isLocked()&&this.activeSelection.setActiveObject(e))}const s=[];for(const e of i){const t=this.items.getItem(e.__PMWID);t&&!t.isLocked()&&s.push(e)}const n=new window.fabric.ActiveSelection(s,{canvas:this.fabricCanvas});this.activeSelection.discardActiveObject(),this.activeSelection.setActiveObject(n),this.fabricCanvas.requestRenderAll()},this.selectAllItems=()=>{var e,t;const i=null===(e=this.fabricCanvas)||void 0===e?void 0:e.getObjects();if(!i||0===i.length)return;if(null===(t=this.activeSelection)||void 0===t||t.clearSelection(),1===i.length)return void this.activeSelection.setActiveObject(i[0]);const s=[];for(const e of i)this.items.getItem(e.__PMWID)&&s.push(e);const n=new window.fabric.ActiveSelection(s,{canvas:this.fabricCanvas});this.activeSelection.discardActiveObject(),this.activeSelection.setActiveObject(n),this.fabricCanvas.requestRenderAll()},this.poster=e,this.hashedID=null!=t?t:(0,n.Z)(),this.background=new r.q(this),this.introAnimation=new l.tu(this),this.items=new o.F(this),this.activeSelection=new m.r(this),this.addCanvasToPoster(),this.itemBordersOnHovering=new d.E(this),this.renderAlignmentGuidelines=new g.j(this),this.renderBleed=new u.I(this),this.renderGrid=new p.v(this),this.renderFold=new E.F(this),this.pageWatermark=new P.Z(this),this.pageSnapshot=new A.G(this),this.pageSVG=new R.M(this),this.fabricCanvas instanceof window.fabric.Canvas&&(0,h.i)(this.fabricCanvas),this.spellCheck=new f.L(this),this.clipboard=new I.j(this),y.Z.on(y.F.USER_LOGGED_IN,this.onUserLoggedIn.bind(this))}applyScale(){if(this.poster.hasFakeScrollbars()){const e=window.document.getElementById("poster-whiteboard-container");if(!e)return;const t=this.poster.width*this.poster.scaling.scale,i=this.poster.height*this.poster.scaling.scale,s=t<e.clientWidth?t:e.clientWidth,n=i<e.clientHeight?i:e.clientHeight;this.fabricCanvas.setDimensions({width:s,height:n})}else this.fabricCanvas.setDimensions({width:this.poster.width*this.poster.scaling.scale,height:this.poster.height*this.poster.scaling.scale});this.fabricCanvas.setZoom(this.poster.scaling.scale)}addItem(e,{updateRedux:t=!0,undoable:i=!0,zIndex:s,checkForDurationUpdate:n=!1}={}){e.page=this,this.items.addItem(e),e.onItemAddedToPage(),void 0!==s?this.fabricCanvas.insertAt(s,e.fabricObject):this.fabricCanvas.add(e.fabricObject),this.poster.mode.isGeneration()||this.fabricCanvas.requestRenderAll(),n&&this.checkForPageDurationUpdate(e),i&&this.poster.history.add(),t&&this.poster.redux.updateReduxData()}onUserLoggedIn(){this.pageWatermark.refreshWatermark()}checkForPageDurationUpdate(e){(e.isMotionItem()||e.isSlideshow()&&e.isStreamingItem())&&this.calculateAndUpdatePageDuration()}getNonScaledCanvasScaleddWidth(){return this.fabricCanvas.width/this.fabricCanvas.getZoom()}getNonScaledCanvasScaleddHeight(){return this.fabricCanvas.height/this.fabricCanvas.getZoom()}calculateAndUpdatePageDuration(){this.updateFromObject({duration:(0,a.nG)(this)},{updateRedux:!1,undoable:!1})}isExpensiveVideo(){return this.items.hasVideoItem()||this.items.hasVideoContainingSlideshowItem()}getItemAtTop(){const e=this.fabricCanvas.getObjects();for(let t=e.length-1;t>=0;t--)if(e[t].__PMWID)return this.items.getItem(e[t].__PMWID)}getPageOrder(){return this.poster.pages.getPageOrder(this.hashedID)}getItemAtBottom(){const e=this.fabricCanvas.getObjects();for(let t=0;t<e.length;t++)if(e[t].__PMWID)return this.items.getItem(e[t].__PMWID)}getDuration(){return this.duration}onMouseDown(e){this.poster.audioPlaylist.unselectAudioPlaylist(),this.poster.mode.isWebpage()&&this.openClickableLinkOnItem(e)}openClickableLinkOnItem(e){if(e.target){const t=this.items.getItemForFabricObject(e.target);t&&t.hasClickableLink()&&(0,T.a0)(t.clickableLink,!1,!1)}}getItemLinksMap(){const e={};for(const[,t]of Object.entries(this.items.itemsHashMap))t.hasClickableLink()&&(e[t.uid]=t.clickableLink);return e}onSelectionCreated(e){var t;(null===(t=e.e)||void 0===t?void 0:t.type)!==s.p&&(this.activeSelection.onSelectionCreated(),this.poster.audioPlaylist.unselectAudioPlaylist(),this.poster.redux.updateSelectedItemsInRedux())}onSelectionCleared(e){var t;(null===(t=e.e)||void 0===t?void 0:t.type)!==s.p&&this.poster.redux.updateSelectedItemsInRedux()}onContextMenuStopped(e){this.selectTargetItem(e.target),this.openContextualMenu(e)}openContextualMenu(e){const{scale:t}=this.poster.scaling;window.PMW.redux.store.dispatch((0,v.D)({openPosterPopUpMenu:!0,popUpPosition:{top:e.e.pageY,left:e.e.pageX},target:e.target,eventCanvasOffset:{top:e.e.offsetY/t,left:e.e.offsetX/t}}))}openTouchContextualMenu(e){if("mouse"===e.pointerType)return;const t=this.activeSelection.getActiveObject();if(_.tq&&1===this.activeSelection.getActiveObjects().length&&t instanceof window.fabric.Textbox&&t.isEditing)(0,C.SF)(t);else{const{scale:t}=this.poster.scaling;window.PMW.redux.store.dispatch((0,v.D)({openPosterPopUpMenu:!0,popUpPosition:{top:e.srcEvent.pageY,left:e.srcEvent.pageX},target:this.activeSelection.getActiveObject(),eventCanvasOffset:{top:e.srcEvent.offsetY/t,left:e.srcEvent.offsetX/t}}))}}selectTargetItem(e){e&&this.activeSelection.getActiveObjects().length<2&&this.activeSelection.setActiveObject(e)}addCanvasToPoster(){const e=`<div class="pmw-page-container js-canvas" data-id="${this.hashedID}">\n                    <div class="pmw-pre-page-container"></div>\n                    <canvas width="${this.poster.width}" height="${this.poster.height}"/>\n                    <div class="pmw-post-page-container"></div>\n                  </div>`;this.poster.HTMLElement.insertAdjacentHTML("beforeend",e),this.fabricCanvas=this.getFabricCanvas(),this.fabricCanvas.on("selection:updated",this.onSelectionCreated.bind(this)),this.fabricCanvas.on("selection:created",this.onSelectionCreated.bind(this)),this.fabricCanvas.on("mouse:down",this.onMouseDown.bind(this)),this.fabricCanvas.on("selection:cleared",this.onSelectionCleared.bind(this)),this.fabricCanvas.on("contextMenuStopped",this.onContextMenuStopped.bind(this)),this.fabricCanvas.on("path:created",this.poster.drawing.onPathDrawn.bind(this.poster.drawing)),this.fabricCanvas.on("erasing:end",this.poster.drawing.onErasingEnd.bind(this.poster.drawing)),this.fabricCanvas.on("object:modified",this.activeSelection.onViewModified.bind(this.activeSelection)),this.fabricCanvas.on("object:scaling",this.activeSelection.onObjectScaling.bind(this.activeSelection)),this.fabricCanvas.on("fabricTouchStartStopped",this.onFabricTouchStartStoppedEvent.bind(this)),_.tq&&this.fabricCanvas.on("touch:dbltap",this.onCanvasDoubleTap.bind(this)),this.initCanvasLongPressEvent(),this.initRenderOnEachFrame(),this.applyScale()}onCanvasDoubleTap(){return M(this,void 0,void 0,(function*(){const e=this.getSelectedItems();1===e.length&&(e[0].isText()||e[0].isSlideshow()&&e[0].getSelectedSlide().isTextSlide())||window.PMW.redux.store.dispatch((0,D.Rl)(!0))}))}onFabricTouchStartStoppedEvent(){this.poster.fire(w.ul.FABRIC_CANVAS_TOUCH_START_DETECTED)}initCanvasLongPressEvent(){if(this.fabricCanvas instanceof window.fabric.Canvas){const e=new Hammer.Manager(this.fabricCanvas.upperCanvasEl),t=new Hammer.Press({event:"longpress",time:1e3});e.add(t),e.on("longpress",this.openTouchContextualMenu.bind(this))}}static getHTMLContainerForPageId(e){return $(`.pmw-page-container[data-id=${e}]`).get(0)}static getFirstCanvasContainerHTML(){return $(".pmw-page-container:first .canvas-container").get(0)}static getCanvasContainerHTMLForPageId(e){return $(`.pmw-page-container[data-id=${e}] .canvas-container`).get(0)}static getPrePageHTMLContainerForPageId(e){return $(`.pmw-page-container[data-id=${e}] .pmw-pre-page-container`).get(0)}getHTMLCanvas(){const e=$(`.pmw-page-container[data-id=${this.hashedID}] canvas`).get(0);if(!e)throw new Error("Canvas not found");return e}getHTMLContainer(){return L.getHTMLContainerForPageId(this.hashedID)}toObject(){return{hashedID:this.hashedID,items:this.items.toObject(),background:this.background.toObject(),introAnimation:this.introAnimation.toObject(),duration:this.duration}}updateFromObject(e={},{updateRedux:t=!0,undoable:i=!0,refreshActiveSelection:s=!1,checkForDurationUpdate:n=!1}={}){return M(this,void 0,void 0,(function*(){const{items:a,background:o,introAnimation:r}=e,c=function(e,t){var i={};for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&t.indexOf(s)<0&&(i[s]=e[s]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var n=0;for(s=Object.getOwnPropertySymbols(e);n<s.length;n++)t.indexOf(s[n])<0&&Object.prototype.propertyIsEnumerable.call(e,s[n])&&(i[s[n]]=e[s[n]])}return i}(e,["items","background","introAnimation"]);this.copyVals(Object.assign({},c)),r&&this.introAnimation.updateFromObject(r,{undoable:!1,checkForDurationUpdate:n}),o&&(yield this.background.updateFromObject(o,{undoable:!1,updateRedux:!1})),a&&(yield this.items.updateFromObject(a,{undoable:!1,updateRedux:!1,refreshActiveSelection:s,checkForDurationUpdate:n})),this.pageWatermark.refreshWatermark(),i&&this.poster.history.add(),t&&this.poster.redux.updateReduxData()}))}getSelectedItems(){const e=this.activeSelection.getActiveObjects();if(!e||0===e.length)return[];const t=[];for(const i of e){const e=this.getItemForFabricObject(i);e&&t.push(e)}return t}getFilteredExistingViews(e){const t=[];for(const i of e)-1!==this.fabricCanvas.getObjects().indexOf(i)&&t.push(i);return t}getItemForFabricObject(e){for(const[,t]of Object.entries(this.items.itemsHashMap))if(t.doesfabricObjBelongtoItem(e))return t}getStreamingItems(){const e=[];for(const[,t]of Object.entries(this.items.itemsHashMap))t.isStreamingMediaItem()&&e.push(t);return e}hasItem(e){return void 0!==this.items.itemsHashMap[e]}isVideo(){if(this.introAnimation.hasIntroAnimation()&&this.items.hasItems()||this.poster.audioPlaylist.hasAudio())return!0;for(const[,e]of Object.entries(this.items.itemsHashMap))if(e.isMotionItem()||e.isSlideshow()&&e.isStreamingItem())return!0;return!1}isTransparent(){return this.background.isTransparent()}isPremium(){if(this.background.isPremium())return!0;for(const[,e]of Object.entries(this.items.itemsHashMap))if(e.isPremium())return!0;return!1}stopPage(){return M(this,void 0,void 0,(function*(){const e=[];for(const[,t]of Object.entries(this.items.itemsHashMap))"stop"in t&&e.push(t.stop());this.introAnimation.stopAnimation(),yield Promise.all(e)}))}playPage(){return M(this,void 0,void 0,(function*(){const e=[];for(const[,t]of Object.entries(this.items.itemsHashMap))"play"in t&&e.push(t.play());yield Promise.all(e)}))}onSeekPage(){this.introAnimation.stopAnimation()}pausePage(){return M(this,void 0,void 0,(function*(){const e=[];for(const[,t]of Object.entries(this.items.itemsHashMap))"pause"in t&&e.push(t.pause());this.introAnimation.stopAnimation(),yield Promise.all(e)}))}getCanvasCornerPoints(){const{scale:e}=this.poster.scaling;return{tl:{x:0,y:0},tr:{x:this.fabricCanvas.width/e,y:0},br:{x:this.fabricCanvas.width/e,y:this.fabricCanvas.height/e},bl:{x:0,y:this.fabricCanvas.height/e}}}setBackgroundColor(e){this.fabricCanvas.backgroundColor=e}setBackgroundImage(e){this.fabricCanvas.backgroundImage=e}clearSelection(){this.activeSelection.clearSelection()}getColorsOnPage(){let e=[];this.background.details.type===b.O.COLOR&&(e=[...this.background.details.fill.fillColor,...e]);const t=this.items.getItems();for(let i=0;i<t.length;i+=1)e=[...t[i].getColors(),...e];const i=[];for(const t of e)i.push((0,O.KN)(t));return i.filter(((e,t)=>i.indexOf(e)===t))}getFontsOnPage(e=!1){const t=Object.values(this.items.itemsHashMap),i=[];for(const s of t)s.hasEditableText()&&i.push(...s.getFonts(e));return i.filter(((e,t)=>i.indexOf(e)===t))}isSingleItemSelected(){const e=this.getSelectedItems();return!!e&&1===e.length}}},22597:(e,t,i)=>{if(i.d(t,{X:()=>n,s:()=>a}),/^(2046|330|4840)$/.test(i.j))var s=i(81679);var n;!function(e){e.EDIT="edit",e.COPY="copy",e.RESIZE_TO="resizeTo",e.CREATE="create",e.REGEN="regen",e.WEB_PAGE="webpage",e.GENERATE="generate"}(n||(n={}));class a extends(/^(2046|330|4840)$/.test(i.j)?s.v:null){constructor(e,t){super(),this.poster=e,this.details=t}isNewPoster(){return this.details.type===n.COPY||this.details.type===n.CREATE||this.details.type===n.RESIZE_TO}isRegen(){return this.details.type===n.REGEN}isCopy(){return this.details.type===n.COPY}isWebpage(){return this.details.type===n.WEB_PAGE}isGeneration(){return this.details.type===n.GENERATE}toObject(){return{details:this.details}}}},47681:(e,t,i)=>{i.d(t,{$h:()=>o,mp:()=>r});var s=i(41766),n=i(85518);let a=!(n.tq||n.i7||n.G6||n.un);const o=()=>a,r=()=>{new s.Howl({src:"UklGRlIHAABXQVZFZm10IBAAAAABAAIARKwAABCxAgAEABAATElTVEIAAABJTkZPSUNSRAsAAAAyMDE0LTExLTA5AABJU0ZUDgAAAExhdmY1OC43Ni4xMDAASVRDSAwAAABMb2dpYyBQcm8gWABkYXRh5AYAAAAAAAAAA==",onunlock:c})},c=()=>{a=!0}}}]);
//# sourceMappingURL=3052.7dffbc53a9001d90e78d.bundle.js.map