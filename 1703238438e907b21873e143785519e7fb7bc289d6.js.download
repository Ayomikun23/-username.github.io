PMW.checkout=function(){var stripe_,paymentElement_,stripeElements,clientSecret_,paymentIntentId_,setupIntentId_,invoiceId,mode_="",creditPurchaseMode_="",creditPurchaseCb_=null,posterHashedId_="",paypalInit_=!1,paypalAccount_="",cartId_=-1,dialogView_="",suppressPayPalError_=!1,idBillingAddress_=-1,CARDTYPE_NEW="new",CARDTYPE_EXISTING="existing",cardType_=CARDTYPE_EXISTING,cardValidations_={cardholderName:!1,cardPaymentInfo:!1,email:!1},editBillingFromCard_=!1,idCardBeingEdited_=0,successCallback_=null,paymentFailedCallback=null,trialReferrer_="",onCloseCallback_=null,facade_=null,summary_=null,isLegacy_=!1,ID_MODAL="checkout-modal",MODE_DOWNLOAD="download",MODE_SUBSCRIPTION="subscription",MODE_CONVERT_TRIAL="convert-trial",MODE_SUBSCRIPTION_TRIAL="subscription-trial",MODE_BUY_CREDIT_PACK="buy-credits",MODE_MANAGE_CARDS_PREMIUM="manage-premium",MODE_MANAGE_CARDS="manage",MODE_CHANGE_SUBSCRIPTION_PLAN="change-subscription-plan",FLOW_FORWARD="forward",FLOW_BACKWARD="backward",STATUS_SUCCESS="success",STATUS_FAIL="fail",STATUS_ERROR="error",PANEL_CHECKOUT_SUMMARY="checkout-summary",PANEL_CHECKOUT_QUICK="checkout-quick",PANEL_CHECKOUT_ADD_CARD="checkout-add-card",PANEL_CHECKOUT_OPTIONS="checkout-options",PANEL_CHECKOUT_SELECT_BILLING_ADDRESS="checkout-select-billing-address",PANEL_CHECKOUT_ADD_ADDRESS="checkout-add-address",PANEL_CHECKOUT_EDIT_ADDRESS="checkout-edit-address",PANEL_CHECKOUT_BUY_CREDITS="buy-credits",PANEL_CHECKOUT_CARD_UPDATED="checkout-card-updated",PANEL_CHECKOUT_AUTH_REQUIRED="checkout-auth-required",PANEL_CHECKOUT_CONVERT_TRIAL_MESSAGE="convert-trial-message-panel",PANEL_CHECKOUT_EMAIL_REQUIRED="checkout-add-email",DIALOG_VIEW_MODE_PAYPAL="paypal",WEBHOOK_POLLING_REQUEST_TIMEOUT=12e4,PAYMENT_POLLING_REDIRECT_LINK_DISABLED_TIME_SECONDS=10,PAYMENT_POLLING_REDIRECT_LINK_DISABLED_TIME_MILISECONDS=1e3*PAYMENT_POLLING_REDIRECT_LINK_DISABLED_TIME_SECONDS,EVENT_ACTION_CLICK_POLLING_LINK="ClickPollingLink";function isPremiumSummaryRequired_(){return isNewSubscriptionMode()||isChangePlanMode()||isCreditsMode()||isConvertTrialMode()}function resetSummaryPanelPromoErrorMessage(panel){panel.find(".promo-error").addClass("_hidden").removeClass("-up")}function flowForwardToAddAddressPanel(){show_(PANEL_CHECKOUT_ADD_ADDRESS,FLOW_FORWARD)}function flowForwardToAddCardPanel(){cardType_=CARDTYPE_NEW,show_(PANEL_CHECKOUT_ADD_CARD,FLOW_FORWARD)}function flowBackwardToAddCardPanel(){cardType_=CARDTYPE_NEW,show_(PANEL_CHECKOUT_ADD_CARD,FLOW_BACKWARD)}function flowForwardToEmailRequiredPanel(){show_(PANEL_CHECKOUT_EMAIL_REQUIRED,FLOW_FORWARD)}function flowForwardToQuickCheckoutPanel(){cardType_=CARDTYPE_EXISTING,show_(PANEL_CHECKOUT_QUICK,FLOW_FORWARD)}function flowBackwardToQuickCheckoutPanel(){cardType_=CARDTYPE_EXISTING,show_(PANEL_CHECKOUT_QUICK,FLOW_BACKWARD)}function showQuickCheckoutPanel(){cardType_=CARDTYPE_EXISTING,show_(PANEL_CHECKOUT_QUICK)}function flowForwardToSelectBillingAddressPanel(){show_(PANEL_CHECKOUT_SELECT_BILLING_ADDRESS,FLOW_FORWARD)}function flowBackwardToSelectBillingAddressPanel(){show_(PANEL_CHECKOUT_SELECT_BILLING_ADDRESS,FLOW_BACKWARD)}function onClickEditAddressButton(e){e.stopPropagation(),editBillingFromCard_=!0,idCardBeingEdited_=parseInt($(this).closest(".payment-card").attr("data-id")),show_(PANEL_CHECKOUT_EDIT_ADDRESS,FLOW_FORWARD)}function onClickAddCardButton(){cardType_=CARDTYPE_NEW,(areAddressesAvailable()?flowForwardToSelectBillingAddressPanel:flowForwardToAddAddressPanel)()}function onContinueFromQuickCheckoutPanel(modal,panel,continueBtn){let selectedCard=$(".payment-card.-selected");continueBtn.addClass("disabled"),"1"===selectedCard.attr("data-needs-billing")?(isLegacy_=!0,(areAddressesAvailable()?flowForwardToSelectBillingAddressPanel:flowForwardToAddAddressPanel)()):isManageCardsMode()||isManageCardsPremiumMode()?checkoutFromQuickCheckoutPanel(0,panel):(idBillingAddress_=parseInt(selectedCard.attr("data-id-billing")),showSummaryPanel(0,modal))}function onContinueFromSelectBillingPanel(modal,panel,continueBtn){var selectedCard=$(".payment-card.-selected");idBillingAddress_=parseInt(panel.find(".address.-selected").attr("data-id")),!isCheckingOutUsingPaypal()&&cardType_===CARDTYPE_EXISTING&&areCardsAvailable()&&isBillingAddressNeededForSelectedCard()?function(selectedCard){return setLoading_(i18next.t("pmwjs_processing")),new Promise((resolve,reject)=>{PMW.write(PMW.util.site_url("cart/updateUserCreditCardBillingAddress"),{idcard:selectedCard.attr("data-id"),idbilling_address:idBillingAddress_}).done(function(r){"success"===r.status?(selectedCard.parent().append(r.data.cardHtml),selectedCard.remove(),resolve()):reject()}).fail(reject.bind(this)).always(setLoading_.bind(this,null))})}(selectedCard).then(flowForwardToQuickCheckoutPanel).catch(setFormError_.bind(this,getAddressValidationErrorMessage())):isCheckingOutUsingPaypal()?showSummaryPanel(0,modal):(isCheckingOutUsingNewCard()?isEmailAddressRequired()?flowForwardToEmailRequiredPanel:flowForwardToAddCardPanel:flowForwardToQuickCheckoutPanel)()}function onContinueCheckoutFromAddEmailAddressPanel(modal,panel){let email=panel.find("#checkout-email");var emailAddress;performEmailFieldInputValidation(panel,email),validateInput_(email,i18next.t("pmwjs_invalid_email_address"))?(removeValidationErrorMessages(email.parent()),panel.find(".placeholder").removeClass("_hidden"),emailAddress=email.val(),new Promise((resolve,reject)=>{setLoading_(i18next.t("pmwjs_processing")),disableMainCTA_(),PMW.write(PMW.util.site_url("user/addEmailAddress"),{emailAddress:emailAddress}).done(function(r){("success"===r.status?resolve:reject)()}).fail(reject).always(function(){enableMainCTA_(),setLoading_(null)})}).then(function(){modal.find(".panels").attr("data-need-email",0),flowForwardToAddCardPanel()}).catch(stripeCheckoutGenericError_)):panel.find(".placeholder").addClass("_hidden")}function checkoutFromQuickCheckoutPanel(modal,panel){if(isManageCardsMode())PMW.closeModalDialog(ID_MODAL);else{if(!isTrialSubscriptionMode()&&!isManageCardsPremiumMode())throw"Pay button called from "+panel.attr("id")+" in unknown mode: "+mode_;idBillingAddress_=parseInt(panel.find(".payment-card.-selected").attr("data-id-billing")),confirmCardSetupOnStripe()}}function onClickPayNowFromSummaryPanel(panel,payNowBtn){if(!payNowBtn.find(".btn").hasClass("-loading")){if(isManageCardsMode()||isManageCardsPremiumMode())throw"Pay button called from "+panel.attr("id")+" in unknown mode: "+mode_;0===parseFloat(PMW.checkout.getParams(["amountdue"]).amountdue)?confirmCardSetupOnStripe():!function(){if(!isCreditsMode()&&!isDownloadMode())return!1;if(null===paymentElement_||null===paymentIntentId_)return!1;let cardInfoCheckBox=$("#"+ID_MODAL+" #"+PANEL_CHECKOUT_ADD_CARD).find(".save-card-details-checkbox");return 0!==cardInfoCheckBox.length&&cardInfoCheckBox.hasClass("-selected")}()?confirmPaymentOnStripe():function(){let requestUri=isDownloadMode()?"cart/setupPaymentIntentForFutureOnSessionUsage":"premium/setupPaymentIntentForFutureOffSessionUsage";function onFail(failCallback){setFormError_(i18next.t("pmwjs_error_processing_request_reload_try_again")),failCallback()}return setLoading_(i18next.t("pmwjs_loading")),new Promise((resolve,reject)=>{PMW.write(PMW.util.site_url(requestUri),{paymentIntentId:paymentIntentId_}).done((function(successCallback,failCallback,response){"success"===response.status?($("#checkout-add-card-form").find(".save-card-details-checkbox").addClass("_hidden"),successCallback()):onFail(failCallback)}).bind(this,resolve,reject)).fail(onFail.bind(this,reject)).always(setLoading_.bind(this,null))})}().then(confirmPaymentOnStripe)}}function onClickPromoCodeField(){let modal=$("#"+ID_MODAL),panel=modal.find(".panels .panel.-active");$(this).addClass("-hide");let promoField=panel.find(".promocode-field").toggleClass("close");promoField.hasClass("close")?(panel.find(".modal-content").removeClass("-has-promo"),resetSummaryPanelPromoErrorMessage(panel)):(modal.find(".modal-content").addClass("-has-promo"),promoField.find(".input").focus())}function attachCheckoutOptionsPanelEventHandlers(modal,panel){PMW.onClick(panel.find(".btn-pay-with-paypal"),null,(function(panel){isDownloadMode()&&(setDialogView($("#"+ID_MODAL),DIALOG_VIEW_MODE_PAYPAL),paypalInit_||$.getScript("https://www.paypalobjects.com/api/checkout.js",function(){paypalInit_=!0,paypal.Button.render({env:$("#paypal-button").attr("data-environment"),commit:!1,style:{size:"responsive",height:36,color:"gold",shape:"pill",label:"checkout",tagline:!1},payment:function(data,actions){paypalAccount_="";var cartId=PMW.checkout.getParams(["id"]).id;return paypal.request.post(PMW.util.site_url("cart/checkoutPayPalDownload"),{id:cartId,idBillingAddress:idBillingAddress_}).then(function(r){return r.status===STATUS_SUCCESS?(paypalAccount_=r.data.account,cartId_=r.data.cartId,r.data.id):void(r.status===STATUS_ERROR&&(suppressPayPalError_=!0,handlePaypalError_(r.code)))})},onAuthorize:function(data,actions){return paypal.request.post(PMW.util.site_url("cart/executePaypalPayment"),{account:paypalAccount_,paymentId:data.paymentID,payerId:data.payerID,cartId:cartId_,billing:idBillingAddress_}).then(paypalCheckoutSuccess_,onCheckoutFail)},onCancel:function(data,actions){},onError:function(err){suppressPayPalError_?suppressPayPalError_=!1:(alert(i18next.t("pmwjs_error_reload_page")),PMW.log("Error during PayPal checkout: "+err))}},"#paypal-button")}),(areAddressesAvailable()?flowForwardToSelectBillingAddressPanel:flowForwardToAddAddressPanel)())}).bind(this,panel)),PMW.onClick(modal.find(".btn-pay-with-card"),null,(function(modal){setDialogView(modal),(areCardsAvailable()?flowForwardToQuickCheckoutPanel:areAddressesAvailable()?flowForwardToSelectBillingAddressPanel:flowForwardToAddAddressPanel)()}).bind(this,modal))}function attachBuyCreditsPanelEventHandlers(modal,panel){PMW.onClick(panel.find(".btn-continue-checkout"),null,(function(modal,panel){(areCardsAvailable()?flowForwardToQuickCheckoutPanel:areAddressesAvailable()?flowForwardToSelectBillingAddressPanel:flowForwardToAddAddressPanel)()}).bind(this,modal,panel))}function attachConvertTrialMessagePanelEventHandlers(modal,panel){PMW.onClick(panel.find(".btn-continue-checkout"),null,(function(modal,panel){(areCardsAvailable()?flowForwardToQuickCheckoutPanel:areAddressesAvailable()?flowForwardToSelectBillingAddressPanel:flowForwardToAddAddressPanel)()}).bind(this,modal,panel))}function performEmailFieldInputValidation(panel,email){validateInput_(email,i18next.t("pmwjs_invalid_email_address"))?(removeValidationErrorMessages(email.parent()),panel.find(".placeholder").removeClass("_hidden"),updateCardValidationInformation_("email",!0)):(panel.find(".placeholder").addClass("_hidden"),updateCardValidationInformation_("email",!1))}function attachAddCardPanelEventHandlers(modal,panel){let cardHolderName=$("#checkout-cardholder-name"),saveCardCheckbox=$(".save-card-details-checkbox");cardHolderName.change((function(modal,panel,cardHolderName){validateInput_(cardHolderName,i18next.t("pmwjs_enter_card_name"))?(removeValidationErrorMessages(cardHolderName.parent()),panel.find(".placeholder").removeClass("_hidden"),updateCardValidationInformation_("cardholderName",!0)):(panel.find(".placeholder").addClass("_hidden"),updateCardValidationInformation_("cardholderName",!1))}).bind(this,modal,panel,cardHolderName)),$("#checkout-add-card-form").submit(onCardFormSubmit_),PMW.onClick(saveCardCheckbox.find(".js-checkbox"),null,(function(saveCardCheckbox){saveCardCheckbox.hasClass("-selected")?saveCardCheckbox.removeClass("-selected"):saveCardCheckbox.addClass("-selected")}).bind(this,saveCardCheckbox))}function showListItemDeleteConfirmationOptions(e){e.stopPropagation(),$(this).closest(".delete-options").addClass("-confirm-state").siblings(".address-detail").addClass("-delete-mode")}function onCancelListItemDeletion(e){e.stopPropagation(),$(this).closest(".delete-options").removeClass("-confirm-state").siblings(".address-detail").removeClass("-delete-mode")}function onCheckoutDialogLoaded(params){let modal=$("#"+ID_MODAL),panels=modal.find(".panels");PMW.onClick(modal.find(".btn-close"),null,PMW.closeModalDialog.bind(this,ID_MODAL)),PMW.onClick(modal,".list-item",onSelectItem_),PMW.onClick(modal,".list-item .btn-delete",showListItemDeleteConfirmationOptions),PMW.onClick(modal,".list-item .btn-confirm-delete",onDeleteItem_),PMW.onClick(modal,".list-item .btn-cancel-delete",onCancelListItemDeletion),window.initResponsiveToolTips&&initResponsiveToolTips(),isCreditsMode()&&"0"===$("#buy-credits").attr("data-allowed")&&modal.addClass("-team-needs-credits");var backButton=new ModalTopAction(i18next.t("pmwjs_back"),"icon-back",(function(){var modal=$("#"+ID_MODAL),panelId=(modal.find(".content").find(".panels"),getActivePanelId());switch(panelId){case PANEL_CHECKOUT_QUICK:if(isDownloadMode())show_(PANEL_CHECKOUT_OPTIONS,FLOW_BACKWARD);else if(isCreditsMode())show_(PANEL_CHECKOUT_BUY_CREDITS,FLOW_BACKWARD);else if(isConvertTrialMode())show_(PANEL_CHECKOUT_CONVERT_TRIAL_MESSAGE,FLOW_BACKWARD);else if(isTrialSubscriptionMode())return PMW.closeModalDialog(ID_MODAL),void PMW.premiumDialogs.openTrialDialog(!1,null,FLOW_BACKWARD);break;case PANEL_CHECKOUT_ADD_CARD:$("#checkout-add-card-form").find("input").val(""),paymentElement_.clear(),flowBackwardToSelectBillingAddressPanel();break;case PANEL_CHECKOUT_SELECT_BILLING_ADDRESS:if(isCheckingOutUsingPaypal())show_(PANEL_CHECKOUT_OPTIONS,FLOW_BACKWARD);else if(isDownloadMode()&&isNoCardSaved())show_(PANEL_CHECKOUT_OPTIONS,FLOW_BACKWARD);else if(isCreditsMode()&&isNoCardSaved())show_(PANEL_CHECKOUT_BUY_CREDITS,FLOW_BACKWARD);else if(isConvertTrialMode()&&isNoCardSaved())show_(PANEL_CHECKOUT_CONVERT_TRIAL_MESSAGE,FLOW_BACKWARD);else if(cardType_===CARDTYPE_EXISTING&&areCardsAvailable())$("#checkout-quick").find(".payment-card.-selected").attr("data-id-billing","-1"),flowBackwardToQuickCheckoutPanel();else if(isCheckingOutUsingNewCard()&&areCardsAvailable())flowBackwardToQuickCheckoutPanel();else if(isTrialSubscriptionMode()&&isNoCardSaved())return PMW.closeModalDialog(ID_MODAL),void PMW.premiumDialogs.openTrialDialog(!1,null,"backward");break;case PANEL_CHECKOUT_ADD_ADDRESS:if(areAddressesAvailable())flowBackwardToSelectBillingAddressPanel();else if(isCheckingOutUsingPaypal())show_(PANEL_CHECKOUT_OPTIONS,FLOW_BACKWARD);else if(areCardsAvailable())flowBackwardToQuickCheckoutPanel();else if(isDownloadMode())show_(PANEL_CHECKOUT_OPTIONS,FLOW_BACKWARD);else if(isCreditsMode())show_(PANEL_CHECKOUT_BUY_CREDITS,FLOW_BACKWARD);else if(isConvertTrialMode())show_(PANEL_CHECKOUT_CONVERT_TRIAL_MESSAGE,FLOW_BACKWARD);else if(isTrialSubscriptionMode())return PMW.closeModalDialog(ID_MODAL),void PMW.premiumDialogs.openTrialDialog(!1,null,FLOW_BACKWARD);break;case PANEL_CHECKOUT_EDIT_ADDRESS:(editBillingFromCard_?flowBackwardToQuickCheckoutPanel:flowBackwardToSelectBillingAddressPanel)();break;case PANEL_CHECKOUT_SUMMARY:modal.find(".tax-row").remove(),modal.find(".total .price").text(""),(isCheckingOutUsingPaypal()?flowBackwardToSelectBillingAddressPanel:isCheckingOutUsingPaypal()||cardType_!==CARDTYPE_EXISTING?flowBackwardToAddCardPanel:flowBackwardToQuickCheckoutPanel)();break;case PANEL_CHECKOUT_AUTH_REQUIRED:isCheckingOutUsingNewCard()&&areCardsAvailable()?flowBackwardToSelectBillingAddressPanel():areCardsAvailable()?flowBackwardToQuickCheckoutPanel():(cardType_=CARDTYPE_NEW,show_(PANEL_CHECKOUT_ADD_CARD));break;case PANEL_CHECKOUT_EMAIL_REQUIRED:flowBackwardToSelectBillingAddressPanel();break;default:throw"Back button clicked from unknown checkout panel: "+panelId}}).bind(this),"btn-back _hidden");PMW.addBackButtonToModal(modal,backButton),function(panel){let form=panel.find("#checkout-add-address-form");form.submit(onSubmitNewAddress_),PMW.onClick(panel.find(".btn-continue-checkout"),null,()=>form.submit())}($("#"+PANEL_CHECKOUT_ADD_ADDRESS)),function(panel){let form=panel.find("#checkout-edit-address-form");form.submit(onSubmitEditedAddress_),PMW.onClick(panel.find(".btn-continue-checkout"),null,()=>form.submit())}($("#"+PANEL_CHECKOUT_EDIT_ADDRESS)),function(modal,panel){var continueBtn=panel.find(".btn-continue-checkout");PMW.onClick(continueBtn,null,onContinueFromSelectBillingPanel.bind(this,modal,panel,continueBtn)),PMW.onClick(panel.find(".btn-add-address"),null,flowForwardToAddAddressPanel),PMW.onClick(modal.find(".addresses"),".btn-edit-address",onClickEditAddressButton)}(modal,$("#"+PANEL_CHECKOUT_SELECT_BILLING_ADDRESS)),function(modal,panel){let continueBtn=panel.find(".btn-continue-checkout");PMW.onClick(panel.find(".btn-pay"),null,function(){isBillingAddressNeededForSelectedCard()?onContinueFromQuickCheckoutPanel(modal,panel,continueBtn):checkoutFromQuickCheckoutPanel(0,panel)}),PMW.onClick(continueBtn,null,onContinueFromQuickCheckoutPanel.bind(this,modal,panel,continueBtn)),PMW.onClick(panel.find(".btn-add-card"),null,onClickAddCardButton),PMW.onClick(modal.find(".btn-edit-billing"),null,onClickEditAddressButton)}(modal,$("#"+PANEL_CHECKOUT_QUICK)),function(modal,panel){var payNowBtn=panel.find(".btn-pay");PMW.onClick(payNowBtn,null,onClickPayNowFromSummaryPanel.bind(this,modal,payNowBtn)),PMW.onClick(panel.find(".btn-apply-promocode"),null,onApplyPromo_),panel.find(".promocode-field .input").on("keyup",onKeyUpOnPromoCodeField),PMW.onClick(panel.find(".promocode-option"),null,onClickPromoCodeField)}(modal,$("#"+PANEL_CHECKOUT_SUMMARY)),attachCheckoutOptionsPanelEventHandlers(modal,$("#"+PANEL_CHECKOUT_OPTIONS)),attachBuyCreditsPanelEventHandlers(modal,$("#"+PANEL_CHECKOUT_BUY_CREDITS)),attachAddCardPanelEventHandlers(modal,$("#"+PANEL_CHECKOUT_ADD_CARD)),attachConvertTrialMessagePanelEventHandlers(modal,$("#"+PANEL_CHECKOUT_CONVERT_TRIAL_MESSAGE)),function(modal,panel){let email=panel.find("#checkout-email");email.change(performEmailFieldInputValidation.bind(this,panel,email)),PMW.onClick(panel.find(".btn-continue-checkout"),null,onContinueCheckoutFromAddEmailAddressPanel.bind(this,modal,panel))}(modal,$("#"+PANEL_CHECKOUT_EMAIL_REQUIRED)),initUI_(panels,modal,params)}function resizeDialog_(id){var modal=$("#"+ID_MODAL);switch(modal.removeClass("-add-address -credits-checkout -order-summary -card-updated -has-payment-element -loading-state -auth-required -convert-trial-message -need-email").find(".modal-content").removeClass("-premium -expand -has-free-products -has-getty -has-promo"),id){case PANEL_CHECKOUT_OPTIONS:case PANEL_CHECKOUT_QUICK:case PANEL_CHECKOUT_SELECT_BILLING_ADDRESS:break;case PANEL_CHECKOUT_ADD_ADDRESS:case PANEL_CHECKOUT_EDIT_ADDRESS:modal.addClass("-add-address");break;case PANEL_CHECKOUT_BUY_CREDITS:modal.addClass("-credits-checkout");break;case PANEL_CHECKOUT_CONVERT_TRIAL_MESSAGE:modal.addClass("-convert-trial-message");break;case PANEL_CHECKOUT_SUMMARY:if(modal.addClass("-order-summary"),isPremiumSummaryRequired_()){modal.find(".modal-content").addClass("-premium");var balance=PMW.checkout.getParams(["balance"]).balance,productPrice=summary_.productPrice,discountAmount=summary_.discount;void 0!==balance&&0<balance-(productPrice-discountAmount)&&modal.find(".modal-content").addClass("-has-remaining-balance")}else{let freeProducts=summary_.freeProducts,gettyData=summary_.gettyData,className="";1<freeProducts.length&&(className+=" -has-free-products"),void 0!==gettyData&&(className+=" -has-getty"),0<summary_.orderTax&&(className+=" -has-tax"),modal.find(".modal-content").addClass(className)}break;case PANEL_CHECKOUT_CARD_UPDATED:modal.addClass("-card-updated");break;case PANEL_CHECKOUT_ADD_CARD:modal.addClass("-has-payment-element");break;case PANEL_CHECKOUT_AUTH_REQUIRED:modal.addClass("-auth-required");break;case PANEL_CHECKOUT_EMAIL_REQUIRED:modal.addClass("-need-email")}}function getCurrentlySelectedBillingAddressId(){let selectedCard=$(".payment-card.-selected");return!isCheckingOutUsingPaypal()&&cardType_===CARDTYPE_EXISTING&&areCardsAvailable()&&0!==selectedCard.length?parseInt(selectedCard.attr("data-id-billing")):parseInt($("#checkout-select-billing-address").find(".address.-selected").attr("data-id"))}function isBillingAddressNeededForSelectedCard(){return"1"===$(".payment-card.-selected").attr("data-needs-billing")}function sendClientSecretGenerationRequest(params=null){null==params&&(params=PMW.checkout.getParams(["id","promo","time","tpid","is","trialConversionMode","seats","memberIdsToRemove"]));let requestUri="",requestParams={},idBilling=getCurrentlySelectedBillingAddressId();switch(void 0!==idBilling&&(requestParams.idBilling=idBilling),mode_){case MODE_SUBSCRIPTION:requestUri=isNewSubscriptionPurchaseWithZeroAmount()?"premium/createSetupIntentForClientSecretGeneration":"premium/placeOrderForNewSubscription",requestParams={id:params.id,promoCode:params.promo,seats:params.seats,...requestParams};break;case MODE_DOWNLOAD:requestUri="cart/generateStripeClientSecretForDownload",requestParams={id:params.id,is:params.is,...requestParams};break;case MODE_BUY_CREDIT_PACK:var creditPackId=$("#buy-credits").find(".credit.-selected").attr("data-id");requestUri="premium/generateClientSecretForCreditPackOrder",requestParams={tpid:creditPackId,...requestParams};break;case MODE_CHANGE_SUBSCRIPTION_PLAN:requestUri="premium/changeSubscriptionPlan",requestParams={id:params.id,promoCode:params.promo,encryptedTime:params.time,seats:params.seats,memberIdsToRemove:params.memberIdsToRemove,...requestParams};break;case MODE_CONVERT_TRIAL:requestUri="premium/convertTrial",requestParams={trialConversionMode:params.trialConversionMode,...requestParams};break;case MODE_SUBSCRIPTION_TRIAL:case MODE_MANAGE_CARDS:case MODE_MANAGE_CARDS_PREMIUM:requestUri="premium/createSetupIntentForClientSecretGeneration"}return new Promise((resolve,reject)=>{""===requestUri?reject():null===clientSecret_?PMW.write(PMW.util.site_url(requestUri),requestParams).done(function(r){"success"===r.status?(clientSecret_=void 0!==r.data.clientSecret?r.data.clientSecret:null,paymentIntentId_=void 0!==r.data.paymentIntentId?r.data.paymentIntentId:null,setupIntentId_=void 0!==r.data.setupIntentId?r.data.setupIntentId:null,invoiceId=void 0!==r.data.invoiceId?r.data.invoiceId:null,void 0!==r.data.isPaymentIntentSuccessful&&r.data.isPaymentIntentSuccessful?invoiceId?onSuccessfulStripeConfirmation().then().catch(setFormError_.bind(this,i18next.t("pmwjs_entry_valid_info_try_again"))):handleSuccessfulCheckout(r.data):resolve()):reject()}).fail(reject.bind(this)):resolve()})}function mountPaymentElement(){paymentElement_.mount("#stripe-payment-element"),paymentElement_.on("change",function(event){updateCardValidationInformation_("cardPaymentInfo",event.complete)})}function loadPaymentElement(){return new Promise((resolve,reject)=>{loadStripeJS().then(function(){return null!==paymentElement_?(mountPaymentElement(),void resolve()):void function(){const fonts=[{cssSrc:"https://fonts.googleapis.com/css?family=Nunito+Sans:400)"}],appearance={variables:{colorDanger:"#B70A3E",fontSizeBase:"1rem",spacingGridRow:"10px",spacingUnit:"1px",fontFamily:"Nunito Sans"},rules:{".Input":{lineHeight:"24px",paddingBottom:"7px",paddingLeft:"10px",paddingTop:"7px"},".Input:focus":{borderColor:"none",boxShadow:"none",outline:"none"},".Input--invalid":{backgroundColor:"#f0c5c5",borderColor:"#ca3838",boxShadow:"none"},".Error":{fontSize:"0.875rem"},".Label":{color:"#403F5D",fontSize:"1rem",lineHeight:"1.65rem",marginBottom:0}}};return new Promise((resolve,reject)=>{loadStripeJS().then(function(){sendClientSecretGenerationRequest().then(()=>{stripeElements=stripe_.elements({clientSecret:clientSecret_,appearance:appearance,fonts:fonts}),resolve()}).catch(reject.bind(this))}).catch(reject.bind(this))})}().then(function(){paymentElement_=stripeElements.create("payment",{fields:{billingDetails:{address:"never",name:"never"}},wallets:{applePay:"never",googlePay:"never"}}),mountPaymentElement(),paymentElement_.on("ready",resolve.bind(this))}).catch(reject.bind(this))}).catch(reject.bind(this))})}function displayPanel(panel,direction){if(!panel.hasClass("-active")){let active=panel.siblings(".-active");void 0!==direction&&(direction===FLOW_FORWARD?active.addClass("-left"):active.removeClass("-left")),active.removeClass("-active"),panel.addClass("-active")}0===panel.siblings("-left").length&&hideModalLoadingState(),function(modal){let activePanel=getActivePanel(),backBtn=modal.find(".header .modal-header-action.btn-back");!(0<activePanel.siblings(".-left").length||isTrialSubscriptionMode()&&(getActivePanelId()===PANEL_CHECKOUT_QUICK||getActivePanelId()===PANEL_CHECKOUT_SELECT_BILLING_ADDRESS))?backBtn.addClass("_hidden"):backBtn.removeClass("_hidden")}($("#"+ID_MODAL))}function hideModalLoadingState(){let modal=$("#"+ID_MODAL),modalContent=modal.find(".modal-content");modal.removeClass("-loading-state"),modalContent.find(".content").removeClass("_hidden"),modalContent.find(".modal-loading-state").addClass("_hidden"),resizeDialog_(getActivePanelId())}function showModalLoadingState(loadingTextHtml){let modal=$("#"+ID_MODAL),modalContent=modal.find(".modal-content"),modalLoadingState=modalContent.find(".modal-loading-state");0===modalLoadingState.length?modalContent.append('<div class="modal-loading-state"><progress class="icon-circular-loader"></progress><div class="loading-text">'+loadingTextHtml+"</div></div>"):(modalLoadingState.find(".loading-text").html(loadingTextHtml),modalLoadingState.removeClass("_hidden")),modal.removeClass("-add-address -credits-checkout -order-summary -card-updated -has-payment-element -auth-required -convert-trial-message").find(".modal-content").removeClass("-premium -expand"),modal.addClass("-loading-state"),modalContent.find(".content").addClass("_hidden")}function onLoadPaymentElementFail(){hideModalLoadingState(),PMW.setLoading(null),setFormError_(i18next.t("pmwjs_error_setting_up_payments"))}function show_(id,direction){var p=$("#"+id),modal=$("#"+ID_MODAL),bc=$("#buy-credits"),btnPay=p.find(".btn-pay"),btnContinue=p.find(".btn-continue-checkout");switch(id!==PANEL_CHECKOUT_ADD_CARD&&(displayPanel(p,direction),resizeDialog_(id)),isActivePanelCheckoutSummary()&&direction!==FLOW_BACKWARD&&resetSummaryPanelPromoErrorMessage(modal),id){case PANEL_CHECKOUT_ADD_CARD:let panelAddCard=$("#checkout-add-card");(isManageCardsPremiumMode()||isManageCardsMode())&&p.find(".tiles").addClass("-no-tiles"),modal.find(".modal-loading-state").hasClass("_hidden")&&showModalLoadingState("<p>"+i18next.t("pmwjs_checkout_loading_message")+"</p>");let elementLoadingPromise=loadPaymentElement();elementLoadingPromise.then((function(modal,panel,direction){modal.find(".modal-loading-state").hasClass("_hidden")||hideModalLoadingState(),resizeDialog_(panel.attr("id")),displayPanel(panel,direction),0}).bind(this,modal,p,direction)).catch(onLoadPaymentElementFail),panelAddCard.find(".btn-continue-checkout").focusin(function(){$("#checkout-cardholder-name").focus()}),enableMainCTA_();break;case PANEL_CHECKOUT_ADD_ADDRESS:p.find(".region-open").addClass("_hidden"),p.find(".region-states").removeClass("_hidden"),p.find(".title").text(i18next.t("pmwjs_checkout_enter_billing_address")),$("#checkout-address-country-code").val("US").prop("disabled",!1).parent().removeClass("_hidden"),$("#checkout-address-country-code-readonly").addClass("_hidden"),p.parent().scrollTop(0),p.find(".input:not(.-no-clear)").val(""),removeValidationErrorMessages($("#checkout-add-address").find(".field")),$("#checkout-add-address-form").find(".field-wrapper").removeClass("-error"),$("#checkout-address-phone").focusout(function(){$("#checkout-address-name").focus()}),isTrialSubscriptionMode()?btnPay.find(".btn-pay-now-cta").html(i18next.t("pmwjs_start_trial")):(btnContinue.find("btn-continue-checkout-cta").html(i18next.t("pmwjs_add_billing_address")),enableMainCTA_());break;case PANEL_CHECKOUT_EDIT_ADDRESS:var postalCode=$("#checkout-edit-address-form");removeValidationErrorMessages(postalCode.find(".field")),postalCode.find(".field-wrapper").removeClass("-error");var selectedCardId=getCurrentlySelectedBillingAddressId(),editRegion=$("#checkout-select-billing-address").find('.address[data-id="'+selectedCardId+'"]');$("#checkout-edit-address-country-code").prop("disabled",!1).parent().removeClass("_hidden"),$("#checkout-edit-address-country-code-readonly").addClass("_hidden");var editCountry=document.getElementById("checkout-edit-address-country-code"),name=editRegion.find(".contact-name").text(),address1=editRegion.find(".address1").text(),address2=editRegion.find(".address2").text(),city=editRegion.find(".city").text(),region=editRegion.find(".region").text(),selectedCard=editRegion.find(".countryCode").text(),postalCode=editRegion.find(".postalCode").text(),selectedCardId=editRegion.find(".phone").text(),editRegion="US"===selectedCard?(p.find(".region-open").addClass("_hidden"),p.find(".region-states").removeClass("_hidden"),$("#checkout-edit-address-region-states")):(p.find(".region-open").removeClass("_hidden"),p.find(".region-states").addClass("_hidden"),$("#checkout-edit-address-region"));document.getElementById("checkout-edit-address-name").value=name,document.getElementById("checkout-edit-address-line1").value=address1,document.getElementById("checkout-edit-address-line2").value=address2,document.getElementById("checkout-edit-address-city").value=city,editRegion[0].value=region.split(" ").join(""),"select"!==editRegion[0].tagName.toLowerCase()||editRegion[0].value||(editRegion[0].value=0),document.getElementById("checkout-edit-address-postal-code").value=postalCode,editCountry&&(editCountry.value=selectedCard),document.getElementById("checkout-edit-address-phone").value=selectedCardId,$("#checkout-edit-address-phone").focusout(function(){$("#checkout-edit-address-name").focus()});break;case PANEL_CHECKOUT_SELECT_BILLING_ADDRESS:if((0===p.find(".address.-selected").length?disableMainCTA_:enableMainCTA_)(),isLegacy_){let isManageCardsMode=mode_===MODE_MANAGE_CARDS||mode_===MODE_MANAGE_CARDS_PREMIUM,btnCtaSelector=isManageCardsMode||mode_===MODE_SUBSCRIPTION_TRIAL?".btn-pay-now-cta":".btn-continue-checkout-cta";p.find(btnCtaSelector)[0].textContent=i18next.t("pmwjs_update_billing_address")}else isManageCardsMode()&&cardType_===CARDTYPE_EXISTING&&areCardsAvailable()?p.find(".btn-pay-now-cta")[0].textContent=i18next.t("pmwjs_checkout_update"):isManageCardsPremiumMode()&&cardType_===CARDTYPE_EXISTING&&areCardsAvailable()&&(p.find(".btn-pay-now-cta")[0].textContent=i18next.t("pmwjs_checkout_set_default"));p.find(".btn").focusout(function(e){e.preventDefault()});break;case PANEL_CHECKOUT_QUICK:paymentElement_=null;selectedCard=p.find(".payment-card.-selected"),selectedCardId=selectedCard.attr("data-id");idBillingAddress_="-1"===selectedCardId?-1:parseInt(selectedCard.attr("data-id-billing")),isManageCardsMode()||isManageCardsPremiumMode()?p.find(".btn-pay-now-cta").text(i18next.t("pmwjs_checkout_set_default")):isTrialSubscriptionMode()?p.find(".btn-pay-now-cta").text(i18next.t("pmwjs_start_trial")):btnContinue.find(".btn-text").text(i18next.t("pmwjs_continue")),0===selectedCard.length?disableMainCTA_():("1"===selectedCard.attr("data-needs-billing")&&(btnPay.find(".btn-text").text(i18next.t("pmwjs_add_billing_address")),btnContinue.find(".btn-text").text(i18next.t("pmwjs_add_billing_address"))),enableMainCTA_()),0<selectedCard.find(".expired").length&&disableMainCTA_();break;case PANEL_CHECKOUT_BUY_CREDITS:var btnPayWithCard=p.find(".out-of-credits");"0"===bc.attr("data-allowed")&&$("#checkout-modal").find(".header .title").html("<h2>"+i18next.t("pmwjs_insufficient_credits")+"</h2>"),0===p.find(".credit.-selected").length&&disableMainCTA_(),"pay-with-credits"===creditPurchaseMode_?btnPayWithCard.removeClass("_hidden"):btnPayWithCard.addClass("_hidden");break;case PANEL_CHECKOUT_SUMMARY:direction!==FLOW_BACKWARD&&(p.find(".paid-products .items").empty(),p.find(".free-products .items").empty(),p.find(".order-total .discount-row").addClass("_hidden"),p.find(".promo-applied").addClass("_hidden"),p.find(".promocode-option").removeClass("_hidden"),p.find(".tax .amount").empty(),p.find(".total .price").empty(),btnPay.find(".btn-pay-now-cta").html(i18next.t("pmwjs_pay_now"))),(isPremiumSummaryRequired_()?function(summaryData,modal){var mc=modal.find(".modal-content"),promo=modal.attr("data-param-promo"),panel=$("#"+PANEL_CHECKOUT_SUMMARY),product=panel.find(".order-total .product"),taxAmountEl=panel.find(".tax .amount"),discountRow=panel.find(".order-total .discount-row"),balanceEl=panel.find(".balance"),unusedTimeRow=summaryData.orderTotal,taxAmount=summaryData.orderTax,productPrice=summaryData.productPrice,remainingBalance=summaryData.discount,balance=PMW.checkout.getParams(["balance"]).balance;productPrice=productPrice||unusedTimeRow-taxAmount;0<taxAmount?taxAmountEl.html(PMW.util.currencyFormat(taxAmount,summaryData.currencyCode)):taxAmountEl.html(PMW.util.currencyFormat(0,summaryData.currencyCode));let productName=summaryData.productName;product.find(".amount").html(PMW.util.currencyFormat(productPrice,summaryData.currencyCode)),panel.find(".total .amount").html(PMW.util.currencyFormat(unusedTimeRow,summaryData.currencyCode)),isChangePlanMode()&&((unusedTimeRow=mc.find(".order-total .unused-time")).find(".name").html(i18next.t("pmwjs_x_unused_time",{plan:summaryData.currentPlanName})),unusedTimeRow.find(".amount").html("-"+PMW.util.currencyFormat(summaryData.unusedTime,summaryData.currencyCode)),productName=i18next.t("pmwjs_x_remaining_time",{plan:productName}));product.find(".name").html(productName),promo&&(discountRow.removeClass("_hidden"),discountRow.find(".name").html(i18next.t("pmwjs_discount_x",{promo:promo})),discountRow.find(".amount").html("-"+PMW.util.currencyFormat(remainingBalance,summaryData.currencyCode)));promo&&isChangePlanMode()?mc.addClass("-expand"):mc.removeClass("-expand");void 0!==balance&&0<balance?(balanceEl.find(".amount").html(PMW.util.currencyFormat(-1*balance,summaryData.currencyCode)),balanceEl.removeClass("_hidden"),0<(remainingBalance=balance-(productPrice-remainingBalance))&&panel.find(".message.-neutral").removeClass("_hidden").html(i18next.t("pmwjs_your_remaining_balance_of_x_will_be_used_for_future_payments",{amount:PMW.util.currencyFormat(remainingBalance,summaryData.currencyCode)}))):panel.find(".message.-neutral").addClass("_hidden").html("");panel.find(".message.-danger").removeClass("_hidden").html("")}:function(summaryData,modal){let paidProductsHtml,freeProductsHtml="",freeProducts=summaryData.freeProducts,paidProduct=summaryData.paidProduct,gettyData=summaryData.gettyData,gettyPrice=summaryData.gettyPrice,orderTotal=summaryData.orderTotal,orderTax=summaryData.orderTax,mc=modal.find(".modal-content"),taxRow=mc.find(".order-total .tax");if(paidProductsHtml="<li class='item'><div class='-row'><span class='name'>"+paidProduct.name+"</span><span class='amount price'>"+PMW.util.currencyFormat(paidProduct.price,summaryData.currencyCode)+"</span></div></li>",void 0!==gettyData){paidProductsHtml+="<li class='item -column'><div class='-row'><span class='name'>"+i18next.t("pmwjs_getty_stock")+"</span><span class='amount price'>"+formatter.format(gettyPrice)+"</span></div>",paidProductsHtml+="<div class='getty -row -no-space'>";for(var x=0;x<gettyData.length;x++)"image"===gettyData[x].type?paidProductsHtml+="<img class='getty-content' src='"+gettyData[x].url+"'>":"video"===gettyData[x].type&&(paidProductsHtml+="<video class='getty-content' src='"+gettyData[x].url+"'></video>");paidProductsHtml+="</div></li>"}for(var i=0;i<freeProducts.length;i++)freeProductsHtml+="<li class='item -row -no-space'><i class='icon-check'></i><span class='name'>"+freeProducts[i]+"</span></li>";var discountRow=PMW.util.currencyFormat(orderTotal+orderTax,summaryData.currencyCode),panel=$("#checkout-summary");modal.attr("data-param-price",discountRow),panel.find(".paid-products ul").append(paidProductsHtml),panel.find(".free-products ul").append(freeProductsHtml),panel.find(".total .price").html(discountRow),panel.find(".btn-pay .btn-pay-now-cta").html(getCTAText_({price:discountRow})),0<orderTax?taxRow.removeClass("_hidden").find(".amount").html(PMW.util.currencyFormat(orderTax,summaryData.currencyCode)):taxRow.addClass("_hidden");0<summaryData.discount&&summaryData.promocode?((discountRow=mc.find(".order-total .discount-row").removeClass("_hidden")).find(".name").html(i18next.t("pmwjs_discount_x",{promo:summaryData.promocode})),discountRow.find(".amount").html("-"+PMW.util.currencyFormat(summaryData.discount,summaryData.currencyCode))):(mc.find(".promocode-field").hasClass("close")&&mc.find(".promocode-option").removeClass("-hide"),mc.find(".promocode-field .inpt-promo-code").val(""))})(summary_,modal);break;case PANEL_CHECKOUT_OPTIONS:PMW.onClick(p.find(".btn-start-trial"),null,(function(){PMW.closeModalDialog(ID_MODAL),p.find(".trial-banner").addClass("_hidden"),PMW.premiumDialogs.openTrialDialog(!0,"download")}).bind(this));btnPayWithCard=p.find(".btn-pay-with-card");"1"===btnPayWithCard.attr("data-show")&&btnPayWithCard.removeClass("_hidden");break;case PANEL_CHECKOUT_CARD_UPDATED:isManageCardsPremiumMode()&&(onCloseCallback_=successCallback_);break;case PANEL_CHECKOUT_AUTH_REQUIRED:case PANEL_CHECKOUT_CONVERT_TRIAL_MESSAGE:case PANEL_CHECKOUT_EMAIL_REQUIRED:break;default:throw"Failed to show unknown panel: "+id}}function disableMainCTA_(){let panel=getActivePanel();0!==panel.find(".btn-pay .btn").length&&panel.find(".btn-pay .btn").addClass("disabled"),0!==panel.find(".btn-continue-checkout").length&&panel.find(".btn-continue-checkout").addClass("disabled")}function enableMainCTA_(){let panel=getActivePanel();0!==panel.find(".btn-pay .btn").length&&panel.find(".btn-pay .btn").removeClass("disabled"),0!==panel.find(".btn-continue-checkout").length&&panel.find(".btn-continue-checkout").removeClass("disabled")}function areCardsAvailable(){return 0<parseInt($("#"+ID_MODAL).find(".panels").attr("data-cards"))}function areAddressesAvailable(){return 0<parseInt($("#"+ID_MODAL).find(".panels").attr("data-addresses"))}function isNoCardSaved(){return!areCardsAvailable()}function isCheckingOutUsingNewCard(){return isNoCardSaved()||cardType_===CARDTYPE_NEW}function isEmailAddressRequired(){return"1"===$("#"+ID_MODAL).find(".panels").attr("data-need-email")}function isCheckingOutUsingPaypal(){return dialogView_===DIALOG_VIEW_MODE_PAYPAL}function setLoading_(text){var key;facade_?(key="checkout-dialog",null===text?facade_.sendNotification(postermywall.Core.HIDE_LOADING,{key:key}):facade_.sendNotification(postermywall.Core.SHOW_LOADING,{key:key,text:text})):$.isFunction(PMW.setLoading)&&PMW.setLoading(text)}function setFormError_(text,el){$("#"+ID_MODAL+" .-active").toggleClass("-error",0<text.length).find(".message.-danger").toggleClass("_hidden",!text).html(text),el&&el.focus().closest(".field").addClass("danger")}function getActivePanel(){return $("#"+ID_MODAL).find(".panels .-active")}function getActivePanelId(){return getActivePanel().attr("id")}function isActivePanelCheckoutSummary(){return getActivePanelId()===PANEL_CHECKOUT_SUMMARY}function isDownloadMode(){return mode_===MODE_DOWNLOAD}function isConvertTrialMode(){return mode_===MODE_CONVERT_TRIAL}function isNewSubscriptionMode(){return mode_===MODE_SUBSCRIPTION}function isChangePlanMode(){return mode_===MODE_CHANGE_SUBSCRIPTION_PLAN}function isCreditsMode(){return mode_===MODE_BUY_CREDIT_PACK}function isTrialSubscriptionMode(){return mode_===MODE_SUBSCRIPTION_TRIAL}function isManageCardsPremiumMode(){return mode_===MODE_MANAGE_CARDS_PREMIUM}function isManageCardsMode(){return mode_===MODE_MANAGE_CARDS}function onCheckoutStart_(showLoading){let modal=$("#"+ID_MODAL);isActivePanelCheckoutSummary()?getActivePanel().find(".btn-pay .btn").addClass("-loading"):disableMainCTA_(),showLoading&&setLoading_(i18next.t("pmwjs_processing")),modal.find(".header .modal-header-action.btn-back").addClass("disabled")}function onCheckoutEnd_(){let modal=$("#"+ID_MODAL);isActivePanelCheckoutSummary()?getActivePanel().find(".btn-pay .btn").removeClass("-loading"):enableMainCTA_(),setLoading_(null),modal.find(".header .modal-header-action.btn-back").removeClass("disabled")}function checkWebhookStatus(paymentData){let data,webhookPollingUri;return isDownloadMode()?(webhookPollingUri="cart/hasSuccessfulDownloadPaymentWebhookProcessed",data={chargeId:paymentData.chargeId}):isCreditsMode()?(webhookPollingUri="premium/hasSuccessfulCreditPackPaymentWebhookProcessed",data={chargeId:paymentData.chargeId}):(isNewSubscriptionMode()||isChangePlanMode()||isConvertTrialMode()||isTrialSubscriptionMode())&&(webhookPollingUri="premium/hasSuccessfulSubscriptionPaymentWebhookProcessed",data={invoiceId:paymentData.invoiceId}),PMW.readLocal(webhookPollingUri,data)}function getPostPaymentLoadingSubText(){var langIndex=isDownloadMode()?"pmwjs_transition_to_download_message":"pmwjs_redirect_message",failUrl=invoiceId?PMW.util.site_url("premium/finalizingorder/s?iid="+invoiceId):paymentIntentId_?isDownloadMode()?PMW.util.site_url("cart/finalizingorder?pid="+paymentIntentId_):isNewSubscriptionMode()||isConvertTrialMode()||isChangePlanMode()?PMW.util.site_url("premium/finalizingorder/s?pid="+paymentIntentId_):PMW.util.site_url("premium/finalizingorder/c?pid="+paymentIntentId_):PMW.util.site_url("premium/confirmation");return i18next.t(langIndex,{link:failUrl,time:PAYMENT_POLLING_REDIRECT_LINK_DISABLED_TIME_SECONDS})}function isNewSubscriptionPurchaseWithZeroAmount(){return 0===parseFloat(PMW.checkout.getParams(["amountdue"]).amountdue)&&isNewSubscriptionMode()}async function onSuccessfulStripeConfirmation(){if(isTrialSubscriptionMode()||isNewSubscriptionPurchaseWithZeroAmount())try{await(isTrialSubscriptionMode()?async function(){try{var data=await sendPostStripeConfirmationRequest();invoiceId=data.invoiceId}catch(error){throw void 0!==error.data.trial&&"not_eligible"===error.data.trial?setFormError_(i18next.t("pmwjs_not_eligible_for_another_trial")):setFormError_(i18next.t("pmwjs_entry_valid_info_try_again")),error}}:async function(){try{var data=await sendPostStripeConfirmationRequest();invoiceId=data.invoiceId}catch(error){throw setFormError_(i18next.t("pmwjs_entry_valid_info_try_again")),error}})()}catch(error){return void onCheckoutEnd_()}let data,paymentPollingHtml='<p class="body-l-bold">'+(isDownloadMode()?i18next.t("pmwjs_finalizing_your_order"):isCreditsMode()?i18next.t("pmwjs_finalizing_your_credits"):i18next.t("pmwjs_finalizing_your_subscription"))+'</p><p class="body-s redirect-message">'+getPostPaymentLoadingSubText()+"</p>",modal=$("#"+ID_MODAL);if(isManageCardsMode()||isManageCardsPremiumMode())try{data=await sendPostStripeConfirmationRequest()}catch(error){return onCheckoutEnd_(),void setFormError_(i18next.t("pmwjs_entry_valid_info_try_again"))}else{showModalLoadingState(paymentPollingHtml),setTimeout(function(){modal.find(" .modal-loading-state .redirect-link").removeClass("disabled")},PAYMENT_POLLING_REDIRECT_LINK_DISABLED_TIME_MILISECONDS),modal.find(".modal-loading-state .redirect-link").on(PMW.click,null,PMW.gtm.trackGA4CustomEvent.bind(this,EVENT_ACTION_CLICK_POLLING_LINK,{mode:"mode_"+mode_}));try{data=await(isTrialSubscriptionMode()||isNewSubscriptionPurchaseWithZeroAmount()||invoiceId?PMW.pollingAjaxCallAsync(function(){return invoiceId?new Promise(resolve=>resolve({invoiceId:invoiceId})):new Promise((_,reject)=>reject())},checkWebhookStatus,WEBHOOK_POLLING_REQUEST_TIMEOUT):PMW.pollingAjaxCallAsync(sendPostStripeConfirmationRequest,checkWebhookStatus,WEBHOOK_POLLING_REQUEST_TIMEOUT))}catch(error){return onCheckoutEnd_(),hideModalLoadingState(),void setFormError_(i18next.t("pmwjs_entry_valid_info_try_again"))}}handleSuccessfulCheckout(data),onCheckoutEnd_()}function handleSuccessfulCheckout(data){let cardUpdatedMsgContainer=$("#checkout-card-updated").find(".dialog-message");if(null!==data&&void 0!==data.hostedInvoiceUrl){var hostedInvoiceUrl=data.hostedInvoiceUrl;return $("#"+PANEL_CHECKOUT_AUTH_REQUIRED).find(".hosted-invoice-url").attr("href",hostedInvoiceUrl),setLoading_(null),void show_(PANEL_CHECKOUT_AUTH_REQUIRED)}switch(mode_){case MODE_SUBSCRIPTION_TRIAL:PMW.gtm.trackGA4CustomEvent("TrialStart"),window.location.href=trialReferrer_&&posterHashedId_?PMW.util.site_url("premium/confirmation?referrer="+trialReferrer_+"&hashId="+posterHashedId_):PMW.util.site_url("premium/confirmation");break;case MODE_SUBSCRIPTION:PMW.setCacheItem(PMW.SUBSCRIPTION_PURCHASE_TRACKING_CACHE_KEY,!0,PMW.CACHE_EXPIRY_ONE_HOUR),window.location.href=PMW.util.site_url("premium/confirmation?idSubscriptionPurchase="+data.idSubscriptionPurchase);break;case MODE_CHANGE_SUBSCRIPTION_PLAN:data.ga4PurchaseEventParams&&PMW.gtm.trackGA4PurchaseEvent(data.ga4PurchaseEventParams),window.location.href=PMW.util.site_url("premium/subscriptions");break;case MODE_BUY_CREDIT_PACK:PMW.closeModalDialog(ID_MODAL),data.ga4PurchaseEventParams&&PMW.gtm.trackGA4PurchaseEvent(data.ga4PurchaseEventParams),"pay-with-credits"===creditPurchaseMode_?(setLoading_(i18next.t("pmwjs_processing")),"function"==typeof creditPurchaseCb_&&(PMW.isOldPosterMaker()?facade_.sendNotification(postermywall.Core.SAVE,{callback:creditPurchaseCb_,callbackHasRedirect:!0}):PMW.isReactPosterMaker()?window.posterEditor&&window.posterEditor.whiteboard?window.posterEditor.whiteboard.savePoster.save().then(creditPurchaseCb_):$.noop():creditPurchaseCb_())):PMW.isPosterMaker()?"function"==typeof successCallback_?successCallback_(data):PMW.closeModalDialog(ID_MODAL):"function"==typeof successCallback_?successCallback_(data):window.location.href=PMW.util.site_url("premium/subscriptions?cpp=success");break;case MODE_MANAGE_CARDS:cardUpdatedMsgContainer.html(i18next.t("pmwjs_card_added_message",{brand:data.brand,last4:data.last4})),show_(PANEL_CHECKOUT_CARD_UPDATED,FLOW_FORWARD);break;case MODE_MANAGE_CARDS_PREMIUM:let brand=data.brand,last4=data.last4,brandIconEl=$(".js-brand-icon"),last4El=$(".js-last4");isLegacy_?cardUpdatedMsgContainer.html(i18next.t("pmwjs_billing_added_to_card",{brand:brand,last4:last4})):cardUpdatedMsgContainer.html(i18next.t("pmwjs_card_set_as_default",{brand:brand,last4:last4})),last4El.html(last4),brandIconEl.removeClass().addClass(`size-icon-20 spacing-m-r-4 js-brand-icon ${data.icon}`),show_(PANEL_CHECKOUT_CARD_UPDATED,FLOW_FORWARD);break;case MODE_CONVERT_TRIAL:PMW.setCacheItem(PMW.SUBSCRIPTION_PURCHASE_TRACKING_CACHE_KEY,!0,PMW.CACHE_EXPIRY_ONE_HOUR),successCallback_?successCallback_(data):window.location.href=PMW.util.site_url("premium/confirmation?invite=1&idSubscriptionPurchase="+data.idSubscriptionPurchase);break;default:if(isDownloadMode()&&(PMW.trackOnlineAdsEvent(PMW.gtm.ONLINE_ADS_EVENT_TYPE_DOWNLOAD_PURCHASE,data.orderType,data.orderValue),data.ga4PurchaseEventParams&&PMW.gtm.trackGA4PurchaseEvent(data.ga4PurchaseEventParams)),"function"==typeof successCallback_)PMW.closeModalDialog(ID_MODAL),successCallback_(data);else{let segmentParams="";data.idOrder&&(segmentParams="/"+data.idOrder),window.location.href=PMW.util.site_url("cart/downloadOrdered"+segmentParams)}}}function onCardFormSubmit_(e){let name=$("#checkout-cardholder-name"),panelAddCard=$("#checkout-add-card"),modal=$("#checkout-modal");if(e.preventDefault(),!validateInput_(name,i18next.t("pmwjs_enter_card_name")))return updateCardValidationInformation_("cardholderName",!1),void panelAddCard.find(".placeholder").addClass("_hidden");updateCardValidationInformation_("cardholderName",!0);var isCardPaymentInfoValid=cardValidations_.cardPaymentInfo;if(cardValidations_.cardholderName&&isCardPaymentInfoValid)return setFormError_(""),void(isTrialSubscriptionMode()||isManageCardsMode()||isManageCardsPremiumMode()?(disableMainCTA_(),confirmCardSetupOnStripe()):showSummaryPanel(panelAddCard,modal));isCardPaymentInfoValid||(panelAddCard.find(".placeholder").addClass("_hidden"),setFormError_(i18next.t("pmwjs_enter_card_payment_info")))}function updateCardValidationInformation_(field,setTo){void 0!==cardValidations_[field]&&(cardValidations_[field]=setTo)}function paypalCheckoutSuccess_(r){var data,segmentParams;r.status===STATUS_SUCCESS?(data=r.data,isDownloadMode()&&(PMW.trackOnlineAdsEvent(PMW.gtm.ONLINE_ADS_EVENT_TYPE_DOWNLOAD_PURCHASE,data.orderType,data.orderValue),"function"==typeof successCallback_?(PMW.closeModalDialog(ID_MODAL),successCallback_(data)):(segmentParams="",data.idOrder&&(segmentParams="/"+data.idOrder),window.location.href=PMW.util.site_url("cart/downloadOrdered"+segmentParams)))):handlePaypalError_(r.code)}function handlePaypalError_(code){if(code)switch(code){case"credit_card_cvv_check_fail":alert(i18next.t("pmwjs_card_security_code_incorrect"));break;case"credit_card_refused":alert(i18next.t("pmwjs_card_declined"));break;case"currency_not_allowed":alert(i18next.t("pmwjs_currency_not_allowed"));break;case"insufficient_funds":alert(i18next.t("pmwjs_insufficient_funds"));break;case"payment_expired":alert(i18next.t("pmwjs_payment_expired"));break;default:alert(i18next.t("pmwjs_error_reload_page"))}else alert(i18next.t("pmwjs_error_reload_page"))}function handleStripeError(error){let errorType=error.type,errorCode=error.code,message=i18next.t("pmwjs_error_processing_card_not_charged");if("card_error"===errorType){if(paymentFailedCallback)return PMW.closeModalDialog(ID_MODAL),onCheckoutEnd_(),void paymentFailedCallback();switch($("#checkout-add-card").find(".placeholder").addClass("_hidden"),errorCode){case"invalid_number":message=i18next.t("pmwjs_card_number_not_valid");break;case"invalid_expiry_month":message=i18next.t("pmwjs_card_expiration_month_invalid");break;case"invalid_expiry_year":message=i18next.t("pmwjs_card_expiration_year_invalid");break;case"invalid_cvc":message=i18next.t("pmwjs_card_security_code_incorrect");break;case"expired_card":message=i18next.t("pmwjs_card_expired");break;case"card_declined":message=i18next.t("pmwjs_card_declined")}}setFormError_(message),onCheckoutEnd_()}function sendPostStripeConfirmationRequest(){let params={},requestUri="";if(setupIntentId_)isTrialSubscriptionMode()?(requestUri="premium/confirmTrialSubscriptionSetupIntent",params=PMW.checkout.getParams(["id","promo"])):isNewSubscriptionMode()?(requestUri="premium/confirmSetupIntentForZeroAmountSubscription",params=PMW.checkout.getParams(["id","promo"])):(isManageCardsPremiumMode()||isManageCardsMode())&&(requestUri="premium/confirmManageCardsSetupIntent",params={setCardAsDefault:isManageCardsPremiumMode()||isNewSubscriptionMode()?1:0}),params={setupIntentId:setupIntentId_,idBilling:getCurrentlySelectedBillingAddressId(),...params};else{if(!paymentIntentId_)return PMW.log("Error sending request to server after stripe's confirmation request: no payment intent or setup intent ID found"),new Promise((_,reject)=>reject());requestUri=isDownloadMode()?"cart/getChargeIdFromPaymentIntent":isCreditsMode()?"premium/getChargeIdFromPaymentIntent":"premium/getInvoiceIdFromPaymentIntent",params={paymentIntentId:paymentIntentId_,...params}}return PMW.readLocal(requestUri,params)}function getCurrentlySelectedCardVendorId(){let card=$("#"+ID_MODAL+" .payment-card.-selected");return card.attr("data-vendor-id")}function onErrorFetchingBillingDetailsObject(errorMessage){flowBackwardToSelectBillingAddressPanel(),setFormError_(errorMessage),onCheckoutEnd_()}function performStripeConfirmationViaCardId(confirmationFunction){function onRequestError(){stripeCheckoutGenericError_(),onCheckoutEnd_()}loadStripeJS().then(function(){sendClientSecretGenerationRequest().then(function(){null!==paymentIntentId_||null!==setupIntentId_?confirmationFunction(getCurrentlySelectedCardVendorId()).then(onSuccessfulStripeConfirmation).catch(handleStripeError).finally(resetPaymentElementVariables):onRequestError()}).catch(onRequestError)}).catch(onRequestError)}function confirmPaymentOnStripe(){getCurrentlySelectedCardVendorId()||paymentElement_?(onCheckoutStart_(!0),paymentElement_?getCurrentlySelectedBillingDetailsObject().then(function(billingDetailsObject){!function(billingDetails){let params=getParamsForStripeConfirmationUsingPaymentElement(billingDetails);return new Promise((resolve,reject)=>{stripe_.confirmPayment(params).then(function(result){result.error?reject(result.error):resolve()})})}(billingDetailsObject).then(onSuccessfulStripeConfirmation).catch(handleStripeError)}).catch(onErrorFetchingBillingDetailsObject):performStripeConfirmationViaCardId(confirmPaymentOnStripeUsingPaymentMethodId)):setFormError_(i18next.t("pmwjs_select_card_first"))}function confirmCardSetupOnStripe(){getCurrentlySelectedCardVendorId()||paymentElement_?(onCheckoutStart_(!0),paymentElement_?getCurrentlySelectedBillingDetailsObject().then(function(billingDetailsObject){!function(billingDetails){let params=getParamsForStripeConfirmationUsingPaymentElement(billingDetails);return new Promise((resolve,reject)=>{stripe_.confirmSetup(params).then(function(result){result.error?reject(result.error):resolve()})})}(billingDetailsObject).then(onSuccessfulStripeConfirmation).catch(handleStripeError)}).catch(onErrorFetchingBillingDetailsObject):performStripeConfirmationViaCardId(confirmSetupIntentOnStripeUsingPaymentMethodId)):setFormError_(i18next.t("pmwjs_select_card_first"))}function getCurrentlySelectedBillingDetailsObject(){const cardholderName=$("#checkout-cardholder-name").val(),idBilling=getCurrentlySelectedBillingAddressId(),billingAddress=$("#checkout-select-billing-address").find('.address[data-id="'+idBilling+'"]');let countryCode=billingAddress.attr("data-country-code"),billingAddressObject={address:{city:billingAddress.find(".city").text(),state:billingAddress.find(".region").text(),line1:billingAddress.find(".address1").text(),line2:billingAddress.find(".address2").text(),postal_code:billingAddress.find(".postalCode").text()},name:cardholderName};return removeValidationErrorMessages($("#"+PANEL_CHECKOUT_SELECT_BILLING_ADDRESS).find(".field")),new Promise((resolve,reject)=>{countryCode&&void 0!==countryCode&&""!==countryCode?(billingAddressObject.address.country=countryCode,resolve(billingAddressObject)):reject(i18next.t("pmwjs_address_invalid_country_code"))})}function getParamsForStripeConfirmationUsingPaymentElement(billingDetails){return{elements:stripeElements,redirect:"if_required",confirmParams:{payment_method_data:{billing_details:billingDetails}}}}function confirmSetupIntentOnStripeUsingPaymentMethodId(card){return new Promise((resolve,reject)=>{stripe_.confirmCardSetup(clientSecret_,{payment_method:card}).then(function(result){result.error?reject(result.error):resolve()})})}function confirmPaymentOnStripeUsingPaymentMethodId(paymentMethodId){return new Promise((resolve,reject)=>{stripe_.confirmCardPayment(clientSecret_,{payment_method:paymentMethodId}).then(function(result){result.error?reject(result.error):resolve()})})}function stripeCheckoutGenericError_(){setFormError_(i18next.t("pmwjs_error_processing_request_reload_try_again"))}function onSelectItem_(){var el=$(this),card=$(".payment-card.-selected");if(el.hasClass("-expandable")&&el.hasClass("-selected")&&!isManageCardsMode())el.removeClass("-selected"),disableMainCTA_(),this.classList.contains("address")&&("1"===card.attr("data-needs-billing")&&card.attr("data-id-billing","-1"),idBillingAddress_=-1);else{if(el.hasClass("-expandable")){for(var list=el.parent(),items=el.parent().children(),height=0,i=0;i<items.length;i++)if(!$(items[i]).hasClass("-selected")){height=$(items[i]).outerHeight(!0);break}list.animate({scrollTop:items.index(el)*height},250)}el.addClass("-selected").siblings().removeClass("-selected"),"payment-card"===el.attr("data-list-item-type")?("1"===el.attr("data-needs-billing")?(el.closest(".panel").find(".btn").removeClass("disabled"),el.closest(".panel").find(".btn .btn-text").text(i18next.t("pmwjs_add_billing_address")),idBillingAddress_=-1):(el.closest(".panel").find(".btn").removeClass("disabled"),idBillingAddress_=parseInt(el.attr("data-id-billing")),isManageCardsMode()?el.closest(".panel").find(".btn .btn-text").text(i18next.t("pmwjs_close")):isManageCardsPremiumMode()?el.closest(".panel").find(".btn .btn-text").text(i18next.t("pmwjs_use_selected_card")):isTrialSubscriptionMode()?el.closest(".panel").find(".btn .btn-text").text(i18next.t("pmwjs_start_trial")):el.closest(".panel").find(".btn .btn-text").text(i18next.t("pmwjs_continue"))),0<el.find(".expired").length&&disableMainCTA_()):"address"===el.attr("data-list-item-type")?(el.closest(".panel").find(".btn").removeClass("disabled"),"1"===card.attr("data-needs-billing")&&card.attr("data-id-billing",el.attr("data-id")),idBillingAddress_=parseInt(el.attr("data-id"))):enableMainCTA_()}}function onDeleteItem_(e){e.stopPropagation();var item=$(this).closest(".list-item");switch(item.attr("data-list-item-type")){case"payment-card":!function(card){card.addClass("-deleting").removeClass("-selected"),setLoading_(i18next.t("pmwjs_deleting")),PMW.write(PMW.util.site_url("premium/deleteUserCreditCard"),{id:card.attr("data-id")}).done((function(card,r){{var modal,dataCards;r.status===STATUS_SUCCESS?(modal=$("#"+ID_MODAL),card.addClass("-deleted"),setTimeout((function(card,defaultId){card.remove();var cards=$("#"+ID_MODAL).find(".payment-card");0===cards.length?(flowBackwardToAddCardPanel(),setTimeout(function(){$("#checkout-add-card-form").find(".field").first().find("input").focus()},400)):cards.is(".-selected")||(defaultId?cards.filter('[data-id="'+defaultId+'"]'):cards.first()).addClass("-selected")}).bind(this,card,r.data&&r.data.defaultId?r.data.defaultId:null),350),dataCards=parseInt(modal.find(".panels").attr("data-cards"))-1,modal.find(".panels").attr("data-cards",dataCards)):r.status===STATUS_ERROR&&r.code&&r.message&&0<r.message.length?deleteCardError_(card,r.message):deleteCardError_(card,null)}}).bind(this,card)).fail(deleteCardError_.bind(this,card,null)).always(function(){setLoading_(null)})}(item);break;case"address":!function(address){address.addClass("-deleting"),setLoading_(i18next.t("pmwjs_deleting")),PMW.write(PMW.util.site_url("user/deleteAddress"),{id:address.attr("data-id")}).done((function(address,r){if(r.status===STATUS_SUCCESS){var modal=$("#"+ID_MODAL);address.addClass("-deleted"),setTimeout((function(address){var addresses=$("#"+ID_MODAL).find(".address");$("#checkout-select-billing-address").find(".address[data-id="+address.attr("data-id")+"]").remove(),0===addresses.length?(flowForwardToAddAddressPanel(),setTimeout(function(){$("#checkout-add-address-form").find(".field").first().find("input").focus()},400)):addresses.is(".-selected")||addresses.first().addClass("-selected")}).bind(this,address),350),$("#checkout-select-billing-address").find(".address[data-id="+address.attr("data-id")+"]").hasClass("-selected")&&disableMainCTA_();var card=null;if(0<r.data.cardIds.length)for(var i=0;i<r.data.cardIds.length;i++)(card=$("#checkout-quick").find('.payment-card[data-id="'+r.data.cardIds[i]+'"]')).find(".panel-content").remove(),card.append('<div class="panel-content"><div class="billing-not-found region-open">'+i18next.t("pmwjs_checkout_no_billing_address")+"</div></div>"),card.attr("data-needs-billing","1"),card.attr("data-id-billing","-1");var dataAddresses=parseInt(modal.find(".panels").attr("data-addresses"))-1;modal.find(".panels").attr("data-addresses",dataAddresses)}else r.status===STATUS_ERROR&&r.code&&r.message&&0<r.message.length?deleteAddressError_(address,r.message):deleteAddressError_(address,null)}).bind(this,address)).fail(deleteAddressError_.bind(this,address,null)).always(function(){setLoading_(null)})}(item)}}function deleteCardError_(card,message){message=message||i18next.t("pmwjs_error_deleting_card"),card.removeClass("-deleting").find(".-confirm-state").removeClass("-confirm-state"),setFormError_(message,null)}function getCTAText_(params){return isManageCardsPremiumMode()?i18next.t("pmwjs_use_selected_card"):isManageCardsMode()?i18next.t("pmwjs_close"):params.price?i18next.t("pmwjs_pay_price",{price:params.price}):i18next.t("pmwjs_pay_now")}function initUI_(panels,modal,params){"1"===panels.attr("data-no-cards")&&modal.addClass("-no-cards");var checkoutAddCardPayButton="premium"===panels.attr("data-usertype");if($("#checkout-address-country-code").on("change",onAddressCountryChange),$("#checkout-edit-address-country-code").on("change",onAddressCountryChange),"1"===panels.attr("data-first-panel"))switch(mode_){case MODE_BUY_CREDIT_PACK:show_(PANEL_CHECKOUT_BUY_CREDITS);break;case MODE_CONVERT_TRIAL:show_(PANEL_CHECKOUT_CONVERT_TRIAL_MESSAGE);break;default:showQuickCheckoutPanel()}isDownloadMode()&&checkoutAddCardPayButton||isNewSubscriptionMode()||isTrialSubscriptionMode()||isManageCardsPremiumMode()||isManageCardsMode()||isChangePlanMode()?(areAddressesAvailable()?areCardsAvailable()?showQuickCheckoutPanel():show_(PANEL_CHECKOUT_SELECT_BILLING_ADDRESS):isDownloadMode()&&!checkoutAddCardPayButton?show_(PANEL_CHECKOUT_OPTIONS):(show_(PANEL_CHECKOUT_ADD_ADDRESS),$("#checkout-add-card-form").find("input").val("")),isTrialSubscriptionMode()?panels.find(".btn-pay .btn-pay-now-cta").html(i18next.t("pmwjs_start_trial")):panels.find(".btn-pay .btn-pay-now-cta").html(getCTAText_(params)),checkoutAddCardPayButton=$("#checkout-add-card").find(".btn-pay .btn-pay-now-cta"),isManageCardsPremiumMode()?checkoutAddCardPayButton.html(i18next.t("pmwjs_use_new_card")):isManageCardsMode()&&checkoutAddCardPayButton.html(i18next.t("pmwjs_add_new_card"))):isCreditsMode()||isConvertTrialMode()||(isDownloadMode()&&panels.find(".btn-pay .btn-pay-now-cta").html(getCTAText_(params)),suppressPayPalError_=!0,show_(PANEL_CHECKOUT_OPTIONS)),summary_=params.summary||{}}function showSummaryPanel(panel,modal){var controller,id=PMW.checkout.getParams(["id"]).id,price=PMW.checkout.getParams(["price"]).price,amountDue=parseFloat(PMW.checkout.getParams(["amountdue"]).amountdue),discount=PMW.checkout.getParams(["discount"]).discount,params={idBilling:getCurrentlySelectedBillingAddressId()};disableMainCTA_(),null!==paymentIntentId_&&(params.paymentIntentId=paymentIntentId_),isDownloadMode()?(controller="cart/calculateTaxForCart",params.cartId=id):(isConvertTrialMode()?controller="premium/calculateTaxForTrialConversion":(controller="premium/calculateTaxForOrder",params.spid=id,isCreditsMode()&&(params.idCreditPack=$("#buy-credits").find(".credit.-selected").attr("data-id"),summary_.isCreditPackPurchase=1),params.isChangePlan=isChangePlanMode()?1:0,params.amountDue=amountDue,params.promo=PMW.checkout.getParams(["promo"]).promo,params.discount=discount,params.seats=PMW.checkout.getParams(["seats"]).seats,summary_.discount=discount),summary_.amountDue=amountDue,summary_.price=price),PMW.setLoading(i18next.t("pmwjs_please_wait")),$.get(PMW.util.site_url(controller),params,function(r){var unusedTimeAmount;PMW.setLoading(null),enableMainCTA_(),r.status===STATUS_SUCCESS?(summary_.orderTax=parseFloat(r.data.tax),r.data.productName&&(summary_.productName=r.data.productName),r.data.currentPlanName&&(summary_.currentPlanName=r.data.currentPlanName),(unusedTimeAmount=PMW.checkout.getParams(["remainingTimeAmount"]).remainingTimeAmount)&&0<parseFloat(unusedTimeAmount)?summary_.productPrice=parseFloat(unusedTimeAmount):r.data.productPrice&&0<r.data.productPrice&&(summary_.productPrice=r.data.productPrice),(unusedTimeAmount=PMW.checkout.getParams(["unusedTimeAmount"]).unusedTimeAmount)&&0<parseFloat(unusedTimeAmount)?summary_.unusedTime=parseFloat(unusedTimeAmount):summary_.unusedTime=0,r.data.orderTotal?summary_.orderTotal=0<r.data.orderTotal?parseFloat(r.data.orderTotal):0:summary_.orderTotal=0,r.data.promo&&modal.attr("data-param-promo",r.data.promo),summary_.currencyCode=r.data.currencyCode):(summary_.orderTax=0,summary_.productName="",summary_.unusedTime=0,summary_.orderTotal=0),suppressPayPalError_=!0,show_(PANEL_CHECKOUT_SUMMARY,FLOW_FORWARD)})}function onAddressCountryChange(e){var selCountry=$(e.currentTarget),regionStates=selCountry.closest(".panel"),regionInpt=regionStates.find(".region-open"),regionStates=regionStates.find(".region-states");"US"===selCountry.val()?(regionInpt.addClass("_hidden"),regionStates.removeClass("_hidden")):(regionInpt.removeClass("_hidden"),regionStates.addClass("_hidden"))}function validateInput_(el,msg){if(0!==$.trim(el.val()).length)return 1;setFormError_(msg,el)}function onSubmitNewAddress_(e){var name,address1,address2,city,countryCode,region,postalCode,phone=$(this).find(".field");e.preventDefault(),getActivePanelId()===PANEL_CHECKOUT_ADD_ADDRESS&&(removeValidationErrorMessages(phone),name=$("#checkout-address-name"),address1=$("#checkout-address-line1"),address2=$("#checkout-address-line2"),city=$("#checkout-address-city"),region="US"===(countryCode=$("#checkout-address-country-code")).val()?$("#checkout-address-region-states"):$("#checkout-address-region"),postalCode=$("#checkout-address-postal-code"),phone=$("#checkout-address-phone"),validateAddress(name,address1,city,region,postalCode,countryCode)?$("#checkout-add-address-form").find(".field-wrapper").addClass("-error"):($("#checkout-add-address-form").find(".field-wrapper").removeClass("-error"),disableMainCTA_(),PMW.write(PMW.util.site_url("user/addAddress"),{name:$.trim(name.val()),address1:$.trim(address1.val()),address2:$.trim(address2.val()),city:$.trim(city.val()),region:$.trim(region.val()),postalCode:$.trim(postalCode.val()),countryCode:countryCode.val(),phone:$.trim(phone.val())}).done(onAddAddressSuccess_).fail(onAddAddressFail_).always(enableMainCTA_)))}function onSubmitEditedAddress_(){let form=$(this),fieldWrappers=form.find(".field-wrapper"),fields=form.find(".field"),addressId=idBillingAddress_,btn=form.find(".btn");removeValidationErrorMessages(fields);var name=$("#checkout-edit-address-name"),address1=$("#checkout-edit-address-line1"),address2=$("#checkout-edit-address-line2"),city=$("#checkout-edit-address-city"),countryCode=$("#checkout-edit-address-country-code"),region="US"===countryCode.val()?$("#checkout-edit-address-region-states"):$("#checkout-edit-address-region"),postalCode=$("#checkout-edit-address-postal-code"),phone=$("#checkout-edit-address-phone");return validateAddress(name,address1,city,region,postalCode,countryCode)?fieldWrappers.addClass("-error"):(fieldWrappers.removeClass("-error"),setLoading_(i18next.t("pmwjs_processing")),btn.addClass("disabled"),PMW.write(PMW.util.site_url("user/editAddress"),{id:addressId,name:$.trim(name.val()),address1:$.trim(address1.val()),address2:$.trim(address2.val()),city:$.trim(city.val()),region:$.trim(region.val()),postalCode:$.trim(postalCode.val()),countryCode:countryCode.val(),phone:$.trim(phone.val()),idCard:idCardBeingEdited_}).done(onEditAddressSuccess_).fail(onAddAddressFail_).always(function(){PMW.setLoading(null),btn.removeClass("disabled")})),!1}function validateAddress(name,address1,city,region,postalCode,countryCode){var error=!1;return validateInput_(name,getAddressValidationErrorMessage())||(error=!0),validateInput_(address1,getAddressValidationErrorMessage())||(error=!0),validateInput_(city,getAddressValidationErrorMessage())||(error=!0),validateInput_(region,getAddressValidationErrorMessage())||(error=!0),"0"===region.val()&&(setFormError_(getAddressValidationErrorMessage(),region),error=!0),validateInput_(postalCode,getAddressValidationErrorMessage())||(error=!0),error=!validateInput_(countryCode,getAddressValidationErrorMessage())?!0:error}function removeValidationErrorMessages(fields){setFormError_(""),fields.removeClass("danger")}function onAddAddressSuccess_(r){var modal,panels,dataAddresses,card,el,list;r.status===STATUS_SUCCESS&&r.data&&r.data.address?(modal=$("#"+ID_MODAL),el=r.data.address,panels=modal.find(".panels"),list=$("#"+PANEL_CHECKOUT_SELECT_BILLING_ADDRESS),dataAddresses=parseInt(panels.attr("data-addresses"))+1,card=$(".payment-card.-selected"),panels.scrollTop(0),addAddressItem_(el),panels.attr("data-addresses",dataAddresses),idBillingAddress_=parseInt(el.id),(el=list.find('.address[data-id="'+idBillingAddress_+'"]')).addClass("-selected").siblings().removeClass("-selected"),"1"===card.attr("data-needs-billing")&&card.attr("data-id-billing",idBillingAddress_),(list=list.find(".list")).animate({scrollTop:el.position().top-list.position().top+list.scrollTop()},250),isCheckingOutUsingPaypal()?flowForwardToSelectBillingAddressPanel():cardType_===CARDTYPE_EXISTING&&areCardsAvailable()&&isBillingAddressNeededForSelectedCard()?flowBackwardToSelectBillingAddressPanel():isCheckingOutUsingNewCard()?(isEmailAddressRequired()?flowForwardToEmailRequiredPanel:flowForwardToAddCardPanel)():cardType_!==CARDTYPE_EXISTING||isCheckingOutUsingPaypal()||showSummaryPanel(modal.find("#"+PANEL_CHECKOUT_ADD_ADDRESS),modal)):r.status===STATUS_FAIL&&setFormError_(getAddressValidationErrorMessage())}function onEditAddressSuccess_(r){var modal,address,list,isNewAddress,checkoutQuickPanel,card;r.status===STATUS_SUCCESS&&r.data&&r.data.address?(modal=$("#"+ID_MODAL),checkoutQuickPanel=$("#checkout-select-billing-address"),address=r.data.address,list=checkoutQuickPanel.find(".list"),card=parseInt(r.data.cardId),isNewAddress=r.data.isNewAddress,modal.find(".panels").scrollTop(0),idBillingAddress_=parseInt(address.id),editBillingFromCard_?(flowBackwardToQuickCheckoutPanel(),editBillingFromCard_=!1):flowBackwardToSelectBillingAddressPanel(),isNewAddress?addAddressItem_(address):function(address,oldAddressId){var addressItem=address.id;addressItem!==oldAddressId&&(addressItem=oldAddressId);addressItem=$("#checkout-select-billing-address").find('.address[data-id="'+addressItem+'"]');addressItem.find(".contact-name").text(address.contactName),addressItem.find(".address1").text(address.streetAddress1),addressItem.find(".address2").text(address.streetAddress2),addressItem.find(".city").text(address.city),addressItem.find(".region").text(address.region),addressItem.find(".countryCode").text(address.countryCode),addressItem.find(".postalCode").text(address.postalCode),addressItem.find(".phone").text(address.phone),addressItem.attr("data-id",address.id),addressItem.attr("data-country-code",address.countryCode)}(address,r.data.oldAddressId),(checkoutQuickPanel=checkoutQuickPanel.find('.address[data-id="'+address.id+'"]')).addClass("-selected").siblings().removeClass("-selected"),scrollItemInView_(list,checkoutQuickPanel),!card||0<(card=(checkoutQuickPanel=$("#checkout-quick")).find('.payment-card[data-id="'+card+'"]')).length&&(card.attr("data-id-billing",address.id),card.find(".card-address-name").text(address.contactName),card.find(".card-address-line1").text(address.streetAddress1),card.find(".card-address-line2").text(address.streetAddress2),card.find(".card-address-city").text(address.city),card.find(".card-address-region").text(address.region),scrollItemInView_(checkoutQuickPanel.find(".list"),card))):r.status===STATUS_FAIL?setFormError_(getAddressValidationErrorMessage()):r.status===STATUS_ERROR&&alert(r.message)}function addAddressItem_(address){$("#"+PANEL_CHECKOUT_SELECT_BILLING_ADDRESS).find(".addresses").append('<li class="list-item address -expandable" data-id="'+address.id+'" data-list-item-type="address" data-country-code="'+address.countryCode+'"><div class="panel-top"><i class="icon-check status"></i><div class="address-detail"><span class="contact-name">'+address.contactName+'</span> <span class="address-preview">'+address.streetAddress1+" "+address.streetAddress2+" "+address.city+", "+address.region+" "+address.postalCode+" "+address.countryCode+" "+address.phone+'</span></div><div class="delete-options"><i class="icon-delete btn-delete" title="'+i18next.t("pmwjs_remove_this_address")+'"></i><div class="confirm-delete"><i class="icon-check btn-confirm-delete"></i><i class="icon-close btn-cancel-delete"></i></div><i class="icon-pencil btn-edit-address" title="'+i18next.t("pmwjs_edit_details_address")+'"></i></div><i class="expand-icon"></i></div><div class="panel-content"><span class="address1">'+address.streetAddress1+'</span> <span class="address2">'+address.streetAddress2+'</span><br><span class="city">'+address.city+'</span>, <span class="region">'+address.region+'</span><br><span class="countryCode">'+address.countryCode+'</span>, <span class="postalCode">'+address.postalCode+'</span><br><span class="phone">'+address.phone+"</span></div></li>")}function scrollItemInView_(list,el){list.animate({scrollTop:el.position().top-list.position().top+list.scrollTop()},250)}function onAddAddressFail_(){alert(i18next.t("pmwjs_error_try_again_reload_page"))}function getAddressValidationErrorMessage(){return i18next.t("pmwjs_address_validation_error_message")}function onApplyPromo_(){var promocode=$(".promocode-box .inpt-promo-code").val().trim(),params=PMW.checkout.getParams(["id","posterHash","idproduct"]),modal=$("#"+ID_MODAL),errorEl_=modal.find(".promo-error"),discountRow=modal.find(".order-total .discount-row"),taxRow=modal.find(".order-total .tax"),btnApplyPromo=modal.find(".btn-apply-promocode"),btnPay=modal.find(".btn-pay");function showErrorMessage(el,message){el.hasClass("_hidden")&&el.removeClass("_hidden").addClass("-up"),el.html(message),setTimeout(function(){resetSummaryPanelPromoErrorMessage(modal)},1e4)}0<promocode.length?(disableMainCTA_(),btnApplyPromo.addClass("disabled"),setLoading_(i18next.t("pmwjs_processing")),$.get(PMW.util.site_url("cart/applyPromo"),{promotioncode:promocode,posterHash:params.posterHash,idProduct:params.idproduct,cartId:params.id,idBilling:idBillingAddress_,paymentIntentId:paymentIntentId_},function(r){if(setLoading_(null),enableMainCTA_(),btnApplyPromo.removeClass("disabled"),"success"===r.status){if(void 0!==r.data.freeCheckout)return PMW.closeModalDialog(ID_MODAL),void successCallback_(r.data.freeCheckout);var errorMessage=Math.round(100*r.data.discountedPrice)/100,discountAmount=Math.round(100*r.data.beforeDiscountPrice)/100-errorMessage,tax=r.data.tax,errorMessage=PMW.util.currencyFormat(errorMessage+tax,r.data.currencyCode);summary_.orderTax=tax,summary_.discount=discountAmount,summary_.promocode=r.data.promotion.code,modal.attr("data-param-price",errorMessage),discountRow.removeClass("_hidden"),discountRow.find(".name").html(i18next.t("pmwjs_discount_x",{promo:summary_.promocode})),discountRow.find(".amount").html("-"+PMW.util.currencyFormat(discountAmount,r.data.currencyCode)),0<summary_.orderTax?(taxRow.find(".amount").html(PMW.util.currencyFormat(summary_.orderTax,r.data.currencyCode)),taxRow.removeClass("_hidden")):taxRow.addClass("_hidden"),modal.find(".total .price").html(errorMessage),modal.find(".promocode-field").addClass("close"),modal.find(".promocode-option").addClass("_hidden"),modal.find(".modal-content").removeClass("-has-promo"),btnPay.find(".btn-pay-now-cta").html(getCTAText_({price:errorMessage})),errorEl_.hasClass("_hidden")||errorEl_.addClass("_hidden").removeClass("-up")}else{errorMessage=0<r.data.message.length?r.data.message:i18next.t("pmwjs_enter_valid_promo");showErrorMessage(errorEl_,errorMessage)}})):showErrorMessage(errorEl_,i18next.t("pmwjs_enter_valid_promo"))}function onKeyUpOnPromoCodeField(e){13===e.which&&onApplyPromo_()}function deleteAddressError_(address,message){message=message||i18next.t("pmwjs_error_deleting_address"),address.removeClass("-deleting").find(".-confirm-state").removeClass("-confirm-state"),setFormError_(message,null)}function loadStripeJS(){return new Promise((resolve,reject)=>{"undefined"==typeof Stripe?$.getScript("https://js.stripe.com/v3/").done(function(){stripe_=Stripe(PMW.STRIPE_PUBLIC_KEY),resolve()}).fail(function(xhr,status){PMW.log("Unable to load StripeJS from https://js.stripe.com/v3. XHR Status: "+status),reject()}):resolve()})}function onCheckoutFail(){alert(i18next.t("pmwjs_error_reload_page"))}function setDialogView(modal,view){view===DIALOG_VIEW_MODE_PAYPAL?isCheckingOutUsingPaypal()||(dialogView_=view,modal.find(".paypal-hide").addClass("_hidden"),modal.find(".paypal-show").removeClass("_hidden")):isCheckingOutUsingPaypal()&&(dialogView_="",modal.find(".paypal-hide").removeClass("_hidden"),modal.find(".paypal-show").addClass("_hidden"))}function openCheckoutDialog(params){let modal=PMW.openModalDialog(ID_MODAL,isManageCardsPremiumMode()?isLegacy_?i18next.t("pmwjs_update_billing_address"):i18next.t("pmwjs_choose_card_for_sub_payments"):isManageCardsMode()?i18next.t("pmwjs_manage_credit_debit_card"):isCreditsMode()?i18next.t("pmwjs_buy_credits"):isConvertTrialMode()?i18next.t("pmwjs_purchase_subscription"):i18next.t("pmwjs_checkout"),null,mode_!==MODE_DOWNLOAD,"-flex"+(PMW.isPosterMaker()?" -postermaker":"")),c=modal.find(".content"),panels=c.find(".panels");if(showModalLoadingState("<p>"+i18next.t("pmwjs_checkout_loading_message")+"</p>"),setDialogView(modal),params)for(var prop in params)params.hasOwnProperty(prop)&&modal.attr("data-param-"+prop,params[prop]);else params={};0===panels.length?(modal.on("modal:close",PMW.checkout.onModalClose),PMW.load(c,PMW.util.site_url("cart/checkoutDialog"),{mode:mode_,isPosterMaker:PMW.isPosterMaker()?1:0,priceInCredits:null,trialConversionMode:params.trialConversionMode||null},function(response,status,xhr){return status===STATUS_ERROR?(alert(i18next.t("pmwjs_error_reload_page")),PMW.log("Error loading checkout dialog."+xhr.status+" "+xhr.statusText),void PMW.closeModalDialog(ID_MODAL)):void onCheckoutDialogLoaded(params)})):initUI_(panels,modal,params)}function resetPaymentElementVariables(){stripeElements=paymentElement_=setupIntentId_=invoiceId=paymentIntentId_=clientSecret_=null}return{MODE_DOWNLOAD:"download",MODE_SUBSCRIPTION:"subscription",MODE_SUBSCRIPTION_TRIAL:"subscription-trial",MODE_CONVERT_TRIAL:"convert-trial",MODE_BUY_CREDIT_PACK:"buy-credits",MODE_MANAGE_CARDS_PREMIUM:"manage-premium",MODE_MANAGE_CARDS:"manage",MODE_CHANGE_SUBSCRIPTION_PLAN:"change-subscription-plan",showCheckoutDialog:function(mode,params,facade){PMW.isStudent()?alert(i18next.t("pmwjs_students_cannot_make_purchases")):(mode_=mode,resetPaymentElementVariables(),void 0!==params&&"function"==typeof params.cb&&(successCallback_=params.cb,delete params.cb),void 0!==params&&"function"==typeof params.onCheckoutFailCallback&&(paymentFailedCallback=params.onCheckoutFailCallback,delete params.onCheckoutFailCallback),isTrialSubscriptionMode()&&params.referrer&&params.url&&(trialReferrer_=params.referrer,posterHashedId_=params.url.split("/").pop()),isCreditsMode()&&(params&&"pay-with-credits"===params.mode?(creditPurchaseMode_=params.mode,params.pid,"function"==typeof params.creditPurchaseCallBack&&(creditPurchaseCb_=params.creditPurchaseCallBack,delete params.creditPurchaseCallBack),params.hid&&(posterHashedId_=params.hid)):creditPurchaseMode_=posterHashedId_=""),params&&"function"==typeof params.onCloseCallBack&&(onCloseCallback_=params.onCloseCallBack,delete params.onCloseCallBack),facade_=facade||null,openCheckoutDialog(params))},onModalClose:function(){null!==onCloseCallback_&&"function"==typeof onCloseCallback_&&onCloseCallback_()},getParams:function(params){for(var modal=$("#"+ID_MODAL),p={},i=0;i<params.length;i++)p[params[i]]=modal.attr("data-param-"+params[i]);return p},newPremiumDownload:function(productId,posterHashedId){PMW.isOldPosterMaker()?posterHashedId=facade_.retrieveProxy(postermywall.core.model.WhiteboardProxy.NAME).getPoster().hashedID:PMW.isReactPosterMaker()&&(posterHashedId=window.posterEditor&&window.posterEditor.whiteboard?window.posterEditor.whiteboard.hashedID:void 0),setLoading_(i18next.t("pmwjs_processing")),PMW.write(PMW.util.site_url("cart/newPremiumDownload"),{id:productId,hid:posterHashedId}).done(this.onNewPremiumDownloadSuccess.bind(this)).fail(this.onNewPremiumDownloadFail.bind(this))},onNewPremiumDownloadSuccess:function(r){var isRealTime;if("success"===r.status)PMW.gtm.trackGA4PremiumDownloadEvents(r.data),"function"==typeof successCallback_?successCallback_(r.data):void 0!==r.data&&null!=r.data&&(isRealTime=r.data.isRealTime?1:0,window.location.href=PMW.util.site_url("cart/preparingDownload/"+r.data.type+"/"+r.data.idOrder+"/"+isRealTime));else if(r.code)switch(r.code){case"not_allowed":PMW.openErrorModal({message:i18next.t("pmwjs_download_not_allowed"),log:!1});break;case"getty_requirements_not_met":PMW.openErrorModal({message:i18next.t("pmwjs_cannot_buy_only_getty_images"),log:!1});break;default:PMW.openErrorModal({log:!1})}PMW.closeModalDialog(ID_MODAL)},onNewPremiumDownloadFail:function(){PMW.openErrorModal({message:i18next.t("pmwjs_general_ajax_error")})}}}();
$(document).ready(function(){let fd=$(".js-filter-dialog"),fde=$(".js-filter-dialog-extended"),src=fd.find(".source").attr("data-source");function doSearch(contentType){let searchTerm=$.trim($("#search").find(".search-field input").val().toLowerCase()),posterType,sizeType;0<fd.length?(posterType=fd.find(".poster-type-filter-item.selected").attr("data-type"),posterType="all"!==posterType?"&pt="+posterType:""):(posterType=fde.attr("data-type"),0<posterType.length&&(sizeType=fde.attr("data-size-type"),posterType="ds"===sizeType||"dss"===sizeType?"&"+sizeType+"="+posterType:"all"!==posterType?"&pt="+posterType:"")),$(".filter-options").removeClass("-open"),""!==searchTerm&&(changeFilterText(fd),window.location.href=PMW.util.embedded_site_url("posters/search?s="+encodeURIComponent(searchTerm)+posterType+("all"!==contentType?"&tt="+contentType:"")))}function prepareSearch(t,selector,uri){let posterType=fde.attr("data-type"),sizeType=fde.attr("data-size-type");$(".filter-options").removeClass("-open"),changeFilterText(fd),posterType=posterType||"all",0<sizeType.length&&(sizeType="/"+sizeType);let subcategory=$(selector).attr("data-category"),dataContentType=t.attr("data-content-type"),contentType=dataContentType||"all",url=PMW.util.site_url(uri+subcategory+"/"+posterType+"/"+contentType+sizeType);"all"===posterType&&"all"===contentType&&(url=PMW.util.site_url(uri+subcategory+"/all"+sizeType)),window.location.href=url}function changeFilterText(t){var posterType=t.find(".poster-size-type.selected").attr("data-display-name");t.find(".-current-poster-type").html(posterType)}PMW.onClick(fd,null,function(e){if(0===$(e.target).parents(".filter-options").length){let t=$(this).find(".filter-options");t.toggleClass("-open")}}),$(document).mouseup(function(e){0<$(e.target).parents(".js-filter-dialog").length||fd.is(e.target)||$(".filter-options").removeClass("-open")}),PMW.onClick(fd,".js-filter-dialog-option",function(){let t=$(this),fdo=t.parents(".js-filter-dialog").find(".js-filter-dialog-option");fdo.removeClass("-checked"),t.addClass("-checked"),t.hasClass("-link")?window.location=$(this).find("a").attr("href"):"search-results"===src?doSearch(t.attr("data-content-type")):"category-page"===src?prepareSearch(t,"#gcat","g/"):"subcategory-page"===src&&prepareSearch(t,"#gscat","s/")}),PMW.onClick(fde,".js-filter-dialog-option",function(e){let t=$(this),fde=$(".js-filter-dialog-extended"),fdo=fde.find(".js-filter-dialog-option"),src=t.parents(".source").attr("data-source");fdo.removeClass("-checked"),fde.find("[data-content-type='"+t.attr("data-content-type")+"']").addClass("-checked"),t.hasClass("-link")?window.location=$(this).find("a").attr("href"):"search-results"===src?doSearch(t.attr("data-content-type")):"category-page"===src?prepareSearch(t,"#gcat","g/"):"subcategory-page"===src&&prepareSearch(t,"#gscat","s/")}),PMW.onClick($(".poster-size-type"),null,function(){let t=$(this);if(t.parents(".js-filter-dialog").find(".poster-size-type").removeClass("selected"),t.addClass("selected"),"search-results"===src){let activeFilter=fde.is(":visible")?fde:$(".content-type-container");doSearch(activeFilter.find(".js-filter-dialog-option.-checked").attr("data-content-type"))}else"category-page"===src?prepareSearch(fde.find(".js-filter-dialog-option.-checked"),"#gcat","g/"):"subcategory-page"===src?prepareSearch(fde.find(".js-filter-dialog-option.-checked"),"#gscat","s/"):0===t.parents("#categories-card").length&&changeFilterText(t.parents(".js-filter-dialog"))})});
$(document).ready(function(){var searchFieldEl=$(".search-field");function doSearch_(searchField,searchInput){0===searchInput.val().length?searchInput.focus():PMW.getCsrfToken(function(csrfToken){searchField.find(".js-form-search-form").find(PMW.csrfSelector).val(csrfToken),searchField.find(".js-form-search-form").submit()})}PMW.onClick(searchFieldEl,".icon-search",function(){let searchField=$(this).closest(".search-field"),searchInput=searchField.find(".input");doSearch_(searchField,searchInput)}),PMW.onClick(searchFieldEl,".clear-btn",function(){var searchFieldInput=$(this).closest(".search-field"),defaultUrl=searchFieldInput.attr("data-default-url"),searchFieldInput=searchFieldInput.find(".input");0<searchFieldInput.attr("value").length&&0<defaultUrl.length?window.location.href=defaultUrl:searchFieldInput.val("")}),searchFieldEl.on("keypress",function(searchField){var searchInput;13===searchField.which&&(searchField.preventDefault(),searchField=$(this),searchInput=searchField.find(".input"),doSearch_(searchField,searchInput))})});
PMW.premiumDialogs=function(){const FLOW_BACKWARD="backward";let isSubscriptionPlansAssetGroupAlreadyLoaded=!1;function initPersonaTracking_(pd){PMW.onClick($(".btn-persona-option"),null,function(){let idpersona=this.id;PMW.write(PMW.util.site_url("user/saveUserPersona"),{idpersona:idpersona}).done(function(r){if("success"===r.status){let premiumTrialModal=$("#premium-trial-dialog");premiumTrialModal.find(".persona-info-container").hide(),premiumTrialModal.find(".persona-graphic-container").hide(),premiumTrialModal.find(".first-modal").show(),premiumTrialModal.find(".premium-graphic-container").show(),PMW.util.setCookie("pmwpi",idpersona,21600),PMW.gtm.setUserPersona(),pd||closeTrialDialog_()}else alert(i18next.t("pmwjs_error_processing_request_try_again"))})})}function closeTrialDialog_(){PMW.closeModalV2("premium-trial-dialog")}function initPremiumTrialDialog_(displayPersonaOptions,displayPremiumTrialDialog,referrer,direction,cb){let premiumTrialModal=$("#premium-trial-dialog"),firstSlide=premiumTrialModal.find(".first-modal"),secondSlide=premiumTrialModal.find(".second-modal"),premiumGraphic=premiumTrialModal.find(".premium-graphic-container"),personInfoContainer=premiumTrialModal.find(".persona-info-container"),personGraphicContainer=premiumTrialModal.find(".persona-graphic-container"),personaNextBtn=$(".persona-tracking-skip-btn");displayPersonaOptions&&(PMW.write(PMW.util.site_url("user/skipPersonaDialogForUser")),PMW.gtm.setUserPersona(),initPersonaTracking_(displayPremiumTrialDialog),firstSlide.hide(),secondSlide.hide(),premiumGraphic.hide(),displayPremiumTrialDialog?PMW.onClick(personaNextBtn,null,function(){personInfoContainer.hide(),personGraphicContainer.hide(),firstSlide.show(),premiumGraphic.show(),premiumTrialModal.find(".premium-trial-modal").removeClass("-persona")}):(personaNextBtn.text(i18next.t("pmwjs_premium_later")),PMW.onClick(personaNextBtn,null,closeTrialDialog_))),PMW.onClick(premiumTrialModal.find(".first-modal-btn"),null,function(){firstSlide.hide(),secondSlide.show(),premiumTrialModal.find(".testimonial-text").addClass("second-modal-text"),PMW.gtm.trackGA4CustomEvent("SummaryDialog_ViewPlans")}),$.isFunction(cb)&&cb();let selectCycle=secondSlide.find("#select-cycle"),planInput=secondSlide.find(".plan-input"),secondModalBtn=secondSlide.find(".second-modal-btn");direction===FLOW_BACKWARD&&function(){firstSlide.hide(),secondSlide.show(),premiumTrialModal.find(".testimonial-text").addClass("second-modal-text");var duration=PMW.getCacheItem("bc"+PMW.getUserId()),wasLongDurationSelected=duration===PMW.subscriptionPlans.LONG_DURATION,cachedPlanLevel=PMW.getCacheItem("pl"+PMW.getUserId());PMW.subscriptionPlans.changeDurationSelection(duration),PMW.subscriptionPlans.switchCurrentPlanSelection(duration,cachedPlanLevel),selectCycle.prop("checked",wasLongDurationSelected)}(),selectCycle.on("change",function(){PMW.subscriptionPlans.changeDurationSelection(selectCycle.prop("checked")?PMW.subscriptionPlans.LONG_DURATION:PMW.subscriptionPlans.SHORT_DURATION)}),planInput.on("change",(function(){PMW.subscriptionPlans.getSelectedPlan().removeClass("selected").siblings().addClass("selected")}).bind(this)),PMW.onClick(secondModalBtn,null,(function(){let currentlySelectedPlan=PMW.subscriptionPlans.getSelectedPlan(),selectedPaymentCycle=selectCycle.prop("checked")?PMW.subscriptionPlans.LONG_DURATION:PMW.subscriptionPlans.SHORT_DURATION,planId=currentlySelectedPlan.attr("data-plan-id"),displayPrice=currentlySelectedPlan.attr("data-display-price");PMW.setCacheItem("bc"+PMW.getUserId(),selectedPaymentCycle),PMW.setCacheItem("pl"+PMW.getUserId(),currentlySelectedPlan.attr("data-plan-level")),PMW.gtm.trackGA4CustomEvent("SignUpDialog_StartTrial"),closeTrialDialog_(),referrer?PMW.checkout.showCheckoutDialog(PMW.checkout.MODE_SUBSCRIPTION_TRIAL,{id:planId,promo:null,price:displayPrice,referrer:referrer,url:window.location.href}):PMW.checkout.showCheckoutDialog(PMW.checkout.MODE_SUBSCRIPTION_TRIAL,{id:planId,promo:null,price:displayPrice})}).bind(this))}function onPremiumTrialDialogSuccessfullyLoaded_(displayPersonaOptions,displayPremiumTrialDialog,referrer,direction,cb){new Promise((resolve,reject)=>{isSubscriptionPlansAssetGroupAlreadyLoaded?resolve():PMW.getJsAssetGroup("subscriptionPlans",()=>resolve(),()=>reject(i18next.t("pmwjs_error_processing_request")))}).then(()=>{isSubscriptionPlansAssetGroupAlreadyLoaded=!0,initPremiumTrialDialog_(displayPersonaOptions,displayPremiumTrialDialog,referrer,direction,cb)}).catch(errorMessage=>{PMW.closeModalV2("premium-trial-dialog",function(){alert(errorMessage)})})}function applyPromoCodeOnSubscription_(onDone,onFail){let promo=$("#promo-code").val(),btnApplyPromo=$("#apply-promo-dialog .btn-apply-promo");0!==promo.length?(btnApplyPromo.addClass("disabled"),PMW.setLoading(i18next.t("pmwjs_processing")),PMW.write(PMW.util.site_url("premium/applyPromotionOnSubscription"),{promo:promo}).done((function(onDone,r){"function"==typeof onDone&&onDone(r)}).bind(this,onDone)).fail((function(onFail,r){alert(i18next.t("pmwjs_error_processing_request")),"function"==typeof onFail&&onFail()}).bind(this,onFail)).always((function(el){el.removeClass("disabled"),PMW.setLoading(null)}).bind(this,btnApplyPromo))):alert(i18next.t("pmwjs_promotion_not_valid"))}return{openTrialDialog:function(useCookie,referrer,direction,type,cb){if(void 0===referrer&&(referrer=null),void 0===direction&&(direction="forward"),void 0===cb&&(cb=null),void 0===type&&(type=null),!PMW.isEmbedded()){let displayPremiumTrialDialog=!1,displayPersonaOptions=!1;if(useCookie){var idPersona=window.location.pathname.split("/").pop();if("confirmmembership"===idPersona||-1!==PMW.accessDeniedPages.indexOf(idPersona)||PMW.isVerificationNeeded())return;var isNewUser=PMW.isNewUser();if("-2"!==PMW.util.readCookie("pmwpi")&&!isNewUser)return;idPersona=PMW.getUserPersonaId();null===idPersona?displayPersonaOptions=!1:"-2"===idPersona&&(displayPersonaOptions=!0),0===PMW.getUserPremiumLevel()&&(displayPremiumTrialDialog=isNewUser),"student"===PMW.getUserType()&&(displayPersonaOptions=!1)}else 0===PMW.getUserPremiumLevel()&&(displayPremiumTrialDialog=!0);(displayPersonaOptions||displayPremiumTrialDialog)&&"notloggedin"!==PMW.getUserType()&&(PMW.openDialogV2("premium-trial-dialog","",PMW.util.site_url("premium/premiumTrialDialog"),{type:type,displayPersonaOptions:displayPersonaOptions,displayPremiumTrialDialog:displayPremiumTrialDialog},onPremiumTrialDialogSuccessfullyLoaded_.bind(this,displayPersonaOptions,displayPremiumTrialDialog,referrer,direction,cb),!1,".premium-dialog-custom-close",!1),PMW.deleteNewUserCookie())}},openPersonaDialogOnly:function(){PMW.openDialogV2("premium-trial-dialog","",PMW.util.site_url("premium/personaDialog"),{displayPersonaOptions:!0},function(){let premiumTrialModal=$("#premium-trial-dialog"),firstSlide=premiumTrialModal.find(".first-modal"),secondSlide=premiumTrialModal.find(".second-modal"),premiumGraphic=premiumTrialModal.find(".premium-graphic-container"),personaNextBtn=$(".persona-tracking-skip-btn");initPersonaTracking_(!1),firstSlide.hide(),secondSlide.hide(),premiumGraphic.hide(),personaNextBtn.text(i18next.t("pmwjs_premium_later")),PMW.onClick(personaNextBtn,null,closeTrialDialog_)},!1,".premium-dialog-custom-close, .second-modal-btn",!0)},onSkipPersonPendingPopup:function(){PMW.write(PMW.util.site_url("user/skipPendingPersonaPopupForUser"))},openCreditFinishPremiumPlusdialog:function(facade,productId,posterHashId,status,priceInCredits,creditPurchaseCallBack,onCloseCallBack){PMW.openDialogV2("credit-purchase-dialog","",PMW.util.site_url("premium/creditsFinishPremiumPlusDialog"),null,function(){let creditPurchaseModal=$("#credit-purchase-dialog");PMW.onClick(creditPurchaseModal.find(".buy-credits-btn"),null,function(){PMW.checkout.showCheckoutDialog(PMW.checkout.MODE_BUY_CREDIT_PACK,{mode:"pay-with-credits",pid:productId,hid:posterHashId,status:status,priceInCredits:priceInCredits,creditPurchaseCallBack:creditPurchaseCallBack,onCloseCallBack:onCloseCallBack},facade)}),PMW.onClick(creditPurchaseModal.find(".upgrade-btn"),null,PMW.openChangePlanModal)},!1,".buy-credits-btn, .upgrade-btn, .premium-custom-cross-btn",!0,onCloseCallBack)},processSubscriptionPromo:function(promo,priceId,initialPrice,seats,successCB,failCB,initialDiscount){if(promo)PMW.setLoading(i18next.t("pmwjs_checking_promotion")),$.get(PMW.util.site_url("premium/isValidPromotion"),{priceId:priceId,promo:promo,isSeatPurchase:0,seats:seats},null,"json").done(function(r){let status=r.status,data=r.data,discount=0;if(PMW.setLoading(null),"success"===status&&data)data.discount&&(discount=parseFloat(data.discount)),successCB(initialPrice,discount);else if("fail"===status){let msg=i18next.t("pmwjs_promotion_not_valid");if(data&&data.promo)switch(data.promo){case"expired":msg=i18next.t("pmwjs_promotion_expired");break;case"usage-limit":case"used":msg=i18next.t("pmwjs_promotion_used_up");break;case"not-applicable":msg=i18next.t("pmwjs_code_not_applicable")}failCB(msg)}else failCB(i18next.t("pmwjs_error_verifying_promotion"))}).fail(function(){failCB(i18next.t("pmwjs_error_verifying_promotion"))});else{let discount=0;void 0!==discount&&0<initialDiscount&&(discount=initialDiscount),successCB(initialPrice,discount)}},applyPromoCodeOnSubscription:function(onDone,onFail){applyPromoCodeOnSubscription_(onDone,onFail)},openApplyPromoDialog:function(e,promo,onDone,onFail){let buttons={},title=i18next.t("pmwjs_apply_promotion_subscription");buttons[i18next.t("pmwjs_apply")]={ch:function(){$(".js-apply-promo-error").addClass("_hidden"),applyPromoCodeOnSubscription_(onDone,onFail)},classes:"btn-apply-promo disabled"};let promoDialog=PMW.openModalDialog("apply-promo-dialog",title,buttons,!0,"-modal-500 -auto"),content=promoDialog.find(".content");PMW.load(content,PMW.util.site_url("premium/loadApplyPromotionDialog"),{premiumLevel:PMW.getUserPremiumLevel()},(function(promo){let promoInputField=$("#promo-code");promoInputField.val(promo),0<promoInputField.length&&$("#apply-promo-dialog .btn-apply-promo").removeClass("disabled")}).bind(this,promo))},showErrorOnApplyPromoDialog:function(errorMsg){$(".js-apply-promo-error").html(errorMsg).removeClass("_hidden")}}}();
!function(){var loading_=$("#loading"),text_=loading_.find("span").first();PMW.setLoading=function(text,hideIcon=!1){loading_.removeAttr("style"),(text=void 0===text?i18next.t("pmwjs_loading"):text)?(hideIcon&&(loading_.find(".icon-circle-o-notch").addClass("hidden"),loading_.addClass("-no-icon")),text_.html(text),PMW.toggleInOut(loading_,!0),PMW.bringToFrontOfModals(loading_)):(text_.html(""),PMW.toggleInOut(loading_,!1),loading_.find("i.icon-circle-o-notch").hasClass("hidden")&&loading_.find("i.icon-circle-o-notch").removeClass("hidden"))},loading_.find(".icon-close").click(PMW.setLoading.bind(this,null))}();
!function(){function onHoverVideoThumb_(e){var videoItem=$(e.target).closest(".play-on-hover-video");PMW.loadVideoItem(videoItem,e.type)}function addAndPlayVideo_(videoItem,videoElement,videoElementDom,playIconElement){var newVideoElement;videoItem.attr("data-preview-video-src")&&(0===videoElement.length?((newVideoElement=document.createElement("video")).crossOrigin="anonymous",newVideoElement.classList.add("preview-video"),videoItem.hasClass("disable-video-loop")||videoItem.hasClass("auto-play")||(newVideoElement.loop=!0),videoItem.attr("data-display-name")&&(newVideoElement.title=videoItem.attr("data-display-name")),newVideoElement.muted=!0,newVideoElement.disableRemotePlayback=!0,videoItem.hasClass("auto-play")?(newVideoElement.preload="none",newVideoElement.setAttribute("data-init","0"),newVideoElement.addEventListener("canplaythrough",onVideoCanPlayThrough_),newVideoElement.addEventListener("mouseover",onVideoMouseOver_),newVideoElement.addEventListener("ended",onVideoPaused_.bind(this,videoItem,playIconElement))):showLoading_(playIconElement),newVideoElement.addEventListener("waiting",showLoading_.bind(this,playIconElement),!1),PMW.isMobileApp()||newVideoElement.addEventListener("error",onVideoError_.bind(this,videoItem,playIconElement),!1),newVideoElement.addEventListener("abort",onVideoError_.bind(this,videoItem,playIconElement),!1),newVideoElement.addEventListener("playing",(function(videoItem,playIconElement){(function(playIconElement){0<playIconElement.length&&!playIconElement.hasClass("_hidden")&&playIconElement.addClass("_hidden")})(playIconElement),function(videoItem){var muteButton=videoItem.find(".mute-video-button");0<muteButton.length&&muteButton.removeClass("_hidden")}(videoItem)}).bind(this,videoItem,playIconElement),!1),newVideoElement.addEventListener("pause",onVideoPaused_.bind(this,videoItem,playIconElement),!1),insertVideoElement(videoItem,newVideoElement,"img:not(.js-svg-icon)"),(videoElementDom=(videoElement=videoItem.find("video")).get(0)).addEventListener("loadeddata",(function(videoItem,videoElementDom,playIconElement,e){e&&e.target.duration<.035?onVideoError_(videoItem,playIconElement):((videoElementDom.mozHasAudio||Boolean(videoElementDom.webkitAudioDecodedByteCount)||Boolean(videoElementDom.audioTracks&&videoElementDom.audioTracks.length))&&function(videoItem,videoElementDom){var muteVideoButton="<i class='mute-video-button icon-sound -muted' title='"+i18next.t("pmwjs_unmute")+"'></i>";videoItem.find(".preview-container").append(muteVideoButton);muteVideoButton=videoItem.find(".mute-video-button");PMW.onClick(muteVideoButton,null,(function(videoElementDom,muteVideoButton,e){e.preventDefault(),e.stopPropagation(),videoElementDom.muted?(videoElementDom.muted=!1,muteVideoButton.removeClass("-muted"),muteVideoButton.attr("title",i18next.t("pmwjs_mute"))):(videoElementDom.muted=!0,muteVideoButton.addClass("-muted"),muteVideoButton.attr("title",i18next.t("pmwjs_unmute")))}).bind(this,videoElementDom,muteVideoButton))}(videoItem,videoElementDom),PMW.isMobileOS()&&videoItem.hasClass("screen-size-video")||playVideo_(videoItem,videoElementDom,playIconElement))}).bind(this,videoItem,videoElementDom,playIconElement),!1),videoElementDom.src=videoItem.attr("data-preview-video-src"),videoItem.trigger("videoThumbnail:onVideoAdded"),!PMW.isMobileOS()&&videoItem.hasClass("-first-video")&&playVideo_(videoItem,videoElementDom,playIconElement),PMW.isMobileOS()&&videoItem.hasClass("screen-size-video")&&function(videoItem,videoElement,videoElementDom,playIconElement){showPosterVideoIcon_(playIconElement),videoElement.hide();insertVideoElement(videoItem,"<div class='play-video-button'><i class='icon-play-video video-icon-mobile'></i></div>","img");var playVideoButton=videoItem.find(".play-video-button");PMW.onClick(playVideoButton,null,(function(videoElement,videoElementDom,playVideoButton,e){e.preventDefault(),e.stopPropagation(),videoElement.show(),playVideoButton.hide(),videoElementDom.play()}).bind(this,videoElement,videoElementDom,playVideoButton))}(videoItem,videoElement,videoElementDom,playIconElement)):playVideo_(videoItem,videoElementDom,playIconElement))}function onVideoPaused_(videoItem,playIconElement){showPosterVideoIcon_(playIconElement),function(videoItem){var muteButton=videoItem.find(".mute-video-button");0<muteButton.length&&muteButton.addClass("_hidden")}(videoItem)}function stopAutoPlayingVideos(el){var videosItemsToStop=el.closest(".video-item").siblings(".video-item"),videosToStop=videosItemsToStop.find("video");videosItemsToStop.removeClass("dont-play");for(var i=0;i<videosToStop.length;i++)videosToStop[i].paused||("1"===videosToStop[i].getAttribute("data-init")?(videosItemsToStop.addClass("dont-play"),videosToStop[i].pause()):videosToStop[i].setAttribute("data-init","1"))}function onVideoMouseOver_(){this.setAttribute("data-init","1"),this.setAttribute("is-hovered","1"),stopAutoPlayingVideos($(this))}function onVideoCanPlayThrough_(){var currentVideo=$(this),currentItem=null;if(function(el){var bounds=$(window),viewport={top:bounds.scrollTop(),left:bounds.scrollLeft()};viewport.right=viewport.left+bounds.width(),viewport.bottom=viewport.top+bounds.height();bounds=el.offset();return bounds.right=bounds.left+el.outerWidth(),bounds.bottom=bounds.top+el.outerHeight(),!(viewport.right<bounds.left||viewport.left>bounds.right||viewport.bottom<bounds.top||viewport.top>bounds.bottom)}(currentVideo)){if("0"===currentVideo.attr("data-init")){for(var videoItem,playIconElement,nextVideo=currentVideo;null!==nextVideo;){if(currentItem=currentVideo.closest(".video-item").nextAll(".video-item:first"),0<(nextVideo=currentItem.find("video")).length){if(nextVideo[0].paused){nextVideo=nextVideo[0];break}}else nextVideo=null;currentVideo=nextVideo}null!==nextVideo&&"1"!==nextVideo.getAttribute("data-init")&&(videoItem=$(nextVideo).closest(".video-item"),playIconElement=videoItem.find(".icon-videocam"),setTimeout(function(){playVideo_(videoItem,nextVideo,playIconElement)},2e3)),this.setAttribute("data-init","1")}}else stopAutoPlayingVideos(currentVideo)}function playVideo_(videoItem,videoElementDom,playIconElement){var playPromise;videoItem.hasClass("dont-play")||(void 0!==(playPromise=videoElementDom.play())?(videoItem.attr("data-can-pause","0"),playPromise.then(function(){"1"===videoItem.attr("data-delayed-pause")&&(videoItem.attr("data-delayed-pause","0"),videoElementDom.pause()),videoItem.attr("data-can-pause","1")}).catch(function(){onVideoError_(videoItem,playIconElement)})):("1"===videoItem.attr("data-delayed-pause")&&(videoItem.attr("data-delayed-pause","0"),videoElementDom.pause()),videoItem.attr("data-can-pause","1")))}function onVideoError_(videoItem,playIconElement){showPosterVideoIcon_(playIconElement);const playVideoButton=videoItem.find(".play-video-button");0<playVideoButton.length&&playVideoButton.hide(),videoItem.find("video").remove(),"0"===videoItem.attr("data-show-error-message")?videoItem.find(".video-not-available").hide():0===videoItem.find(".video-not-available").length?insertVideoElement(videoItem,'<div class="video-not-available -hide-while-loading">'+i18next.t("pmwjs_preview_not_ready")+"</div>","img"):videoItem.find(".video-not-available").show()}function showLoading_(playIconElement){0<playIconElement.length&&(playIconElement.addClass("-blink"),playIconElement.removeClass("_hidden"))}function showPosterVideoIcon_(playIconElement){0<playIconElement.length&&(playIconElement.removeClass("-blink"),playIconElement.removeClass("_hidden"))}function insertVideoElement(videoItem,elementToInsert,imageSelector){const pictureTag=videoItem.find("picture");(0<pictureTag.length?pictureTag:videoItem.find(imageSelector)).after(elementToInsert)}PMW.initVideosForPlayOnHover=function(autoPlayContainer){autoPlayContainer.on("mouseenter mouseleave",".play-on-hover-video .preview-container",(function(e){var videoItem=$(e.target).closest(".play-on-hover-video").find(".video-item");PMW.loadVideoItem(videoItem,e.type)}).bind(this))},PMW.initVideoItems=function(element,autoPlayContainer){var videos;autoPlayContainer?(videos=autoPlayContainer.find(".video-item"),PMW.isMobileOS()&&(videos=videos.not(".preview-container")).slice(5).addClass("dont-play").removeClass("auto-play auto-play-video"),function(videoElements,autoPlayContainer){for(var videoItem,j=0;j<videoElements.length;j++)videoItem=$(videoElements[j]),0===j&&videoItem.addClass("-first-video"),videoItem.addClass("auto-play"),PMW.loadVideoItem(videoItem);autoPlayContainer.on("mouseenter mouseleave",".play-on-hover-video .preview-container",onHoverVideoThumb_.bind(this))}(videos,autoPlayContainer)):(element||$(document)).on("mouseenter mouseleave",".play-on-hover-video .preview-container",onHoverVideoThumb_.bind(this))},PMW.playVideoItemsAtOnce=function(parentSelector){for(var videos=parentSelector.find(".video-item"),j=0;j<videos.length;j++){var player,videoItem=$(videos[j]);videoItem.attr("data-preview-video-src")&&((player=document.createElement("video")).crossOrigin="anonymous",player.loop=!0,player.muted=!0,player.src=videoItem.attr("data-preview-video-src"),player.disableRemotePlayback=!0,videoItem.attr("data-display-name")&&(player.title=videoItem.attr("data-display-name")),insertVideoElement(videoItem,player,"img"),videoItem.trigger("videoThumbnail:onVideoAdded"),player.load(),player.play())}},PMW.playOrShowPlayButton=function(parentSelector){for(var videoParent,videos=parentSelector.find("video"),video=null,playVideoButton=null,i=0;i<videos.length;i++)video=videos[i],(videoParent=$(video).parent()).append("<div class='play-video-button-simple'><i class='icon-play-video'></i></div>"),playVideoButton=videoParent.find(".play-video-button-simple"),PMW.onClick(playVideoButton,null,function(){video.muted=!0,video.play(),playVideoButton.hide()}),video.addEventListener("playing",function(){playVideoButton.hide()})},PMW.loadVideoItem=function(videoItems,eventType){videoItems.each(function(){var videoItem=$(this);eventType=void 0===eventType?"":eventType;var videoElement=videoItem.find("video"),playIconElement=videoItem.find(".video-icon-container").length?videoItem.find(".video-icon-container"):videoItem.find(".icon-videocam"),videoElementDom=videoElement.get(0);"mouseenter"===eventType?(videoItem.removeClass("dont-play"),videoItem.attr("play-video","1"),videoItem.attr("data-show-error-message","1"),videoItem.attr("data-delayed-pause","0"),videoItem.attr("data-can-pause","0"),setTimeout(function(){"1"===videoItem.attr("play-video")&&addAndPlayVideo_(videoItem,videoElement,videoElementDom,playIconElement)},200)):"mouseleave"===eventType?(videoItem.attr("play-video","0"),videoItem.attr("data-show-error-message","0"),function(videoItem,videoElementDom){"1"===videoItem.attr("data-can-pause")?videoElementDom&&videoElementDom.pause():videoItem.attr("data-delayed-pause","1")}(videoItem,videoElementDom),videoItem.find(".video-not-available").hide()):""===eventType&&addAndPlayVideo_(videoItem,videoElement,videoElementDom,playIconElement)})}}();
PMW.initFeedbackForm=function(f,cb){$(".submitfeedback",f).click(function(){var content,$m,m,$e,e,l=$(this),$n=$('[name="name"]',f),n=$.trim($n.val());""===n||n===$n.attr("placeholder")?$n.focus():($e=$('[name="email"]',f),""!==(e=$.trim($e.val()))&&e!==$e.attr("placeholder")&&PMW.util.isValidEmail(e)?($m=$('[name="message"]',f),""===(m=$.trim($m.val()))||m===$m.attr("placeholder")?$m.focus():(content=f.find(".ffcontent"),l.html(f.find(".please-wait-message").html()),PMW.write(PMW.util.site_url("user/feedback"),{name:n,email:e,message:m},function(d){var ns;l.html(f.find(".send-feedback-message").html()),"success"===d.status?PMW.isPosterMaker()?$.isFunction(cb)&&cb():content.slideUp(250,function(){var s=f.find(".ffsuccess");s.fadeIn(500),$.isFunction(cb)?cb():setTimeout(function(){$n.val(""),$e.val(""),$m.val(""),s.hide(),content.fadeIn("slow")},1e4)}):((ns=f.find(".ff-not-sent")).fadeIn(500),setTimeout(function(){ns.fadeOut("slow")},1e4))}))):($e.focus(),(m=f.find(".fferror"))&&(m.fadeIn(500),setTimeout(function(){m.hide()},1e4))))});var loggedOutMessage,loggedInMessage,msg=$(".unsubscription-message",f);0<msg.length&&(loggedOutMessage=msg.find(".logged-out-message").html(),loggedInMessage=msg.find(".logged-in-message").html(),"notloggedin"===PMW.getUserType()?($('[name="email"]',f).keyup(function(){$(".feedbackemail",f).text(PMW.util.escapeHTML($(this).val()))}),msg.html(loggedOutMessage)):msg.html(loggedInMessage),$('[name="message"]',f).keyup(function(){(function(){var keyword,UNSUB_LIST=["unsubscribe","remove","mailing list"],msg=$('[name="message"]',f).val().toLowerCase();for(keyword in UNSUB_LIST)if(-1!=msg.indexOf(UNSUB_LIST[keyword]))return 1})()&&$('[name="email"]',f).val()&&("notloggedin"===PMW.getUserType()?msg.html(loggedOutMessage):msg.html(loggedInMessage),$(".feedbackemail",f).text($('[name="email"]',f).val()),$(".unsubscription-message",f).slideDown())}))};
PMW.initDownloadIssueForm=function(){function onReportIssue(){let email=$('[name="email"]',this),message=$('[name="message"]',this),emailParent=email.parent(),messageParent=message.parent();return messageParent.removeClass("danger"),emailParent.removeClass("danger"),null==message.val()||""==message.val().trim()?(message.focus(),messageParent.addClass("danger"),!1):null==email.val()||""==email.val().trim()?(email.focus(),emailParent.addClass("danger"),!1):void 0}PMW.getCsrfToken(function(csrfToken){let reportIssueForm=$(".js-form-report-issue");reportIssueForm.find(PMW.csrfSelector).val(csrfToken),reportIssueForm.submit(onReportIssue)})};
!function(){const INVERT_POPUP_ON_OVERFLOW_CLASS="js-invert-popup-on-overflow";function popupHandler_(){let el=$(this),p=el.next(".popup").toggleClass("open");if(el=el.toggleClass("open"),el.siblings().toggleClass("-popup-open"),PMW.isMobileScreenWidth()&&p.hasClass("is-modal-mobile"))!function(modal){modal.addClass("modal-popup");let body=$("body"),modalContent=modal.find(".popup-modal-content");body.addClass("-open-modal"),function(modalContent){modalContent.addClass("animate-modal-dialog-open").one(PMW.util.animationEndEvents,function(){modalContent.removeClass("animate-modal-dialog-open")})}(modalContent),PMW.onClick(modal.find(".close-popup-modal"),null,onClosePopupModal_),modal.on(PMW.click,function(e){$(e.target).parents(".popup-modal-header").length||$(e.target).is(".popup-modal-header")||onClosePopupModal_(0,$(this))})}(p);else if(p.removeClass("-left").hasClass("open")){p=function(clickedItem,popup){let carouselContainer=popup.parents(".carousel-container");{var newEl;carouselContainer.length&&(carouselContainer.find("> .popup").remove(),newEl=popup.clone(!0),carouselContainer.append(newEl),(popup=newEl).attr("data-for",clickedItem.closest(".item").attr("data-id")))}return popup}(el,p);let o,docOffset=el.offset(),left,top,parent=p.offsetParent(),w=$(window),v=[];var parentOffset;if(top=parent.get(0)===document.body?(left=docOffset.left,docOffset.top+el.height()):(el,(popupParent=parent).get(0)!==popupParent.offsetParent().get(0)?(parentOffset=parent.offset(),left=docOffset.left-parentOffset.left,docOffset.top-parentOffset.top+el.height()):(o=el.position(),left=o.left,o.top+el.height())),p.hasClass("-inverted")&&(left-=p.width()-30),p.width()+docOffset.left>w.width()&&(left-=p.width()-el.width(),v+=" -left"),parent.get(0)!==document.body){const nonOverflowingParent=p.parents().filter(function(){const el=$(this);return"hidden"===el.css("overflow")||el.hasClass(INVERT_POPUP_ON_OVERFLOW_CLASS)}).first();0<nonOverflowingParent.length&&p.height()+docOffset.top>nonOverflowingParent.height()&&(v+=" -v-inverted",top-=el.height()+p.height()+24)}p.css({left:left+"px",top:top+8+"px"}),0<v.length&&p.addClass(v),setTimeout(function(){$(document.body).one(PMW.click,function(e){!function(e){$("html").hasClass("no-touchevents")||(e.preventDefault(),$(e.target).click())}(e),p.removeClass("open").removeAttr("style"),el.removeClass("open"),function(clickedItem,popup){var carouselContainer=popup.parents(".carousel-container");carouselContainer.length&&clickedItem.next(".popup").removeClass("open");clickedItem.siblings().removeClass("-popup-open")}(el,p)})},100),$("html").hasClass("no-touchevents")||p.on(PMW.click,"li > a",function(){var t=$(this);-1===t.attr("href").indexOf("javascript:void")&&(window.location.href=t.attr("href"))})}else p.removeAttr("style");var popupParent}function onClosePopupModal_(e,clickedModal){const modal=void 0===clickedModal?$(this).closest(".modal-popup"):clickedModal,optionsContainer=modal.prev(".opens-popup"),modalContent=modal.find(".popup-modal-content"),body=$("body");optionsContainer.removeClass("open"),body.removeClass("-open-modal"),function(modal,modalContent){modalContent.addClass("animate-modal-dialog-close").one(PMW.util.animationEndEvents,function(){modalContent.removeClass("animate-modal-dialog-close"),modal.removeClass("modal-popup"),modal.removeClass("open").removeAttr("style")})}(modal,modalContent)}PMW.initPopupMenus=function(ctx){"object"==typeof ctx?PMW.onClick(ctx,".opens-popup",popupHandler_):PMW.onClick($(".opens-popup"),null,popupHandler_)}}();
!function(){const EXTREME_THUMBNAIL_RATIO_CLASS="-extreme-ratio";function beforeMasonryLayout_(images,isLazy){function onImageLoaded(){this.removeAttribute("style"),removeImageLoadingState(this)}images.each(function(i,el){var w=el.parentNode.parentNode.offsetWidth,max=el.getAttribute("data-ratio"),h=max*w;isNaN(parseInt(max))||(2<=max&&(el.className+=" "+EXTREME_THUMBNAIL_RATIO_CLASS,max=parseInt(el.getAttribute("data-max-side")),isNaN(max)||(max<w&&(h=h/w*max,w=max),max<h&&(w=w/h*max,h=max))),el.style.width=w+"px",el.style.height=h+"px",isLazy||(el.onload=el.onerror=el.onabort=onImageLoaded))})}function setSimilarTemplateHiddenData(element,data){if(void 0===data.data)return data;let batchOffset=data.data.batchOffset,batchNumber=data.data.batchNumber,templateData=data.data.viewData,doOrSearch=data.data.doOrSearch;return void 0!==batchOffset&&void 0!==batchNumber&&(element.attr("data-batchOffset",batchOffset),element.attr("data-batchNumber",batchNumber)),void 0!==doOrSearch&&element.attr("data-do-or-search",doOrSearch),void 0!==templateData?templateData.join(""):data}function initLazyLoad(imgs,isLazyLoaded,isMasonry,grid){var itemSelectorFromGrid=grid.attr("data-item-selector"),itemSelector=itemSelectorFromGrid||".thumbnail";isMasonry&&(beforeMasonryLayout_(imgs,isLazyLoaded),void 0!==PMW.handleSmallTemplates&&PMW.handleSmallTemplates(),grid.find(".no-transition").removeClass("no-transition"),grid.masonry({transitionDuration:0,itemSelector:itemSelector,columnWidth:".sizer",gutter:".gutter-sizer"})),isLazyLoaded&&imgs.lazyload(getLazyParams(isMasonry)),imgs.parents(itemSelectorFromGrid).removeClass("-loading")}function setAndLoadGridData(data,imgs,isMasonry,isLazyLoaded,grid){isMasonry&&(beforeMasonryLayout_(imgs,isLazyLoaded),void 0!==PMW.handleSmallTemplates&&PMW.handleSmallTemplates(),grid.masonry("appended",data),PMW.util.appendEmbeddedParamsToURLs(data)),isLazyLoaded&&imgs.lazyload(getLazyParams(isMasonry))}function getLazyParams(isMasonry){const lazyParams={effect:"fadeIn",threshold:.33,src:"data-original",selector:".lazy"};return isMasonry&&(lazyParams.callback=(function(img){img.removeAttribute("style"),function(img){img.classList.contains(EXTREME_THUMBNAIL_RATIO_CLASS)&&null!==img.getAttribute("data-max-side")&&(img.style.maxHeight=img.getAttribute("data-max-side")+"px")}(img),removeImageLoadingState(img)}).bind(this)),lazyParams}function removeImageLoadingState(img){$(img).parents(".js-item").removeClass("-loading")}PMW.initGrid=function(g,m,s,p,cb){s=void 0===s||null==s?$(window):s;let isMasonry=(g=1<g.length?g.first():g).hasClass("grid-masonry"),isLazyLoaded=g.hasClass("-lazy")&&jQuery().lazyload,imgs=g.find(".js-pmw-lazy:not(.ignore-grid-masonry)").add(g.find("img:not(.ignore-grid-masonry)")),sg=g.siblings(".similar-results-grid"),sgh=g.siblings(".similar-results-header"),firstCheck=!0,o,l;g.removeClass("-loading"),initLazyLoad(imgs,isLazyLoaded,isMasonry,g),g.attr("data-moreurl")&&s.scroll(function(){if(null==PMW.loading&&(PMW.loading=!1),g.is(":visible")&&!g.data("error")&&("1"===g.attr("data-more")||void 0!==g.attr("data-total")&&parseInt(g.attr("data-total"),10)>g.attr("data-offset"))&&!PMW.loading&&g.height()-s.height()-s.scrollTop()<=100){o=parseInt(g.attr("data-offset"),10),l=parseInt(g.attr("data-limit"),10);let loadOrphanTemplates=parseInt(g.attr("data-orphan"),10);isNaN(loadOrphanTemplates)&&(loadOrphanTemplates=null);let batchOffset=parseInt(g.attr("data-batchOffset"),10);isNaN(batchOffset)&&(batchOffset=null);let batchNumber=parseInt(g.attr("data-batchNumber"),10);isNaN(batchNumber)&&(batchNumber=null);let doOrSearch=parseInt(g.attr("data-do-or-search"),10);Number.isNaN(doOrSearch)&&(doOrSearch=!1),PMW.loading=!0,m?m.show():void 0!==PMW.setLoading&&PMW.setLoading(),PMW.write(g.attr("data-moreurl"),$.extend({offset:o,limit:l+1,loadOrphanTemplates:loadOrphanTemplates,batchOffset:batchOffset,batchNumber:batchNumber,doOrSearch:doOrSearch,featuredTemplateIds:function(galleryGridElement){let featuredElements=galleryGridElement.find('*[data-icf="1"]'),numFeaturedTemplates=galleryGridElement.attr("data-ft-limit"),featuredTemplateIds=featuredElements.slice(0,numFeaturedTemplates);return 0===featuredElements.length?[]:featuredTemplateIds.map(function(){return $(this).data("id")}).get()}(g)},p),function(responseData){let data=setSimilarTemplateHiddenData(g,responseData);if(PMW.loading=!1,m?m.hide():void 0!==PMW.setLoading&&PMW.setLoading(null),"error"===data)g.data("error",!0);else{let $data=$(data.replace(/\r?\n|\r/g,""));$data.length&&0<$data.length?(g.attr("data-more","1"),$data.length>l&&($data=$data.slice(0,-1))):g.attr("data-more",0),g.append($data),$data=function(elements){let validNodes=[];return elements.each(function(){3!==this.nodeType&&validNodes.push(this)}),$(validNodes)}($data),initResponsiveToolTips();var imgs=parseInt(g.attr("data-offset"));imgs+=$data.length,g.attr("data-offset",imgs),0===loadOrphanTemplates&&0===parseInt(g.attr("data-more"))&&(g.attr("data-offset",0),g.attr("data-orphan",1),g.attr("data-more",1),g.attr("data-batchnumber",0),g.attr("data-batchoffset",0)),(isMasonry||isLazyLoaded)&&(imgs=$data.find(isLazyLoaded?".js-pmw-lazy":"img").add($data.find(isLazyLoaded?"img.lazy":"img")),setAndLoadGridData($data,imgs,isMasonry,isLazyLoaded,g)),jQuery.isFunction(cb)&&cb($data)}})}else if(g.is(":visible")&&0<sg.length&&g.attr("data-content-type")&&"all"!==g.attr("data-content-type")&&"1"===sg.attr("data-more")&&!g.data("error")&&("0"===g.attr("data-more")||void 0!==g.attr("data-total")&&parseInt(g.attr("data-total"),10)>g.attr("data-offset"))&&!PMW.loading&&sg.height()-s.height()-s.scrollTop()<=100){PMW.loading=!0,o=parseInt(sg.attr("data-offset"),10),l=parseInt(sg.attr("data-limit"),10);let batchOffset=parseInt(sg.attr("data-batchOffset"),10);isNaN(batchOffset)&&(batchOffset=null);let batchNumber=parseInt(sg.attr("data-batchNumber"),10);isNaN(batchNumber)&&(batchNumber=null);var i=parseInt(sg.attr("data-invert-content"),10);firstCheck||(m?m.show():void 0!==PMW.setLoading&&PMW.setLoading()),PMW.write(sg.attr("data-moreurl"),$.extend({offset:o,limit:l+1,invertContent:i,batchOffset:batchOffset,batchNumber:batchNumber},p),function(responseData){if(firstCheck||(m?m.hide():void 0!==PMW.setLoading&&PMW.setLoading(null)),"error"===responseData)sg.data("error",!0);else{var imgs=setSimilarTemplateHiddenData(sg,responseData);if(0<imgs.length){sg.show(),sgh.show();let $data=$(imgs.replace(/\r?\n|\r/g,""));$data.length&&0<$data.length?(sg.attr("data-more","1"),$data.length>l&&($data=$data.slice(0,-1))):sg.attr("data-more","0"),sg.append($data);imgs=parseInt(sg.attr("data-offset"));imgs+=$data.length,sg.attr("data-offset",imgs),firstCheck?initLazyLoad(sg.find("img"),isLazyLoaded,isMasonry,sg):(isMasonry||isLazyLoaded)&&(imgs=$data.find(isLazyLoaded?".js-pmw-lazy":"img").add($data.find(isLazyLoaded?"img.lazy":"img")),setAndLoadGridData($data,imgs,isMasonry,isLazyLoaded,sg)),void 0!==PMW.addFavoritesSvgToIcons&&PMW.addFavoritesSvgToIcons($data),initResponsiveToolTips()}else sg.attr("data-more","0")}PMW.loading=!1,firstCheck=!1})}})},PMW.lazyLoadNonMasonryGrid=function(grid,selector,classesToAdd,classesToRemove,loadOnScroll=!0){var imgs=grid.find(".js-pmw-lazy.ignore-grid-masonry:not(.-loaded)").add(grid.find(selector));for(let i=0;i<imgs.length;i++){const img=imgs[i];loadOnScroll&&!PMW.isScrolledIntoView(img,!1,0)||(classesToAdd&&$(img).addClass(classesToAdd),classesToRemove&&$(img).removeClass(classesToRemove),$(img).hasClass("js-pmw-lazy")?img.setAttribute("srcset",img.getAttribute("data-srcset")):img.setAttribute("src",img.getAttribute("data-original")))}}}();
!function(){void 0===PMW.ui&&(PMW.ui={});var firstRun_=!0,intervalId_=0,container_=null;function onBtnGotoDownload_(url){closeNotification_(),window.open(url,"_blank")}function initClickHandlers_(url){PMW.isPosterMaker()?(url&&PMW.onClick(container_.find(".btn-goto-download"),null,onBtnGotoDownload_.bind(this,url)),PMW.onClick(container_.find(".close"),null,closeNotification_.bind(this))):(PMW.onClick(container_,".goto-download",onBtnGotoDownload_.bind(this,url)),$(window).scroll((function(){var w=$(window),notification=$("#nav-notification");container_&&!notification.hasClass("position-fixed")&&100<=w.scrollTop()?(notification.removeClass("-in"),setTimeout(function(){notification.addClass("-in").addClass("position-fixed")},350)):container_&&notification.hasClass("position-fixed")&&w.scrollTop()<container_.outerHeight()&&notification.removeClass("position-fixed")}).bind(this)))}function closeNotification_(){PMW.isPosterMaker()?container_.removeClass("-in").addClass("-out"):(container_.addClass("hidden"),container_.removeClass("-in"))}function getNotificationHTML_(btn,text){return text===i18next.t("pmwjs_save_reminder")||text===i18next.t("pmwjs_design_resized_&_copied_title")?'<div id="notification-box"><div class="left-gradient"></div><div><i class="close icon icon-close"></i><p class="notification-heading body-xs">'+text+"</p>"+btn+"</div></div>":'<div id="notification-box"><div class="options"><a class="close" href="javascript:void(0);">'+i18next.t("pmwjs_close")+"</a></div><p>"+text+"</p>"+btn+"</div>"}PMW.ui.notification={createNotificationContainer:function(text,button,HTML,callback){var notification,isSaveReminder=text===i18next.t("pmwjs_save_reminder");PMW.isPosterMaker()?(container_=isSaveReminder?$("#save-notification-container"):text===i18next.t("pmwjs_design_resized_&_copied_title")?$("#instagram-resize-notification-container"):$("#notification-container"),button&&text&&(0===container_.length?(notification='<div id="notification-container">'+getNotificationHTML_(button,text)+"</div>",$(document.body).append(notification),container_=$("#notification-container"),closeNotification_()):0<container_.length&&(container_.html(getNotificationHTML_(button,text)),initClickHandlers_(null)))):null===container_&&HTML&&(notification=(container_=$("#nav-notification-container")).find("#nav-notification"),container_&&!notification.hasClass("position-fixed")&&100<=$(window).scrollTop()&&notification.addClass("position-fixed")),isSaveReminder||setTimeout((function(HTML,callback){PMW.isPosterMaker()?container_.addClass("-in"):HTML&&container_.removeClass("hidden").find("#nav-notification").addClass("-in").find(".columns").html(HTML),"function"==typeof callback&&callback()}).bind(this,HTML,callback),100)},checkForNotifications:function(){$.getJSON(PMW.util.site_url("cart/downloadNotification"),{checkPurchases:firstRun_},(function(data){var timer,onInterval;data.hasPurchase||clearInterval(intervalId_),firstRun_&&(!0===data.hasPurchase&&(timer=15e3,onInterval=(function(){this.checkForNotifications(),clearInterval(intervalId_),timer*=1.5,intervalId_=setInterval(onInterval,timer)}).bind(this),intervalId_=setInterval(onInterval,timer)),firstRun_=!1),void 0!==data.url&&this.createNotificationContainer("","",'<i class="icon-check"></i>'+i18next.t("pmwjs_download_order_is_ready")+' <a href="javascript:void(0);" class="goto-download">'+i18next.t("pmwjs_download_now")+"</a>",initClickHandlers_.bind(this,data.url))}).bind(this))}}}();
!function(){void 0===PMW.ui&&(PMW.ui={});PMW.ui.setMessage=function(message,type){var el=$("#page-message");0===el.length&&$("#bd").prepend('<div id="page-message" class="page-message -warning -nomargin"><p></p></div>'),el=$("#page-message").removeClass("-success -error -warning"),null!=type&&0<type.length&&el.addClass("-"+type),el.find(">p").text(message)}}();
PMW.initEditableTextArea=function(id,onSaveURL,additionalParams,successCallback){var fieldContainer=$('.eta-container[data-id="'+id+'"]'),field=fieldContainer.find(".eta"),inputContainer=$('.text-area-container[data-id="'+id+'"]'),inputField=inputContainer.find(".input"),saveBtn=inputContainer.find(".btn-save"),cancelBtn=inputContainer.find(".btn-cancel");function showField(){inputContainer.slideUp({duration:300,easing:"swing",complete:function(){fieldContainer.show()}})}function onSaveInput(){var val=$.trim(inputField.val());val!==field.text()?""!==val&&(PMW.setLoading(i18next.t("pmwjs_please_wait")),PMW.write(onSaveURL,$.extend({id:id,val:val},additionalParams)).done(function(r){"success"===r.status?(field.html(PMW.util.escapeHTML(r.data)),"function"==typeof successCallback&&successCallback(r)):null!==r.message&&alert(r.message)}).always(function(){showField(),PMW.setLoading(null)})):showField()}void 0===additionalParams&&(additionalParams={}),PMW.onClick(fieldContainer,null,function(){fieldContainer.slideUp(250),inputContainer.slideDown(250);var data=field.text(),val="";inputField.focus(),data!==inputField.attr("placeholder")&&(val=data+""),inputField.val(val)}),PMW.onClick(saveBtn,null,onSaveInput),PMW.onClick(cancelBtn,null,showField),inputField.on("keyup blur",function(e){13===e.which?onSaveInput():27===e.which&&showField()})},PMW.initEditableTextField=function(id,uid,onSaveURL,additionalParams,successCallback,errorCallback,performURLValidation){let etf=$("#"+id+'.editable-text-field[data-uid="'+uid+'"]');if(0!==etf.length){let editIcon=etf.find(".icon-pencil"),deleteIcon=etf.find(".icon-delete"),isClassicView=$("#edit-link").hasClass("classic-view"),loaderContainer=etf.find(".loader-container"),editControls=etf.find(".edit-controls"),checkIcon=editControls.find(".icon-check"),cancelIcon=editControls.find(".icon-close"),infoIcon=etf.find(".icon-info"),field=etf.find(".input"),widthCalculator=etf.find(".width-calculator");function updateInputWidth(){var value,offset;isClassicView||(value=field.val(),offset=8,widthCalculator.text(value),offset+=5*value.split(" ").length,field.css("width",widthCalculator.width()+offset+"px"))}function resetInput(){field.val(field.attr("value")),updateInputWidth()}function transitionState(){var icon;etf.hasClass("ready")?(etf.removeClass("ready").addClass("editing"),deleteIcon.fadeOut(200),editIcon.fadeOut(200,function(){editControls.removeClass("_hidden").fadeIn(200)})):(etf.hasClass("editing")||etf.hasClass("success")||etf.hasClass("error"))&&(etf.removeClass("editing success error").addClass("ready"),(icon="block"===loaderContainer.css("display")?loaderContainer:"block"===infoIcon.css("display")?infoIcon:editControls).fadeOut(200,function(){deleteIcon.removeClass("disabled"),icon.addClass("_hidden"),deleteIcon.fadeIn(200),editIcon.fadeIn(200)}))}function completeLoading(r){var cb;field.removeAttr("disabled"),"success"===r.status?(cb=function(){field.attr("value",r.data),field.val(r.data),updateInputWidth(),"function"==typeof successCallback&&successCallback(r)},etf.removeClass("loading").addClass("success"),isClassicView&&checkIcon.addClass("_hidden"),cancelIcon.addClass("_hidden"),loaderContainer.fadeOut(200,function(){editControls.fadeIn(200,function(){isClassicView?(transitionState(),"function"==typeof cb&&cb(),setTimeout(function(){checkIcon.removeClass("_hidden"),cancelIcon.removeClass("_hidden")},400)):setTimeout(function(){transitionState(),"function"==typeof cb&&cb(),setTimeout(function(){cancelIcon.removeClass("_hidden")},400)},800)})})):function(cb){etf.removeClass("loading").addClass("error"),loaderContainer.fadeOut(200,function(){isClassicView?(resetInput(),transitionState(),"function"==typeof cb&&cb()):infoIcon.removeClass("_hidden").fadeIn(200,function(){setTimeout(function(){resetInput(),transitionState(),"function"==typeof cb&&cb()},800)})})}(function(){field.blur(),"function"==typeof errorCallback&&errorCallback(r)}),isClassicView&&(deleteIcon.removeClass("disabled"),editIcon.fadeIn(200))}function saveInput(){isClassicView&&(editIcon.fadeOut(200),deleteIcon.addClass("disabled"));var cb,val=$.trim(field.val());""!==onSaveURL&&"undefined"!==onSaveURL&&val!==field.attr("value")||(!isClassicView||""===val)&&isClassicView?(cb=function(){!performURLValidation||(val.match(/^[a-zA-Z]+:\/\//)||(val="http://"+val),PMW.util.isValidURL(val))?PMW.write(onSaveURL,$.extend({id:uid,val:val},additionalParams),completeLoading.bind(this)):completeLoading({status:"error"})},etf.removeClass("editing").addClass("loading"),field.attr("disabled",""),deleteIcon.fadeIn(),editControls.fadeOut(200,function(){loaderContainer.removeClass("_hidden").fadeIn(200,cb)})):resetInput()}void 0===additionalParams&&(additionalParams={}),field.on("input",updateInputWidth),field.on("focusin focusout",PMW.debounce((function(e){isClassicView&&"focusout"===e.type&&resetInput(),(etf.hasClass("ready")&&"focusin"===e.type||etf.hasClass("editing")&&"focusout"===e.type)&&transitionState()}).bind(this),200)),PMW.onClick(etf,null,function(){var temp;$(this).hasClass("ready")&&(temp=field.val(),field.focus(),field.val(""),field.val(temp),isClassicView&&editControls.removeClass("_hidden").show(),transitionState())}),field.on("keyup blur",function(e){13===e.which?(saveInput(),field.blur()):27===e.which&&(resetInput(),field.blur())}),PMW.onClick(checkIcon,null,saveInput),PMW.onClick(cancelIcon,null,resetInput),updateInputWidth()}},PMW.initEditableTextFieldV2=function(id,onDoneBtn,onCancelBtn,orderId){var fieldContainer=$("."+id),field=fieldContainer.find(".input"),cancelBtn=fieldContainer.find(".field-cancel-button"),doneBtn=fieldContainer.find(".field-done-button"),editBtn=fieldContainer.find(".editor"),keyPressListening=!1;PMW.onClick(cancelBtn,null,onCancelBtn),PMW.onClick(editBtn,null,function(){if(fieldContainer.find(".field").addClass("-edit"),field.focus(),field.attr("readonly",!1),!1===keyPressListening){keyPressListening=!0;$(field.keydown("keydown",function(event){13===event.keyCode&&onDoneBtn(orderId)}))}}),PMW.onClick(doneBtn,null,onDoneBtn.bind(this,orderId))};
PMW.initFlyOutLimits=function(c,m){var flyFromY,flyToY,toFlyOut=$(".toflyout");return PMW.onClick($(".flyoutcontainer"),".scroll-to-top",function(){PMW.util.smoothScrollTo("#nav")}),flyToY="premium"===c&&"buy"===m?(flyFromY=$("#buy-subscription .picker").offset().top-10,$("#ft").offset().top-100):(flyFromY=400,Number.MAX_SAFE_INTEGER),{toFlyOut:toFlyOut,flyFromY:flyFromY,flyToY:flyToY}},PMW.doFlyOut=function(flyParams){var w=$(window),flyOut=flyParams.toFlyOut;w.scrollTop()>=flyParams.flyFromY&&w.scrollTop()<flyParams.flyToY?($(".flyoutcontainer").removeClass("_hidden"),flyOut.removeClass("_hidden").addClass("flyout spacing-p-3").removeClass("-fade-out"),$(".flyout-placeholder").removeClass("_hidden")):flyOut.hasClass("flyout")&&(flyOut.addClass("-fade-out"),flyOut.one(PMW.util.animationEndEvents,function(){$(this).removeClass("flyout").removeClass("-fade-out"),$(".flyoutcontainer").addClass("_hidden")}),$(".flyout-placeholder").addClass("_hidden"))};
!function(){let locationsStack=[],isBackOperation=!1,originalHistoryLength=0,numBackedUp=0;function handleIFramePopState(){isBackOperation?(isBackOperation=!1,numBackedUp++):numBackedUp--}PMW.doOpenGalleryDialog=function(idFolder){PMW.openModalDialog("gallery-dialog",i18next.t("pmwjs_create_design"),{},!0,"gallery-modal -full-height",!1,{}),PMW.initGalleryDialog(idFolder),PMW.setLoading(null)},PMW.initGalleryDialog=function(idFolder){let iFrameContainer=function(idFolder){let prevIframe=document.getElementById("galleryDialogContainer");null!==prevIframe&&prevIframe.parentNode.removeChild(prevIframe);let iFrameContainer=document.createElement("div");return iFrameContainer.setAttribute("id","galleryDialogContainer"),iFrameContainer.setAttribute("class","gallery-iframe-container"),iFrameContainer.setAttribute("data-folder-id",idFolder),iFrameContainer}(idFolder),URL=PMW.util.site_url("posters/gallery?gd=1"),iFrame=function(src){let iFrame=document.createElement("iframe");return iFrame.setAttribute("id","galleryDialog"),iFrame.setAttribute("class","gallery-dialog-iframe"),iFrame.setAttribute("frameborder","0"),iFrame.setAttribute("allowtransparency","true"),iFrame.setAttribute("src",src),iFrame}(URL),galleryModal=$(".gallery-modal"),modalContent=galleryModal.find(".content");iFrameContainer.appendChild(iFrame),modalContent.html(iFrameContainer),modalContent.prepend('<div class="loader-container js-loader-container"><progress class="icon-circular-loader -loading-font"></progress></div>'),function(iFrame,galleryModal){var backAction=new ModalTopAction(i18next.t("pmwjs_back"),"icon-back",(function(iFrame,galleryModal){let dialogueBackBtn=galleryModal.find(".header .title .back"),url="";!function(iFrame){return iFrame.contentWindow.history.length-numBackedUp>originalHistoryLength}(iFrame)?(url=0<locationsStack.length?(isBackOperation=!0,locationsStack.pop()):dialogueBackBtn.attr("data-url"),url?iFrame.contentWindow.location.href=url:PMW.closeGalleryDialog(window.location.href)):(isBackOperation=!0,iFrame.contentWindow.history.back())}).bind(this,iFrame,galleryModal),"_hidden");PMW.addBackButtonToModal(galleryModal,backAction)}(iFrame,galleryModal),iFrame.onload=function(){galleryModal.find(".content .js-loader-container").hide(),function(iFrame){let galleryDialogIframe=$("#galleryDialog");galleryDialogIframe.contents().find('a[href!="javascript:void(0)"]').find(":not(.js-type-container)").find(":not(.js-item-container)").filter('a[target!="_blank"]').filter('a[target!="_top"]').filter('a[target!="_parent"]').filter(":not(a.js-custom-dimensions)").filter(":not(a.js-poster-thumbnail)").on("click",function(){$("#gallery-dialog").find(".content").find(".js-loader-container").show()}),iFrame.contentWindow.onbeforeunload=function(){isBackOperation||locationsStack.push(iFrame.contentWindow.location.href),$("#gallery-dialog").find(".content .js-loader-container").show()}}(iFrame),function(){let galleryDialogIframe=$("#galleryDialog");galleryDialogIframe.contents().find(".grid-masonry").addClass("-in-gallery-dialog")}(),function(iFrame,galleryModal){let dialogueBackBtn=galleryModal.find(".header .title .back");!function(iFrame){return 0===locationsStack.length||iFrame.contentWindow.location.href===PMW.util.site_url("posters/gallery?gd=1")}(iFrame)?dialogueBackBtn.removeClass("_hidden"):dialogueBackBtn.addClass("_hidden")}(iFrame,galleryModal),isBackOperation=!1,originalHistoryLength=iFrame.contentWindow.history.length,numBackedUp=0,iFrame.contentWindow.addEventListener("popstate",handleIFramePopState)}},PMW.closeGalleryDialog=function(url){let parentWindow=window.parent,parentDocument=parentWindow.document,iFrameContainer=parentDocument.getElementById("galleryDialogContainer"),closeButton=parentDocument.getElementsByClassName("modal-header-action close modal-btn-close")[1];var parent,idFolder;void 0!==iFrameContainer&&null!==iFrameContainer&&(parent=iFrameContainer.parentNode,null!==(idFolder=iFrameContainer.getAttribute("data-folder-id"))&&(-1<url.search("/copy/")?url+="/0/"+idFolder:-1<url.search("/create")&&(url+=(url.includes("?")?"&":"?")+"fid="+idFolder)),null!==parent&&(parentWindow.location.href=url,closeButton.click()))}}();
PMW.initPosterSizesList=function(){PMW.onClick($(".dropdown-title-container"),null,function(){var p=$(this).closest(".dropdown-toggle.-sizes");0<p.length&&(p.hasClass("-expanded")&&p.toggleClass("-open"),p.hasClass("-open")?p.find(".dropdown").removeClass("hidden").css("width",p.width()):p.find(".dropdown").addClass("hidden"))})};
PMW.initAccordion=function(){let acc=document.getElementsByClassName("accordion-header"),i;for(i=0;i<acc.length;i++)acc[i].addEventListener("click",function(){this.classList.toggle("-active")})},PMW.initModernAccordion=function(el,beforeAnimationStart=$.noop,onAccordionStateChange=$.noop){PMW.onClick(el,".accordion-btn",function(){let el=$(this),selectedAccordion=el.closest(".accordion-modern"),content=selectedAccordion.find(".content");beforeAnimationStart(selectedAccordion),selectedAccordion.hasClass("selected")?(content.addClass("-closed"),selectedAccordion.removeClass("selected")):(content.removeClass("-closed").addClass("-slidedown"),selectedAccordion.addClass("selected")),onAccordionStateChange(selectedAccordion)})};
!function(){function onScrollableTextMouseEnter_(){let itemName=$(this),previousScrollVal,intervalVal=1;if(this.offsetWidth<this.scrollWidth){itemName.css("text-overflow","unset");let timeout=setInterval(function(){previousScrollVal=itemName.scrollLeft(),itemName.scrollLeft(intervalVal),intervalVal++,itemName.is(":hover")||(clearInterval(timeout),itemName.scrollLeft(0),itemName.css("text-overflow","ellipsis"))},25)}}PMW.initTextScrollOnHover_=function(){$(document).on("mouseenter",".scroll-text-on-hover",onScrollableTextMouseEnter_)}}();
function setMaxWidthForSubfilterNameContainers(){const subfilterNameContainers=$(".js-subfilter-name-container");subfilterNameContainers.each(function(){const subfilterNameContainer=$(this);subfilterNameContainer.css("max-width",subfilterNameContainer.find(".js-subfilter-label")[0].getBoundingClientRect().width)})}function onCarouselNext_(el){el.animate({scrollLeft:"+="+el.width()},{duration:1e3,easing:"easeOutQuint"})}function onCarouselPrev_(el){el.animate({scrollLeft:"-="+el.width()},{duration:1e3,easing:"easeOutQuint"})}function toggleScrollButtonsVisibility_(el,prev,next,scrollDiff){0<el.scrollLeft()?prev.removeClass("_hidden"):prev.addClass("_hidden"),Math.floor(el.get(0).scrollWidth-Math.ceil(el.scrollLeft())-el.width())<=scrollDiff?next.addClass("_hidden"):next.removeClass("_hidden")}PMW.initSubcategoryCarousel=function(sc,cc,lazyLoadMasonary,loadOnScroll=!0){if(0<sc.length&&0<cc.length){const sel="img.ignore-grid-masonry:not(.-loaded)";(lazyLoadMasonary=void 0!==lazyLoadMasonary&&lazyLoadMasonary)&&PMW.lazyLoadNonMasonryGrid(sc,sel,"-loaded",null,loadOnScroll),PMW.onClick(cc,".prev",function(){PMW.gtm.trackGA4CarouselPreviousEvent(PMW.gtm.CAROUSEL_ANALYTICS_EVENT_NAME.SUBCATEGORY),onCarouselPrev_(sc),lazyLoadMasonary&&PMW.lazyLoadNonMasonryGrid(sc,sel,"-loaded",null,loadOnScroll)}),sc.on("scroll",PMW.debounce(function(){toggleScrollButtonsVisibility_(sc,$(".prev"),$(".next"),0),lazyLoadMasonary&&PMW.lazyLoadNonMasonryGrid(sc,sel,"-loaded",null,loadOnScroll)},5)),PMW.onClick(cc,".next",function(){PMW.gtm.trackGA4CarouselNextEvent(PMW.gtm.CAROUSEL_ANALYTICS_EVENT_NAME.SUBCATEGORY),onCarouselNext_(sc),lazyLoadMasonary&&PMW.lazyLoadNonMasonryGrid(sc,sel,"-loaded",null,loadOnScroll)}),0<sc.get(0).scrollWidth-sc.width()&&$(".next").removeClass("_hidden"),PMW.initVideosForPlayOnHover(sc),setMaxWidthForSubfilterNameContainers()}};
!function(){const DATA_NOT_LOADED="0",DATA_LOADED="1",DATA_NOT_WAITING="0",DATA_WAITING="1",YOUTUBE_ASSIGNED_SCRIPT_ID="www-widgetapi-script";function onYoutubeScriptLoaded(){!function(){var waitingVideosArray=$(`.js-youtube-video[data-waiting-yt=${DATA_WAITING}][data-loaded-yt=${DATA_NOT_LOADED}]`);for(let i=0;i<waitingVideosArray.length;i++){let waitingVideo=$(waitingVideosArray[i]);waitingVideo.attr("data-waiting-yt",DATA_NOT_WAITING),initYTPlayer(waitingVideo)}}(),initVideosInViewPort(),window.addEventListener("scroll",PMW.debounce(initVideosInViewPort,20),{passive:!0})}function initVideosInViewPort(){var videosArray=$(`.js-youtube-video[data-loaded-yt=${DATA_NOT_LOADED}]`);for(let i=0;i<videosArray.length;i++){var video=$(videosArray[i]);isInViewPort(videosArray[i])&&initYTPlayer(video)}}function lazyLoadYoutubeScript(){var videosArray=$(`.js-youtube-video[data-loaded-yt=${DATA_NOT_LOADED}]`);for(let i=0;i<videosArray.length;i++)isInViewPort(videosArray[i])&&!document.getElementById(YOUTUBE_ASSIGNED_SCRIPT_ID)&&($(videosArray[i]).attr("data-waiting-yt",DATA_WAITING),function(){let tag=document.createElement("script");tag.src="https://www.youtube.com/iframe_api";let firstScriptTag=document.getElementsByTagName("script")[0];firstScriptTag.parentNode.insertBefore(tag,firstScriptTag)}())}function initYTPlayer(videoElement){new YT.Player(videoElement.attr("id"),{height:"100%",width:"100%",videoId:videoElement.attr("data-src"),host:"https://www.youtube-nocookie.com",playerVars:{controls:1,modestbranding:1,rel:0,iv_load_policy:3,loop:0,enablejsapi:1,fullscreen:1,autohide:1,wmode:"transparent"},events:{onReady:onPlayerReady,onStateChange:onPlayerStateChange}})}function onPlayerReady(event){let iframe=$(event.target.h);iframe.siblings(".js-youtube-placeholder").remove(),iframe.attr("data-loaded-yt",DATA_LOADED)}function onPlayerStateChange(event){let trackingAttr=$(event.target.h).attr("data-trackGAParams");if(trackingAttr&&-1===event.data){let trackingParamsArray=trackingAttr.split(","),trackingParams=trackingParamsArray.map(function(param){return""===param?null:param}),[,action,label]=trackingParams;PMW.gtm.trackGA4CustomEvent(action,{param:label})}}function isInViewPort(video){return video.getBoundingClientRect().top<=window.innerHeight&&0<=video.getBoundingClientRect().bottom}PMW.initYoutubeEmbeddedVideos=function(){0===$(".js-youtube-video[data-loaded-yt]").length&&$(".js-youtube-video").attr("data-loaded-yt",DATA_NOT_LOADED),lazyLoadYoutubeScript(),window.addEventListener("scroll",PMW.debounce(lazyLoadYoutubeScript,20),{passive:!0}),window.onYouTubeIframeAPIReady=onYoutubeScriptLoaded}}();
PMW.posterTypesSearchOnInputText=function(e){let searchTerm,results,el=$(this).closest(".js-search-field-container"),posterTypes=el.find(".js-poster-types");searchTerm=e.target.value.trim(),posterTypes.width(el.find(".js-element-for-width").outerWidth()),0<searchTerm.length?(posterTypes.removeClass("_hidden"),"keyup"===e.type&&38!==e.keyCode&&40!==e.keyCode&&13!==e.keyCode&&(el.find(".search-results-container").scrollTop(0),el.find(".-keyboardfocus").removeClass("-keyboardfocus"))):(el.find(".-keyboardfocus").removeClass("-keyboardfocus"),posterTypes.addClass("_hidden")),el.find(".js-searchable-item").each(function(index,element){let textElement=(element=$(element)).children(".poster-type-name");-1<textElement[0].textContent.toLowerCase().indexOf(searchTerm.toLowerCase())?element.removeClass("_hidden"):element.addClass("_hidden")}),(results=el.find(".js-searchable-item:not(._hidden)"))&&!results.length?posterTypes.addClass("_hidden"):posterTypes.removeClass("_hidden")},PMW.onViewMoreInSearchResults=function(){let el=$(this).siblings(".search-results-container");el[0].scrollHeight>el.height()&&el.animate({scrollTop:"+="+el.height()},{duration:1e3})},PMW.onSearchArrowsUpDown=function(keyCode,searchContainer){if(!searchContainer.find(".poster-types").hasClass("_hidden")){let hoverItem=searchContainer.find(".js-searchable-item.-keyboardfocus"),searchResultsContainer=searchContainer.find(".search-results-container");if(38===keyCode)if(hoverItem.hasClass("-keyboardfocus")){let selected=hoverItem.removeClass("-keyboardfocus").prevAll(".js-searchable-item:not(._hidden)").first();selected.addClass("-keyboardfocus"),searchResultsContainer.animate({scrollTop:"-="+hoverItem.outerHeight()})}else searchResultsContainer.children(".js-searchable-item:not(._hidden)").first().addClass("-keyboardfocus");else if(40===keyCode){let lastPosterType=searchContainer.find(".js-searchable-item:not(._hidden)").slice(-1);if(!lastPosterType.hasClass("-keyboardfocus")&&hoverItem.hasClass("-keyboardfocus")){let selected=hoverItem.removeClass("-keyboardfocus").nextAll(".js-searchable-item:not(._hidden)").first();selected.addClass("-keyboardfocus"),searchResultsContainer.animate({scrollTop:"+="+hoverItem.outerHeight()})}else lastPosterType.hasClass("-keyboardfocus")||searchResultsContainer.children(".js-searchable-item:not(._hidden)").first().addClass("-keyboardfocus")}}},PMW.onEnterKey=function(keyCode,searchContainer){let searchResults=searchContainer.find(".poster-types"),hoverItem=searchContainer.find(".js-searchable-item.-keyboardfocus");13===keyCode&&!searchResults.hasClass("_hidden")&&hoverItem.hasClass("-keyboardfocus")&&(window.location=hoverItem.attr("href"))},PMW.hideSearchResults=function(trigger,target,searchField){trigger===target||trigger.has(target).length||target===searchField[0]||searchField.has(target).length||trigger.addClass("_hidden")},PMW.toggleShowMoreResults=function(sc){0<sc.length&&sc[0].scrollHeight>sc.scrollTop()+sc.innerHeight()?$(".view-more-results").removeClass("_hidden"):$(".view-more-results").addClass("_hidden")};
PMW.initSearchResults=function(){const ENTER_KEY_CODE=13;function hideClearIcon(inputField){let visibleInputField=inputField.filter(":visible"),inputContainer=$(visibleInputField.parent(".input-field-container"));$(inputContainer.find(".search-icon")).removeClass("_hidden"),$(inputContainer.find(".clear-icon")).addClass("_hidden")}PMW.showClearIcon=function(inputField){let visibleInputField=inputField.filter(":visible");if(0!==visibleInputField.val().length){let inputContainer=$(visibleInputField.parent(".input-field-container"));$(inputContainer.find(".search-icon")).addClass("_hidden"),$(inputContainer.find(".clear-icon")).removeClass("_hidden")}},PMW.initClearIconOnTyping=function($input,cbTyping=null,cbDoneTyping=null){let typingTimer;$input.on("keyup",function(){clearTimeout(typingTimer),typingTimer=setTimeout((function(){"function"==typeof cbDoneTyping&&cbDoneTyping($input)}).bind(this),300)}),$input.on("keydown",function(){clearTimeout(typingTimer),"function"==typeof cbTyping&&cbTyping($(this))})};let inputField=$(".js-search-field-input"),inputFieldContainer=$(".js-input-field-container");PMW.initClearIconOnTyping(inputField,hideClearIcon),inputField.each(function(){let searchForm=$(this).closest(".js-search-field-container"),searchContainer=searchForm.find(".main-search-container"),searchResultsContainer=searchContainer.find(".search-results-container");PMW.onClick(searchContainer.find(".js-view-more"),null,function(){PMW.onViewMoreInSearchResults.call(this)}),$(this).on("keyup change",PMW.posterTypesSearchOnInputText),searchForm.find(".js-search-input-form").on("keypress",function(e){if(e.which===ENTER_KEY_CODE&&searchResultsContainer&&!searchResultsContainer.hasClass("_hidden")&&0<searchResultsContainer.children(".-keyboardfocus").length)return e.preventDefault(),!1}),searchContainer.keyup(function(e){return PMW.toggleShowMoreResults($(this).find(".search-results-container")),0===$(this).parents("#create-from-scratch").length&&PMW.onEnterKey(e.keyCode,$(this)),PMW.onSearchArrowsUpDown(e.keyCode,$(this))}),searchResultsContainer.length&&searchResultsContainer[0].addEventListener("scroll",PMW.debounce(PMW.toggleShowMoreResults.bind(this,searchResultsContainer),10),{passive:!0});let w=$(window);w.click(function(e){var trigger=searchForm.find(".poster-types"),searchBox=searchForm.find(".search-box");PMW.hideSearchResults(trigger,e.target,searchBox)})}),PMW.onClick(inputFieldContainer,".clear-icon",(function(inputField){inputField.val(""),hideClearIcon(inputField)}).bind(this,inputField))};
!function(){let iconClose=$(".js-icon-close-banner"),notificationBannerContainer=$(".js-nav-notification-container");0<iconClose.length&&PMW.onClick(iconClose,null,function(){PMW.util.setCookie(iconClose.attr("data-close-cookie"),"1",7),notificationBannerContainer.css("display","none")})}();
PMW.initTemplatesGalleryToggle=function(dropdownContainer,dropdownOptions){if(PMW.util.isInGalleryDialog()&&PMW.isMobileScreenWidth()){let dropdownInitialValue=$(".dropdown-gallery-dialog-top-bar .js-dropdown-title-container");if(0<dropdownInitialValue.length){let dropdownTitle=dropdownInitialValue[0].getElementsByClassName("title")[0];dropdownTitle.textContent=i18next.t("pmwjs_themes")}}function hideDropdown(){dropdownOptions.addClass("_hidden").removeClass("-show-dropdown"),dropdownContainer.removeClass("-open -dropdown-selected")}setTimeout(function(){$(document).on(PMW.click,function(e){dropdownContainer.hasClass("-open -dropdown-selected")&&hideDropdown()})},100),PMW.onClick(dropdownContainer,null,function(e){e.stopPropagation();let d=dropdownOptions,otherDropdown=dropdownContainer.parents(".top-bar-content").find(".js-top-bar-dropdown.-open.-dropdown-selected");d.hasClass("_hidden")?(d.removeClass("_hidden").addClass("-show-dropdown"),dropdownContainer.addClass("-open -dropdown-selected")):hideDropdown(),0<otherDropdown.length&&(otherDropdown.find(".js-top-bar-dropdown-option").addClass("_hidden").removeClass("-show-dropdown"),otherDropdown.removeClass("-open -dropdown-selected"))}),PMW.onClick(dropdownContainer.find(".dropdown-item"),dropdownContainer,function(e){window.location.href=$(this).find(".option-link").attr("href")})};
const FAVORITE_ICON_FILLED_CLASS="-filled",FAVORITES_CACHE="favorites_cache",LAST_UPDATED_DEFAULT_VAL=0,TEMPLATE_FAVORITE_ANALYTICS_CATEGORY="Gallery",TEMPLATE_FAVORITE_ANALYTICS_ACTION_ADD_FAVORITE="Favorite",TEMPLATE_FAVORITE_ANALYTICS_ACTION_REMOVE_FAVORITE="Unfavorite",DEFAULT_FAVORITE_ICON_SIZE=16,FAVORITE_GA4_EVENT_NAME="DesignGallery_FavoriteTemplate",FAVORITE_RECOMMENDED_TEMPLATE_GA4_EVENT_NAME="DesignGallery_FavoriteRecommendedTemplate";function getFavoritesCache(){return PMW.getCacheItem(FAVORITES_CACHE)||{lastUpdated:LAST_UPDATED_DEFAULT_VAL,lastUpdateAttempt:LAST_UPDATED_DEFAULT_VAL,posterHashIdMap:{},userId:null}}function updateFavoritesCache(updateMap,lastUpdated){var favoritesCache=getFavoritesCache();let posterHashIdMap=favoritesCache.posterHashIdMap,lastUpdatedOld=favoritesCache.lastUpdated,userId=favoritesCache.userId;lastUpdated=lastUpdated||lastUpdatedOld,posterHashIdMap={...posterHashIdMap,...updateMap},userId=userId||PMW.getUserId(),Object.keys(updateMap).forEach(function(posterHashId){posterHashIdMap[posterHashId]&&delete posterHashIdMap[posterHashId]}),PMW.setCacheItem(FAVORITES_CACHE,{...favoritesCache,posterHashIdMap:posterHashIdMap,lastUpdated:lastUpdated,userId:userId})}function hasHourPassedSinceLastFavoriteCacheUpdateAttempt(){var favoritesCache=getFavoritesCache();return(new Date).getTime()-favoritesCache.lastUpdateAttempt>ONE_HOUR_IN_MILLISECONDS}function recordUpdateFavoritesCacheAttempt(){var favoritesCache=getFavoritesCache(),currentTimestamp=(new Date).getTime();PMW.setCacheItem(FAVORITES_CACHE,{...favoritesCache,lastUpdateAttempt:currentTimestamp})}function clearCacheIfItDoesNotMatchCurrentUser(){PMW.getUserId()!==getFavoritesCache().userId&&PMW.clearNamespaceFromCache(PMW.cacheNamespace+"."+FAVORITES_CACHE)}function setupTemplatePreviewCTAs(){initResponsiveToolTips(),PMW.prepMarkupForShareDropdown(),initShareIconsPermahover(),updateFavoritesClickLink(),attachToggleFavoriteTemplateHandlers(),PMW.addFavoritesSvgToIcons()}function getNodes(selectorString,newNodes=null){return null!==newNodes?newNodes.find(selectorString):$(selectorString)}function getFavoriteSvg(iconSize){return $(`<svg class="heart-svg" fill="none" height="${iconSize}" viewBox="0 0 ${iconSize} ${iconSize}" width="${iconSize}" xmlns="http://www.w3.org/2000/svg">
            <path class="heart-path js-modify-favorite-fill" transform="scale(${iconSize/33})" d="m28.9167 6.64481c-.717-.717-1.5679-1.286-2.5039-1.674-.9361-.388-1.941-.588-2.955-.588s-2.018.2-2.9541.588c-.937.388-1.7879.957-2.5049 1.674l-1.4881 1.488-1.488-1.488c-1.448-1.448-3.4119-2.261-5.45895-2.261-2.047 0-4.011.813-5.459 2.261s-2.261 3.41099-2.261 5.45899c0 2.047.813 4.011 2.261 5.459l11.71995 11.72c.379.379.993.379 1.3711 0l11.72-11.72c.717-.717 1.2859-1.568 1.674-2.504.388-.936.5879-1.941.5879-2.955s-.1999-2.018-.5879-2.95399c-.3881-.936-.957-1.788-1.674-2.504z"/>
        </svg>`)}function getIconSize(iconLackingSvg){const classList=iconLackingSvg.attr("class"),sizeMatch=classList.match(/size-icon-\d\d/);if(null===sizeMatch)return DEFAULT_FAVORITE_ICON_SIZE;var sizeNumber=Number(sizeMatch[0].slice(-2));return Number.isNaN(sizeNumber)?DEFAULT_FAVORITE_ICON_SIZE:sizeNumber}function isTemplateUnFavorited(posterHashId,posterHashIdMap){let isRemoved=posterHashIdMap[posterHashId];return void 0===isRemoved&&(isRemoved=!0),Boolean(isRemoved)}function updateFavoriteView(favoriteIconContainerSelector){const posterHashIdMap=getFavoritesCache().posterHashIdMap,favoriteIconContainer=new FavoriteIconContainer($(favoriteIconContainerSelector),!1);favoriteIconContainer.updateFavoriteStatus(isTemplateUnFavorited(favoriteIconContainer.posterHashId,posterHashIdMap))}function attachToggleFavoriteTemplateHandlers(){if(PMW.isUserLoggedIn())if(isPreviewDialogOpen())PMW.onClick($("#pdlg"),".js-toggle-fav",handleFavoriteClick);else{const pageGrid=$(".js-page-grid").not("[data-favorites-click-initialized]");0!==pageGrid.length&&(PMW.onClick(pageGrid,".js-toggle-fav",handleFavoriteClick),pageGrid.attr("data-favorites-click-initialized","1"))}}function handleFavoriteClick(){const favoriteIconContainer=new FavoriteIconContainer($(this));if(favoriteIconContainer.isInMyStuff){let tooltipEl=$(".tooltip");0<tooltipEl.length?tooltipEl.remove():$.noop(),PMW.openMessageModal({title:i18next.t("pmwjs_favorite_mystuff_removal_confirmation_title"),text:i18next.t("pmwjs_favorite_mystuff_removal_confirmation_text"),contentClassName:"_unpadded-bottom",ctaButton:{text:i18next.t("pmwjs_favorite_mystuff_removal_confirmation_button"),onClick:()=>{confirmedClick(favoriteIconContainer),PMW.closeMessageModal()},classes:"-fullwidth -noun"}})}else confirmedClick(favoriteIconContainer)}function confirmedClick(favoriteIconContainer){var isTemplateAboutToBeUnFavorited=favoriteIconContainer.favoriteIcon.attr("class").includes(FAVORITE_ICON_FILLED_CLASS);handleFavoriteChange(favoriteIconContainer,isTemplateAboutToBeUnFavorited),doesOptimisticFeedbackMatchCurrentCache(isTemplateAboutToBeUnFavorited,favoriteIconContainer.posterHashId)||sendFavoriteClickRequest(favoriteIconContainer,isTemplateAboutToBeUnFavorited)}function trackFavoriteGAEvent(ajaxResponse,favoriteIconContainer){var eventName=favoriteIconContainer.isRecommendedPoster()?FAVORITE_RECOMMENDED_TEMPLATE_GA4_EVENT_NAME:FAVORITE_GA4_EVENT_NAME;PMW.gtm.trackGA4CustomEvent(eventName,{hashedId:favoriteIconContainer.posterHashId})}function sendFavoriteClickRequest(favoriteIconContainer,isTemplateAboutToBeUnFavorited){PMW.write(PMW.util.site_url("user/toggleFavoriteTemplate"),{posterHashId:favoriteIconContainer.posterHashId}).done(function(response){"success"===response.status?(trackFavoriteGAEvent(response,favoriteIconContainer),favChangeSuccess(favoriteIconContainer,response,isTemplateAboutToBeUnFavorited)):"error"===response.status&&(""===response.message?favChangeError(favoriteIconContainer,isTemplateAboutToBeUnFavorited):alert(response.message))}).fail(function(){favChangeError(favoriteIconContainer,isTemplateAboutToBeUnFavorited)})}function favChangeSuccess(favoriteIconContainer,response,optimisticFeedback){const isRemoved=response.data.isRemoved,updateMap={},isOptimisticFeedbackCorrect=optimisticFeedback===Boolean(isRemoved);updateMap[favoriteIconContainer.posterHashId]=isRemoved?1:0,updateFavoritesCache(updateMap,null),isOptimisticFeedbackCorrect||handleFavoriteChange(favoriteIconContainer,isRemoved)}function doesOptimisticFeedbackMatchCurrentCache(optimisticFeedback,posterHashId){return isTemplateUnFavorited(posterHashId,getFavoritesCache().posterHashIdMap)===optimisticFeedback}function favChangeError(favoriteIconContainer,assumedIsRemoved){handleFavoriteChange(favoriteIconContainer,!assumedIsRemoved),favoriteIconContainer.showErrorTooltip(assumedIsRemoved)}function handleFavoriteChange(favoriteIconContainer,isRemoved){favoriteIconContainer.isInMyStuff?toggleThumbnailVisibility(favoriteIconContainer.thumbnail,isRemoved):favoriteIconContainer.updateFavoriteStatus(isRemoved)}function toggleThumbnailVisibility(thumbnail,aboutToBeRemoved){thumbnail.toggleClass("_hidden",aboutToBeRemoved),$(".grid-masonry").masonry({transitionDuration:0,itemSelector:".thumbnail",columnWidth:".sizer",gutter:".gutter-sizer"});var isGridEmpty=2===$("ul.grid-masonry").children().not("._hidden").length;$(".empty-fav-state").toggleClass("_hidden",!isGridEmpty),$(".js-favorites-heading").toggleClass("_hidden",isGridEmpty)}function initShareIconsPermahover(){if(!isPreviewDialogOpen()){const pageGrid=$(".js-page-grid").not("[data-share-permahover-initialized]");0!==pageGrid.length&&(PMW.onClick(pageGrid,".js-share-icon",giveShareIconPermahover),pageGrid.attr("data-share-permahover-initialized","1"))}}function giveShareIconPermahover(){const shareIcon=$(this),shortcutOverlay=shareIcon.parents(".template-shortcut-overlay"),thumbnail=shareIcon.parents(".thumbnail"),isActive=shareIcon.hasClass("permahover-active");isActive||(shortcutOverlay.addClass("permahover"),thumbnail.addClass("permahover"),shareIcon.addClass("permahover-active"),setTimeout(function(){$(document.body).one(PMW.click,null,null,function(){shortcutOverlay.removeClass("permahover"),thumbnail.removeClass("permahover"),shareIcon.removeClass("permahover-active"),$(this).off("keydown.share-dropdown-keypress")})},100),handleKeyPressForShareIcon(shareIcon))}function handleKeyPressForShareIcon(shareIcon){setTimeout(addShareDropdownKeyPressHandler.bind(shareIcon),100)}function addShareDropdownKeyPressHandler(){const shareIcon=$(this);$(document.body).one("keydown.share-dropdown-keypress",null,null,function(e){const unsetKeys=[9,13,27];unsetKeys.includes(e.keyCode)?shareIcon.siblings(".js-share-dropdown").trigger(PMW.click):handleKeyPressForShareIcon(shareIcon)})}function updateFavoritesClickLink(){PMW.onClick($(".my-stuff-favorites-list"),".-gallery-thumbnail .preview",function(e){e.preventDefault();const editAnchor=$(this).closest(".js-gallery-thumbnail").find(".js-edit-icon").parent();window.open(editAnchor.attr("href"),"_self")})}function handleEditIconRemovalIfSmallThumbnail(thumbnail){const editIcon=thumbnail.closest(".js-gallery-thumbnail").find(".js-edit-icon");var editIconHeight,editIconTopOffset;0!==editIcon.length&&(editIconHeight=editIcon.outerHeight(),editIconTopOffset=getCssPixels(editIcon,"top"),thumbnail.outerHeight()-2*(editIconHeight+editIconTopOffset)<8&&editIcon.addClass("_hidden"))}function centerBottomIconsIfSmallThumbnail(thumbnail){const shareIcon=thumbnail.closest(".js-gallery-thumbnail").find(".js-share-icon"),favoriteIconContainer=thumbnail.closest(".js-gallery-thumbnail").find(".favorite-tooltip");var shareIconHeight,shareIconBottomOffset;0!==shareIcon.length&&(shareIconHeight=shareIcon.outerHeight(),shareIconBottomOffset=getCssPixels(shareIcon,"bottom"),thumbnail.outerHeight()-(shareIconHeight+shareIconBottomOffset)<12&&(shareIcon.css("bottom",(thumbnail.outerHeight()-shareIconHeight)/2+"px"),0<favoriteIconContainer.length?favoriteIconContainer.css("bottom",(thumbnail.outerHeight()-shareIconHeight)/2+shareIconHeight+"px"):$.noop()))}function getCssPixels(selector,cssProp){return Number(selector.css(cssProp).slice(0,-2))}function toggleClassForSvg(svgSelector,className,shouldClassBeActive){var classNames=svgSelector.attr("class");shouldClassBeActive?svgSelector.attr("class",classNames+" "+className):svgSelector.attr("class",PMW.util.replaceAll(className,"",classNames).trim())}PMW.mergePMW(PMW,{initializeTemplatePreviewCTAs:function(shareButtonOptions={}){var gaOptions={descTag:$(".headings-gallery h1").text().replace(/\s+/g," "),...shareButtonOptions.gaOptions||{}},shareButtonSelectors={primarySelector:".js-page-grid",secondarySelector:".js-share-icon",...shareButtonOptions.shareButtonSelectors||{}};PMW.setupShareHandlers(gaOptions,shareButtonSelectors),setupTemplatePreviewCTAs()},initializeGridWithFavoritesCallback:function(gridOptions){PMW.initGrid(gridOptions.gridSelector,gridOptions.loadingMessageContainer,gridOptions.scrollingContainer,gridOptions.serverParams,lazyLoadData=>{PMW.addFavoritesSvgToIcons(lazyLoadData),$.isFunction(gridOptions.lazyLoadingCallback)&&gridOptions.lazyLoadingCallback(lazyLoadData)})},initializeTemplateGridWithPreviewShortcuts:function(gridOptions,shareButtonOptions={}){PMW.initializeTemplatePreviewCTAs(shareButtonOptions),PMW.initializeGridWithFavoritesCallback(gridOptions)},handleSmallTemplates:function(){const templatesToCheck=$(".thumbnail .preview-container .preview").not("[data-template-height-checked]");templatesToCheck.attr("data-template-height-checked","1"),templatesToCheck.each(function(){handleEditIconRemovalIfSmallThumbnail($(this)),centerBottomIconsIfSmallThumbnail($(this))})},addFavoritesSvgToIcons:function(newNodes=null){if(PMW.isUserLoggedIn()){const iconsLackingSvg=getNodes(".js-needs-favorite-svg",newNodes);iconsLackingSvg.each(key=>{const iconLackingSvg=$(iconsLackingSvg[key]),iconSize=getIconSize(iconLackingSvg),favoriteSvg=getFavoriteSvg(iconSize);iconLackingSvg.append(favoriteSvg),updateFavoriteView(iconLackingSvg.closest(".js-toggle-fav")),iconLackingSvg.removeClass("js-needs-favorite-svg")})}}}),PMW.invalidateFavoritesCache=function(){clearCacheIfItDoesNotMatchCurrentUser(),hasHourPassedSinceLastFavoriteCacheUpdateAttempt()&&PMW.readLocal("user/checkFavoritesCacheOfUser",{lastUpdated:getFavoritesCache().lastUpdated}).then(function(data){recordUpdateFavoritesCacheAttempt(),updateFavoritesCache(data.updateMap,data.lastUpdated)}).catch(()=>null)};class FavoriteIconContainer{constructor(favoriteIconContainer,isUserDriven=!0){(this.isUserDriven=isUserDriven)&&(this.isInPreviewDialog=isInPreviewDialog(favoriteIconContainer),this.isInMyStuff=isInMyStuff(favoriteIconContainer),this.tooltip=favoriteIconContainer.closest(".favorite-tooltip")),this.posterHashId=favoriteIconContainer.attr("data-poster-hash"),this.thumbnail=favoriteIconContainer.closest(".-gallery-thumbnail"),this.buttonTextContainer=favoriteIconContainer.find(".-long"),this.favoriteIcon=favoriteIconContainer.find(".js-modify-favorite-fill")}updateFavoriteStatus(isRemoved){if(this.updateFavoriteIcon(isRemoved),isRemoved?this.showMarkAsNonFavoriteTexts():this.showMarkAsFavoriteTexts(),this.showTooltip(!1),this.isInPreviewDialog){var galleryFavoriteIcon=$(`.js-page-grid .js-toggle-fav[data-poster-hash = ${this.posterHashId}]`).not(".js-needs-favorite-svg");if(0<galleryFavoriteIcon.length){const galleryFavoriteIconContainer=new FavoriteIconContainer(galleryFavoriteIcon);galleryFavoriteIconContainer.updateFavoriteStatus(isRemoved)}}}showMarkAsNonFavoriteTexts(){this.updateTextsToShow({pdlg:i18next.t("pmwjs_removed_from_fav_pdlg"),gallery:i18next.t("pmwjs_removed_from_fav_gallery")})}showMarkAsFavoriteTexts(){this.updateTextsToShow({pdlg:i18next.t("pmwjs_added_to_fav_pdlg"),gallery:i18next.t("pmwjs_added_to_fav_gallery")})}updateTextsToShow(textToShow){void 0!==this.tooltip?this.tooltip.attr("title",textToShow.gallery):$.noop(),0<this.buttonTextContainer.length?this.buttonTextContainer.html(textToShow.pdlg):$.noop()}updateFavoriteIcon(isRemoved){toggleClassForSvg(this.favoriteIcon,FAVORITE_ICON_FILLED_CLASS,!isRemoved)}showErrorTooltip(assumedIsRemoved){var errorText=assumedIsRemoved?i18next.t("pmwjs_removing_from_fav_error"):i18next.t("pmwjs_adding_to_fav_error");this.tooltip.attr("title",errorText),this.showTooltip(!0)}showTooltip(isErrorTooltip){if(this.isUserDriven){const tooltip=this.tooltip;this.isModalOverlaying()?tooltip.removeAttr("title"):(tooltip.toggleClass("error-tooltip",isErrorTooltip),tooltip.mouseenter())}}isModalOverlaying(){return!this.isInPreviewDialog&&(isPreviewDialogOpen()||isMessageModalOpen())}isRecommendedPoster(){return 0<this.thumbnail.length?"1"===this.thumbnail.attr("data-is-recommendation"):!!(0<this.buttonTextContainer.length&&this.isInPreviewDialog)&&"1"===this.buttonTextContainer.parents("#pdlg").attr("data-is-recommendation")}}function isInPreviewDialog(favoriteIconContainer){return 0<favoriteIconContainer.parents("#pdlg").length}function isInMyStuff(favoriteIconContainer){return 0<favoriteIconContainer.parents(".my-stuff-favorites-list").length}function isPreviewDialogOpen(){return 0<$("#pdlg").not(".-closing").length}function isMessageModalOpen(){return 0<$(".modal-open").not(".-closing").length}
!function(){function getSocialAnchorForShareDropdown(socialClassName,socialSvgLink,socialLangString){return`<a class="share-item js-share-item ${socialClassName}" style="display: flex !important;">
                <img class="share-dropdown-svg js-svg-icon" src='${PMW.util.asset_url(socialSvgLink)}' alt=""/>
                <span class="title body-xs">${i18next.t(socialLangString)}</span>
            </a>`}PMW.initShareToSocialsCTA=function(shareDropdownEl,shareBtnEl=null){let shareDropdown=shareDropdownEl,shareBtnWidth=shareBtnEl.hasClass("js-ignore-for-dropdown-width")?0:shareBtnEl.outerWidth(),shareDropdownWidth=Math.ceil(.75*shareBtnWidth),isActive=!shareDropdown.hasClass("-share-hide");function isCSSPositionSet(...cssPositions){return cssPositions.every(pos=>null!==pos)}function getCssPixels(selector,cssProp){return void 0!==selector.css(cssProp)?Number(selector.css(cssProp).slice(0,-2)):null}isActive||(shareDropdown.removeClass("-share-hide"),shareDropdown.css("display","block").css("width",shareDropdownWidth+"px"),function(shareDropdown){var rightOffset=$("#template-preview-modal").is(":visible");if(rightOffset){var bottomOffset=shareBtnWidth-shareDropdown.outerWidth();0<$(".preview-detail-mobile").length&&PMW.isUserLoggedIn()?shareDropdown.css("left",Math.max(bottomOffset,0)+"px"):shareDropdown.css({"margin-left":bottomOffset+"px","margin-top":PMW.isUserLoggedIn()?"-4px":"4px"})}else{const shareIcon=shareDropdown.siblings(".share-icon"),posRight=getCssPixels(shareIcon,"right"),posBottom=getCssPixels(shareIcon,"bottom");isCSSPositionSet(posRight,posBottom)?(rightOffset=posRight+shareIcon.outerWidth()+4+"px",bottomOffset=posBottom+shareIcon.outerHeight()-shareDropdown.outerHeight()+"px",shareDropdown.css({right:rightOffset,bottom:bottomOffset}),function(shareDropdown,shareIcon,dropdownMargin){let left=shareDropdown.offset()["left"],rightOffset=getCssPixels(shareDropdown,"right"),bottomOffset=getCssPixels(shareDropdown,"bottom"),bottomOffsetChanged=!1;isCSSPositionSet(rightOffset,bottomOffset)&&(left<0&&(rightOffset-=shareDropdown.outerWidth()+dropdownMargin,bottomOffset-=shareIcon.outerHeight()+dropdownMargin,bottomOffsetChanged=!0,shareDropdown.css({right:rightOffset,bottom:bottomOffset})),function(element){return element.offset().top+element.outerHeight()-window.scrollY>$(window).outerHeight()}(shareDropdown)&&(bottomOffsetChanged?bottomOffset+=2*dropdownMargin+shareIcon.outerHeight()+shareDropdown.outerHeight():bottomOffset+=shareDropdown.outerHeight()-shareIcon.outerHeight(),shareDropdown.css({right:rightOffset,bottom:bottomOffset})))}(shareDropdown,shareIcon,4)):shareDropdown.css("margin-left",shareBtnWidth-shareDropdown.outerWidth()+"px")}}(shareDropdown),setTimeout(function(){$(document.body).one(PMW.click,null,null,function(){shareDropdown.addClass("-share-hide"),$(this).off("keydown.share-dropdown-keypress")})},100),function handleKeyPressForShareDropdown(shareDropdown_){setTimeout(function(){$(document.body).one("keydown.share-dropdown-keypress",null,null,function(e){const TAB=9;9===e.keyCode&&shareDropdown_.trigger(PMW.click),handleKeyPressForShareDropdown(shareDropdown_)})},100)}(shareDropdown))},PMW.onShareToPinterest=function(description){let el=$(this);window.open("https://pinterest.com/pin/create/button/?url="+encodeURIComponent(el.attr("data-link"))+"&media="+encodeURIComponent(el.attr("data-imagesrc"))+"&description="+encodeURIComponent(description),"sharer","toolbar=0,status=0,width=626,height=436")},PMW.onShareToWhatsapp=function(description){let el=$(this);description=description.replace("+","%2B"),window.open("https://api.whatsapp.com/send?text="+encodeURIComponent(description+" "+el.attr("data-link")))},PMW.onShareToFacebook=function(description){let link=$(this).attr("data-link");PMW.fb.init().then(function(){FB.ui({method:"share",display:"popup",href:link,caption:"PosterMyWall | "+description},function(response){})}).catch(()=>alert(i18next.t("pmwjs_unable_to_contact_fb_wait_reload")))},PMW.onCopyLink=function(){var link=$(this).attr("data-link");PMW.copyTextToClipboard(link,null)},PMW.trackGA4TemplateShareEvent=function(gaOptions,shareType){var trackGAEvents=Boolean(gaOptions.shouldTrackEvents),TEMPLATE_SHARE_ANALYTICS_EVENT_NAME=gaOptions.shareAnalyticsEventName;trackGAEvents&&PMW.gtm.trackGA4CustomEvent(TEMPLATE_SHARE_ANALYTICS_EVENT_NAME,{[PMW.gtm.GA4_EVENT_PARAM_NAMES.TYPE]:shareType})},PMW.setupShareHandlers=function(gaOptions,shareButtonSelectors){const primarySelector=$(shareButtonSelectors.primarySelector).not("[data-share-click-initialized]"),secondarySelector=shareButtonSelectors.secondarySelector||"";0!==primarySelector.length&&(PMW.onClick(primarySelector,secondarySelector,function(){const shareButton=$(this);let shareDropdown=shareButton.siblings(".js-share-dropdown");0===shareDropdown.length&&(shareDropdown=function(shareButton){const templateShareDropdown=$(".js-template-share-dropdown"),newShareDropdown=templateShareDropdown.clone(),previewImageUrl=shareButton.attr("data-preview-image-url"),customizeLandingPageUrl=shareButton.attr("data-customize-landing-page-url");return newShareDropdown.removeClass("js-template-share-dropdown").find(".js-share-item").attr("data-link",customizeLandingPageUrl).attr("data-imagesrc",previewImageUrl).end().find(".js-copy-link").attr("data-link",customizeLandingPageUrl).end().insertAfter(shareButton),shareButton.removeAttr("data-view-page-link").removeAttr("data-preview-image-url").removeAttr("data-customize-landing-page-url"),newShareDropdown}(shareButton)),function(shareDropdown,gaOptions){if(shareDropdown.hasClass("js-attach-share-handlers")){shareDropdown.removeClass("js-attach-share-handlers");const DESCRIPTION_TAG=gaOptions.descTag;PMW.onClick(shareDropdown.find(".js-share-item.facebook"),null,function(){PMW.trackGA4TemplateShareEvent(gaOptions,"FacebookShare"),PMW.onShareToFacebook.call(this,DESCRIPTION_TAG)}),PMW.onClick(shareDropdown.find(".js-share-item.whatsapp"),null,function(){PMW.trackGA4TemplateShareEvent(gaOptions,"WhatsappShare"),PMW.onShareToWhatsapp.call(this,DESCRIPTION_TAG)}),PMW.onClick(shareDropdown.find(".js-share-item.pinterest"),null,function(){PMW.trackGA4TemplateShareEvent(gaOptions,"PinterestShare"),PMW.onShareToPinterest.call(this,DESCRIPTION_TAG)}),PMW.onClick(shareDropdown.find(".js-copy-link"),null,function(){PMW.onCopyLink.call(this),PMW.setLoading(i18next.t("pmwjs_copied_share_dropdown_link"),!0);const loadingToast=$("#loading");loadingToast.find("span").css("text-align","center"),setTimeout(()=>PMW.setLoading(null,!0),2e3)})}}(shareDropdown,gaOptions),PMW.initShareToSocialsCTA(shareDropdown,shareButton)}),primarySelector.attr("data-share-click-initialized","1"))},PMW.prepMarkupForShareDropdown=function(){if(!(0<$(".js-share-dropdown").length)){const shareDropdown=$(`<div class="js-share-dropdown share-dropdown -share-hide js-attach-share-handlers js-template-share-dropdown">
                           ${getSocialAnchorForShareDropdown("whatsapp","images/whatsapp-logo.svg","pmwjs_whatsapp")}
                           ${getSocialAnchorForShareDropdown("pinterest","images/pinterest-logo.svg","pmwjs_pinterest")}
                           ${getSocialAnchorForShareDropdown("facebook","images/facebook-logo.svg","pmwjs_facebook")}
                           ${`<div class="hr divider -share-dropdown-divider"></div>

        <div class="share-item js-copy-link" style="display: flex !important;">
            <i class="icon icon-link share-dropdown-copy pmw-icon color-heading size-icon-24"></i>
            <span class="title body-xs">${i18next.t("pmwjs_copy_link")}</span>
        </div>`}
                           </div>`);shareDropdown.appendTo("body")}}}();
PMW.initPage=function(c,m){Modernizr.touch||$("html").addClass("no-touchevents"),PMW.initI18next(PMW.LANGUAGE,PMW._initPage.bind(this,c,m))};var recommendedCategories=[],designerAddedCategories=[],tagAdded=0;PMW._initPage=function(c,m){$.ajaxSetup({cache:!1}),PMW.initTracking(),PMW.sendPosterMakerMessageIframe(),PMW.initFeedbackForm($(".feedback-form")),PMW.initConfirmLinks(),PMW.initShareDialogLinks(),PMW.initDownloadDialogLinks(),PMW.initSearchResults();const autoPlayVideos=$(".auto-play-video");autoPlayVideos.length?(PMW.initVideoItems(null,$(".grid-masonry")),PMW.loadVideoItem(autoPlayVideos.first())):PMW.initVideoItems(null),PMW.hideForStudent()&&PMW.changeSearchForStudent(),PMW.toggleForDesigner(),PMW.initEmbeddedModeUI();var categorySelector,id,orderHistory,status,downloadProgress,emailMessage,additionalInfo,g,userFeedback,grid,teamMemberConfirmation,btnJoinTeam,attemptCount,showLoading,statusContainer,statusMessage,flyParams=PMW.initFlyOutLimits(c,m);switch(PMW.premiumDialogs.openTrialDialog(!0),PMW.initAndLazyloadGraphics(),"notloggedin"!==PMW.getUserType()&&$("html").addClass("-loggedin"),c){case"sell":0<$(".js-youtube-video").length&&PMW.initYoutubeEmbeddedVideos(),"submit"===m?(g=$("#grid")).length?PMW.initGrid(g):(categorySelector=$("#categories"),$("#submit").find(".keywordInput"),PMW.initSubmitTemplate(),PMW.initSelectorForChoosingCategories($("#submit input[name=posterhashid]").val(),categorySelector)):"earnings"!==m||0<(id=$(".fill[data-percentage]")).length&&id.animate({width:id.attr("data-percentage")+"%"},500,"easeOutQuint");break;case"v":var inputDisplayCode=$("#input-display-code");inputDisplayCode.on("keyup blur",null,(function(e){13===e.which?window.open(PMW.util.site_url("v/d/"+inputDisplayCode.val()),"_self"):$.get(PMW.util.site_url("v/isPrintOrderDisplayCodeValid"),{displayCode:inputDisplayCode.val()},null,"json").done((function(data){"success"===data.status&&window.open(PMW.util.site_url("v/d/"+inputDisplayCode.val()),"_self")}).bind(this))}).bind(this));break;case"d":if($(".error-page").length)return;PMW.setUserPremiumLevel(),PMW.initDesignerProfilePage();var onSubmitComment_=function(){var comment=$("#comment").val();0<$.trim(comment).length&&(PMW.setLoading(i18next.t("pmwjs_commenting")),PMW.write(PMW.util.site_url("user/addprofilecomment"),{comment:comment,puid:this.getAttribute("data-id")},function(data,status){var newComment;PMW.setLoading(null),"error"===status?alert(i18next.t("pmwjs_error_processing_request")):($("#comment").val(""),newComment=$().add(data).hide(),$(".nocomments:visible").slideUp({duration:250,easing:"swing"}),$("#panel-comments .comments > ul").append(newComment),newComment.slideDown({duration:250,easing:"swing"}),updateCommentCount_(1))}))},onDeleteComment_=function(){var $this=$(this);$this.data("requestRunning")||($this.html(i18next.t("pmwjs_deleting_small_cap")),$this.data("requestRunning",!0),PMW.setLoading(i18next.t("pmwjs_deleting")),$.getJSON(PMW.util.site_url("user/deletecomment"),{commentId:$this.attr("data-comment-id")},function(data){PMW.setLoading(null),$this.data("requestRunning",!1),null===data?($this.html(i18next.t("pmwjs_delete_small_cap")),alert(i18next.t("pmwjs_error_processing_request"))):"true"===data.success?($this.parents("li").slideUp({duration:250,easing:"swing"},function(){$(this).remove()}),0===updateCommentCount_(-1)&&$(".nocomments").slideDown({duration:250,easing:"swing"})):void 0!==data.error&&($this.html(i18next.t("pmwjs_delete_small_cap")),alert(data.error))}))},updateCommentCount_=function(delta){var commentCountSpan=$("[data-comment-count]"),commentCount=parseInt(commentCountSpan.attr("data-comment-count"))+delta;return commentCountSpan.attr("data-comment-count",commentCount),0<commentCount?commentCountSpan.text("("+commentCount+")"):commentCountSpan.text(""),commentCount},loadDesignerTabContent_=function($tab){var data;PMW.setLoading(),$tab.attr("data-url")&&(data={},$tab.attr("data-id")&&(data={puid:$tab.attr("data-id"),theme:"-light -centered -full-width"}),PMW.load($($tab.attr("data-tab-content")),PMW.util.site_url($tab.attr("data-url")),data,function(){PMW.setLoading(null),$tab.attr("data-id")?($("#panel-comments .comments > ul").on("click",".delete-comment",onDeleteComment_),$("#submitComment").on("click",onSubmitComment_)):PMW.initializeTemplateGridWithPreviewShortcuts({gridSelector:$(this).find(".js-grid-masonry")})}))};function toggleTypeSelectorBtn(btn){btn.hasClass("selected")||btn.addClass("selected").siblings(".js-type-selector").removeClass("selected")}function toggleGridView(panel,grid){panel.removeClass("hide-grid").siblings().addClass("hide-grid"),grid.removeClass("hide-grid").siblings().addClass("hide-grid"),grid.prev(".breadcrumbs").removeClass("hide-grid")}$("#panel-summary").on("click","li",function(){var designer=$("#designer-profile"),d=designer.attr("data-seoname"),t=$(this),idCat=t.attr("data-idcat"),uri=t.attr("data-uri"),pc=$("#posters-in-category"),g=$(".grid-"+idCat),ci=$(".grid-info"),count=g.attr("data-total"),catName=t.attr("data-catname");$("#designer-nav").find("div").removeClass("-selected"),window.location.hash=window.location.hash+"/"+uri,0<g.length?toggleGridView(pc,g,designer.attr("data-displayname")):PMW.write(PMW.util.site_url("posters/loadDesignerPostersForCategory/"+d),{idCategory:idCat},function(d){pc.append(d),g=$(".js-grid-masonry.grid-"+idCat),count=g.attr("data-total"),toggleGridView(pc,g,designer.attr("data-displayname")),PMW.setLoading(null),PMW.initializeTemplateGridWithPreviewShortcuts({gridSelector:g})})}),PMW.onClick($(".js-show-designs"),null,function(){var btn=$(this),dropDown=$(".dropdown-for-designs");toggleTypeSelectorBtn(btn),dropDown.removeClass("_hidden"),window.location.hash=dropDown.find(".dropdown-selected").attr("data-href")}),PMW.onClick($(".js-show-comments"),null,function(){var btn=$(this);toggleTypeSelectorBtn(btn),""!=btn.attr("data-href")&&(window.location.hash=btn.attr("data-href")),$(".dropdown-for-designs").addClass("_hidden")});var pg=$(".page-grid");!function(pg){var label="",selectedTab=pg.attr("data-selected").split("/")[1],c=null;window.location.hash?(label=window.location.hash,$("#designer-nav-picker").val(label)):(label=selectedTab,$("#designer-nav-picker").val("#/"+label)),$("#designer-nav-picker").change(function(){window.location.href=this.value});var tabParts=label.split("/"),dropDown=$(".dropdown-for-designs");switch(tabParts[1]){case"popular":c=$(".load-popular"),dropDown.find(".load-popular").addClass("dropdown-selected");break;case"new":c=$(".load-new"),dropDown.find(".load-new").addClass("dropdown-selected");break;case"summary":var designer=$("#designer-profile");2<tabParts.length?PMW.write(PMW.util.site_url("posters/loadDesignerPostersForCategory/"+designer.attr("data-seoname")),{catHref:tabParts[2]},function(d){var pc=$("#posters-in-category");pc.append(d),g=pc.find(".js-grid-masonry"),toggleGridView(pc,g,$(".grid-info"),g.attr("data-total"),g.attr("data-catName"),designer.attr("data-displayname")),PMW.setLoading(null),PMW.initializeTemplateGridWithPreviewShortcuts({gridSelector:g})}):c=$(".load-summary"),dropDown.find(".load-summary").addClass("dropdown-selected");break;case"comments":c=$(".load-comments"),dropDown.addClass("_hidden"),$(".js-show-designs").removeClass("selected"),$(".js-show-comments").addClass("selected"),dropDown.find(".load-popular").addClass("dropdown-selected");break;default:var st="",st=selectedTab||"popular";(c=$(".load-"+st)).addClass("dropdown-selected")}c&&(PMW.loadTabContent(c,loadDesignerTabContent_,null),label=dropDown.find(".dropdown-selected").attr("data-label"),dropDown.find(".dropdown-label").attr("data-value",st).html(label))}(pg),PMW.util.require(void 0===PMW.setupPreviewDialog,"previewDialog",!0,function(){PMW.setupPreviewDialog(!0)}),PMW.initDropDown("dropdown-designer-profile"),PMW.onClick($("#posters-in-category"),".crumb-link",function(){window.location.hash=$(this).attr("data-href")}),window.onhashchange=function(){var tabParts="",selectedTab=pg.attr("data-selected").split("/")[1];window.location.hash?(tabParts=window.location.hash,$("#designer-nav-picker").val(tabParts)):(tabParts=selectedTab,$("#designer-nav-picker").val("#/"+tabParts));var hash,tabParts=tabParts.split("/");1<tabParts.length&&("summary"===(hash=tabParts[1])||"popular"===hash||"new"===hash||"comments"===hash)&&tabParts.length<=2&&PMW.loadTabContent($(".load-"+tabParts[1]),loadDesignerTabContent_,null)},$("#btn-show-email").on("click",function(){$(this).hide();var email=$("#txt-email");email.show().on("click","input",function(){this.select()}).find("input").val(email.attr("data-first").slice(0,-3)+"@"+email.attr("data-second")).on("blur",function(){$(this).val(email.attr("data-first").slice(0,-3)+"@"+email.attr("data-second"))}),email.css("display","inline-block")});break;case"premium":"subscriptions"===m||"cancelled"===m?PMW.premiumBillingPage.init.all():"invoice"===m?PMW.invoice(m):"confirmation"===m?PMW.initPremiumConfirmation():"activity"===m&&PMW.initMetaCurrencyActivityPage();break;case"info":"faq"===m&&(PMW.onClick($(".card"),null,function(){var t=$(this);t.find(".card-collapsed-content").toggle(150),t.toggleClass("-bold-title"),t.find(".card-toggle").toggleClass("icon-caret-down").toggleClass("icon-caret-up")}),PMW.onClick($(".card").find("a"),null,function(e){e.stopPropagation(),window.location=$(this).attr("href")}),(id=window.location.hash)&&0<(id=id.trim()).length&&(0<(orderHistory=$(id)).length&&(orderHistory.find(".card-collapsed-content").toggle(150),orderHistory.toggleClass("-bold-title"),orderHistory.find(".card-toggle").toggleClass("icon-caret-down").toggleClass("icon-caret-up"))));break;case"cart":function setHTMLWithFade(el,html){el.addClass("animated fadeOut").one(PMW.util.animationEndEvents,function(){el.html(html),el.removeClass("fadeOut").addClass("fadeIn").one(PMW.util.animationEndEvents,function(){el.removeClass("animated fadeIn")})})}function getEstimatedTime(idOrder){$.getJSON(PMW.util.site_url("cart/getEstimatedDownloadReadyTime"),{id:idOrder}).done((function(idOrder,r){if("success"===r.status&&r.data)if(void 0!==r.data.status){var estimatePrefixHTML='<i class="icon-clock-o left"></i>'+i18next.t("pmwjs_estimated_time");switch(r.data.status){case"waiting":setHTMLWithFade(downloadProgress.find(".estimate"),estimatePrefixHTML),setHTMLWithFade(downloadProgress.find(".estimate-time"),r.data.estTime),hasOrderStarted(idOrder);break;case"processing":setHTMLWithFade(downloadProgress.find(".estimate"),estimatePrefixHTML),onOrderStarted(idOrder);break;case"needs-attention":onNeedsAttention();break;case"available":onDownloadReady(r.data.pid);break;case"async-order":hideElement(downloadProgress);break;default:setHTMLWithFade(downloadProgress.find(".estimate"),estimatePrefixHTML),showFallbackState()}}else showGeneralError();else showGeneralError()}).bind(this,idOrder)).fail(showFallbackState)}function hasOrderStarted(idOrder){$.getJSON(PMW.util.site_url("cart/getRealTimeOrderStatus"),{id:idOrder,status:"waiting"}).done((function(idOrder,r){if("success"===r.status&&r.data)switch(r.data.status){case"waiting":setHTMLWithFade(downloadProgress.find(".estimate-time"),r.data.estTime),hasOrderStarted(idOrder);break;case"processing":onOrderStarted(idOrder);break;case"needs-attention":onNeedsAttention();break;case"available":onDownloadReady(r.data.pid);break;default:showFallbackState()}else showGeneralError()}).bind(this,idOrder)).fail(showFallbackState)}function onOrderStarted(idOrder){setHTMLWithFade(status,i18next.t("pmwjs_preparing_your_download_almost_done")),setHTMLWithFade(downloadProgress.find(".estimate-time"),i18next.t("pmwjs_less_than_minute")),isOrderReady(idOrder)}function isOrderReady(idOrder){$.getJSON(PMW.util.site_url("cart/getRealTimeOrderStatus"),{id:idOrder,status:"processing"}).done((function(idOrder,r){if("success"===r.status&&r.data)switch(r.data.status){case"available":onDownloadReady(r.data.pid);break;case"processing":setHTMLWithFade(additionalInfo,i18next.t("pmwjs_taking_longer_usual")),isOrderReady(idOrder);break;case"needs-attention":onNeedsAttention();break;default:showFallbackState()}else showFallbackState()}).bind(this,idOrder)).fail(showFallbackState)}function onNeedsAttention(){setHTMLWithFade(status,i18next.t("pmwjs_ran_into_error")),setHTMLWithFade(additionalInfo,i18next.t("pmwjs_issue_with_download_looking_into")),hideElement(downloadProgress),hideElement(emailMessage)}function onDownloadReady(idPosterRender){hideElement(downloadProgress),hideElement(emailMessage),setHTMLWithFade(status,i18next.t("pmwjs_download_ready")),setHTMLWithFade(additionalInfo,i18next.t("pmwjs_taking_you_download_page")),window.location.href=PMW.util.site_url("cart/download/"+idPosterRender)}function hideElement(el){el.addClass("animated fadeOut").one(PMW.util.animationEndEvents,function(){el.addClass("hidden").removeClass("animated fadeOut")})}function showFallbackState(){setHTMLWithFade($(".estimate-time"),'<span class="time-unavailable">Unavailable</span>')}function showGeneralError(){hideElement(downloadProgress),hideElement(emailMessage),setHTMLWithFade(status,i18next.t("pmwjs_download_not_found")),setHTMLWithFade(additionalInfo,i18next.t("pmwjs_download_not_found_desc"))}"orderhistory"===m?(orderHistory=$("#order-history"),PMW.initGrid(orderHistory),PMW.setupMultiPosterDialog()):"download"===m?0<$(".video-download").length?PMW.util.require(!0,"videoDownloadPage",!1,null):PMW.util.require(!0,"imageDownloadPage",!1,function(){PMW.selectDownload.init()}):"preparingDownload"===m||"downloadOrdered"===m||"lwacomplete"===m||"ppsuccessdg"===m?(status=$(".download-status"),downloadProgress=$(".download-progress"),emailMessage=$(".email-message"),additionalInfo=$(".additional-info"),downloadProgress.length&&"1"===downloadProgress.attr("data-real-time")&&getEstimatedTime(downloadProgress.attr("data-id")),$("#order-display-link").click(function(){this.select()}),PMW.initDownloadIssueForm()):"aspcomplete"===m?void 0!==PMW.ttt&&PMW.trackTransaction(PMW.ttt):"showdownloadissue"===m?PMW.initDownloadIssueForm():"order"===m&&PMW.invoice(m);break;case"edu":"newproject"===m||"donewproject"===m||"upgrade"===m?$(".hasfocus").focus():"classProject"===m?PMW.onClick($(".student-login"),null,function(){PMW.setLoading(i18next.t("pmwjs_logging_in")),PMW.write(PMW.util.site_url("authenticate/studentlogin"),{project:$(this).attr("data-project-name")},function(response){PMW.setLoading(null),"notfound"===response.data.status||"empty"===response.data.status?$("#login-error").show():window.location.href=PMW.util.site_url("posters/mine")})}):""!==m&&"index"!==m||$("#gotoAuth").click(function(e){e.preventDefault();var buttons={};return buttons[i18next.t("pmwjs_proceed_login_signup")]=function(){window.location.href=PMW.util.site_url("edu/upgrade")},PMW.openModalDialog("login-message-modal",i18next.t("pmwjs_login_to_proceed"),buttons,!0,"-modal-550",!0).find(".content").html(i18next.t("pmwjs_login_to_upgrade_classroom")),!1});break;case"g":var sc=$("#subcategory-container"),editDescContainer=$(".carousel-container");function showMarketingBanner(m){!function(m){return void 0!==PMW.marketing&&("small-business-flyers"===m||"restaurant-flyers"===m||"event-flyers"===m||"menu-templates"===m||"retail-sale-posters"===m||"bar-flyers"===m)}(m)||PMW.marketing.showMarketingBanner(new Date(Date.UTC(2021,10,17,17,30)))}function showRestaurantsHelpPopup(m){!function(m){return void 0!==PMW.marketing&&("restaurant-flyers"===m||"menu-templates"===m)&&$(".grid-masonry").attr("data-offset")>=PMW.marketing.POPUP_FIRST_LAZY_LOAD_TEMPLATE_COUNT}(m)||setTimeout(function(){PMW.marketing.showRestaurantsHelpPopup()},PMW.marketing.POPUP_ELAPSED_TIME_RESTAURANTS_HELP)}PMW.initSubcategoryCarousel(sc,editDescContainer,!0),function(m){PMW.util.isInGalleryDialog()?function(){window.addEventListener("scroll",PMW.debounce(PMW.util.initGalleryTopBarToggleMobile.bind(this,$(".page-grid").parent()),{passive:!0}))}():(PMW.marketing.canShowHalloweenMarketingBanner(m)?PMW.marketing.showHalloweenMarketingBanner():showMarketingBanner(m),showRestaurantsHelpPopup(m))}(m),initGalleryPage(c,m);break;case"s":PMW.isMobileOS()&&$(".all-sizes-list").hasClass("-expanded")&&$(".subcategories-carousel-box").addClass("hidden-desktop");sc=$("#subcategory-container"),editDescContainer=$(".carousel-container");PMW.initSubcategoryCarousel(sc,editDescContainer,!0),!PMW.util.isInGalleryDialog()&&PMW.marketing.canShowHalloweenMarketingBanner(m)&&PMW.marketing.showHalloweenMarketingBanner(),initGalleryPage(c,m);break;case"sizes":PMW.isMobileOS()&&$(".all-sizes-list").hasClass("-expanded")&&$(".subsizes-container").addClass("hidden-desktop");sc=$("#subsizes-carousel-container"),editDescContainer=$(".carousel-container");PMW.initSubcategoryCarousel(sc,editDescContainer,!0),initGalleryPage(c,m);break;case"products":"index"!==m&&""!==m||($("#framesel li").click(function(){let el=$(this);el.siblings().removeClass("selected"),el.addClass("selected"),$("#frameinfo>img").attr("src",$(this).attr("data-moreurl"))}),PMW.util.initSmoothScroll());break;case"authenticate":"studentlink"===m&&(""!==PMW.util.getQueryStringValue("project")?PMW.write(PMW.util.site_url("authenticate/studentlinklogin"),{project:window.location.href},function(response){"notfound"===response.data.status||"empty"===response.data.status?(PMW.showMessageDialog(i18next.t("pmwjs_general_login_error_header"),i18next.t("pmwjs_error_student_login_link")),$(".login-message").text(i18next.t("pmwjs_general_login_error_header")),$(".login-error-message").text(i18next.t("pmwjs_error_student_login_link"))):window.location.href=PMW.util.site_url("posters/mine")}):PMW.showMessageDialog(i18next.t("pmwjs_general_login_error_header"),i18next.t("pmwjs_error_student_login_link")));break;case"p":PMW.customizeForUser(),PMW.util.require(void 0===PMW.setupPreviewDialog,"previewDialog",!0,function(){PMW.setupPreviewDialog(!1)});break;case"poster":if("view"===m||"contribute"===m){for(var comments=$(".comments").find(".comment-date"),i=0;i<comments.length;i++){var comment=$(comments[i]),dateTimeObj=1e3*comment.attr("data-timestamp"),dateTimeObj=PMW.util.getLocalFormattedDateTime(dateTimeObj);comment.html(i18next.t("pmwjs_date_at_time",{date:dateTimeObj.date,time:dateTimeObj.time})).removeClass("_invisible")}PMW.isTeacher()&&$.getScript("https://apis.google.com/js/platform.js",function(){window.___gcfg={parsetags:"explicit"};var url=window.location.pathname.split("/"),url=url[$.inArray("poster",url)+2],url=PMW.util.site_url("poster/view/"+url);gapi.sharetoclassroom.render("google-class-btn-container",{url:url,size:"39"}),$("#google-class-btn-container").show()});editDescContainer=$("#postercredits");function onSaveName(){var toSave=$.trim($("#name-text-box").val());0===toSave.length?$(".name-container .field").addClass("danger"):PMW.write(PMW.util.site_url("poster/updatename"),{id:$("#postername").attr("data-poster-id"),name:toSave},function(r){"success"===r.status?($(".name-container").find("#editable-poster-name").text(toSave),showName()):void 0!==r.code&&"user_permission"===r.code?alert(i18next.t("pmwjs_no_permission_to_edit_design_meta_data")):alert(i18next.t("pmwjs_problem_saving_design_name"))})}function onCancelName(){$(".name-container .field").removeClass("danger"),showName()}function showName(){$("#edit-name-container").slideUp({duration:150,easing:"swing",complete:function(){$(".name-container").find("#editable-poster-name").show().end().find("h5").show().end().find("field").removeClass("danger")}})}function onSaveTags(){var toSave=$(".tag-input").val();""===toSave?($(".tagit.ui-widget").addClass("danger"),$(".tag-warning").show()):PMW.write(PMW.util.site_url("poster/updateKeywords"),{idposter:$("#postername").attr("data-poster-id"),keywords:toSave},function(r){if("success"===r.status){showTags();for(var keywords=toSave.split(","),html="",i=0,length=keywords.length;i<length;i++)html+='<li class="light label"> <a href="'+PMW.util.site_url("/posters/search?s=")+PMW.util.escapeHTML(keywords[i])+'" target="_blank"> '+PMW.util.escapeHTML(keywords[i])+"</a></li>";$(".tags .label").remove(),$(html).insertAfter(".tags li:first-child")}else void 0!==r.code&&"user_permission"===r.code?alert(i18next.t("pmwjs_no_permission_to_edit_design_meta_data")):void 0!==r.code&&"max_tags"===r.code?alert(i18next.t("pmwjs_no_permission_to_add_more_than_max_tags")):alert(i18next.t("pmwjs_problem_saving_tags"))})}function onCancelTags(){$(".tagit.ui-widget").removeClass("danger"),showTags()}function showTags(){$(".tagit").hide(),$(".tag-warning").hide(),$(".edit-tags-btns").hide(),$(".tags").show()}1===editDescContainer.length&&PMW.load(editDescContainer,PMW.util.site_url("poster/getcredits/"+editDescContainer.attr("data-idposter")),function(){$("#showcredits").click(function(){$("#credits").toggleClass("active")})}),$("#btn-manage-contributors").click(PMW.onManageContributors),$(".viewactivity").click(PMW.onViewPosterActivity),$(".toggleComments").click(function(){var s=$(this).attr("data-mode"),icon=$(".btn-icon i",this),btn=$(".btn-text",this);1==s?(icon.removeClass("icon-microphone").addClass("icon-clock-o"),btn.html(i18next.t("pmwjs_turning_on_email_notifications"))):0==s&&(icon.removeClass("icon-microphone-slash").addClass("icon-clock-o"),btn.html(i18next.t("pmwjs_turning_off_email_notifications"))),PMW.write(PMW.util.site_url("poster/updatePosterCommentsState"),{existingState:s,idposter:btn.parent().attr("data-hashedID")},function(data){1==s?(icon.removeClass("icon-clock-o").addClass("icon-microphone-slash"),btn.html(i18next.t("pmwjs_turn_off_email_notifications")),btn.parent().attr("data-mode",0)):0==s&&(icon.removeClass("icon-clock-o").addClass("icon-microphone"),btn.html(i18next.t("pmwjs_turn_on_email_notifications")),btn.parent().attr("data-mode",1))})}),PMW.initSelectorForChoosingCategories($("#save-categories").attr("data-idposter"),$("#selectCat")),$(".edit-categories").length&&($("#category-icon-list").on("click",".edit-categories > .btn",function(){$(".categories-select-container").show(),$(".category-icons").hide()}),$("#save-categories").on("click",function(){var idc=$("#selectCat").val(),idp=$("#save-categories").attr("data-idposter");null!=idc?($(".select2-selection").removeClass("danger"),$(".category-warning").hide(),PMW.write(PMW.util.site_url("poster/updatePosterCategories"),{idcategory:idc,idposter:idp},function(h){""!=h&&$("#category-icon-list").html(h)}),$(".categories-select-container").hide(),$(".category-icons").show()):($(".select2-selection").addClass("danger"),$(".category-warning").show())}),$("#cancel-categories").on("click",function(){$(".categories-select-container").hide(),$(".category-icons").show()})),$("#edit-name-container").length&&($("#editable-poster-name").on("click",function(){var editablePosterName=$("#editable-poster-name");editablePosterName.hide(),$("#edit-name-container").slideDown({duration:250,easing:"swing"}),$(".name-container").find("h5").hide(),$("#name-text-box").val(editablePosterName.text()).select().keyup(function(e){13===e.which?onSaveName():27===e.which?onCancelName():$(".name-container .field").removeClass("danger")})}),$("#save-name").on("click",onSaveName),$("#cancel-name").on("click",onCancelName)),$(".edit-tags").length&&($(".edit-tags > .btn").on("click",function(){$(".tags").hide();var tagit=$(".tagit");tagit.show(),$(".edit-tags-btns").show();var taginput=$(".tag-input");if(tagit.length){var keywords=[];$(".tags li.label").each(function(){keywords[keywords.length]=$(this).text()}),taginput.tagit("removeAll");for(var i=0;i<keywords.length;i++)taginput.tagit("createTag",keywords[i]);tagit.show()}else PMW.initKeywordTags(taginput),taginput.data("ui-tagit").tagInput.keyup(function(e){13===e.which?onSaveTags():27===e.which?onCancelTags():$(".tagit.ui-widget").removeClass("danger")});$(".tagit .tagit-new .ui-widget-content").focus()}),$("#save-tags").on("click",onSaveTags),$("#cancel-tags").on("click",onCancelTags));editDescContainer=$("#edit-desc-container");editDescContainer.length&&PMW.initEditableTextArea(editDescContainer.attr("data-id"),PMW.util.site_url("poster/updateDescription"))}break;case"posters":"index"===m||""===m?(g=$("#grid"),PMW.initGrid(g),PMW.initPopupMenus(g)):"recommendations"===m?(grid=$("#recommendations"),PMW.initializeTemplateGridWithPreviewShortcuts({gridSelector:grid.find(".js-grid-masonry")}),PMW.util.require(void 0===PMW.setupPreviewDialog,"previewDialog",!0,function(){PMW.setupPreviewDialog(!0)}),PMW.setUserPremiumLevel(),PMW.util.appendEmbeddedParamsToURLs(null),PMW.util.toggleGalleryPageComponentsForGallery(grid),userFeedback=grid.find(".feedback"),PMW.onClick(userFeedback,".options .btn",function(e){var feedbackValue=$(e.target).attr("data-value"),removeTagsContainer=$("#remove-tags");function hideFeedbackCard(){userFeedback.find(".feedback-note").removeClass("_hidden"),setTimeout(function(){userFeedback.fadeOut(350)},4e3)}PMW.gtm.trackGA4CustomEvent("RecommendationsHelpful",{param:feedbackValue}),userFeedback.find(".card-title").hide("slide",{direction:"up"},250),userFeedback.find(".options").hide("slide",{direction:"down"},250,function(){"yes"===feedbackValue||0===removeTagsContainer.length?hideFeedbackCard():"no"===feedbackValue&&(userFeedback.find(".card-title").text(i18next.t("pmwjs_remove_tags")).show(),userFeedback.find("#remove-tags").fadeIn(350),PMW.onClick(removeTagsContainer,".tag",function(){var deletedTag=$(this);deletedTag.attr("data-removed",1),deletedTag.fadeOut(250),PMW.write(PMW.util.site_url("user/saveRejectedUserTag"),{tag:deletedTag.attr("data-value")}),0===removeTagsContainer.find('.tag[data-removed="0"]').length&&(userFeedback.find(".card-title").fadeOut(250),removeTagsContainer.fadeOut(250,hideFeedbackCard))}))})})):"gallery"===m?PMW.initGalleryThemesPage():"mine"===m?PMW.util.require(!0,"myStuff",!1,function(){PMW.initMyStuff(),PMW.invalidateFavoritesCache()}):"by"===m&&(grid=$("#grid"),PMW.initGrid(grid),PMW.initPopupMenus(grid),PMW.onClick(grid,"a[data-href]",function(){}));break;case"user":if("feedbackform"===m)PMW.initFeedbackForm($(".feedback-page-form"));else if("feedbackHelpCenter"===m)$(document.body).addClass("help-center"),PMW.initFeedbackForm($(".feedback-page-form"));else if("editprofile"===m){PMW.fb.loginConnect($(".-facebook .link"),!0),PMW.onClick($(".js-link-google"),null,function(){$(this).addClass("_hidden"),$(".js-google-connect-container").removeClass("_hidden"),PMW.google.initLinking(null)}),PMW.google.initDisconnectHandler(),PMW.fb.initDisconnectHandler(),"receiveNotifications"==window.location.hash.substring(1)&&($("#receiveNotifications").addClass("info").addClass("alert"),setTimeout(function(){$("#receiveNotifications").removeClass("info").removeClass("alert")},5e3)),$("#btnUpload").click(function(){$("#uploadpicture").click()}),$("#uploadpicture").change(function(){PMW.getCsrfToken((function(csrfToken){$(this).parents("form").find(PMW.csrfSelector).val(csrfToken),$(this).parents("form").submit()}).bind(this))}),$("#btnManageCards").click(function(){PMW.checkout.showCheckoutDialog(PMW.checkout.MODE_MANAGE_CARDS)}),PMW.onClick($(".start-trial-btn"),null,function(){PMW.premiumDialogs.openTrialDialog(!1)});const container=$("#uprofile");0<container.length&&("1"===container.attr("data-is-logged-out")&&PMW.gtm.trackGA4CustomEvent("LogoutAllDevices"),container.removeAttr("data-is-logged-out"))}else"privacySettings"===m?PMW.onClick($("#privacy-settings").find(".btn-manage-consent"),null,PMW.userConsent.manageUserConsent):"accountactivity"===m&&PMW.initAccountActivity();break;case"refer":""===m&&("undefined"!=typeof addthis&&PMW.loadAddThisToolbox($(".sharing-opts")),$(".refer-link").click(function(){$(this).select()}));break;case"art":""!==m&&"index"!==m||($("#catPicker").change(function(){window.location.href=PMW.util.site_url("art/index/"+$(this).val())}),PMW.initGrid($("#grid")),PMW.util.require(void 0===PMW.setupPreviewDialog,"previewDialog",!0,function(){PMW.setupPreviewDialog(!1)}));break;case"teamspace":""!==m&&"index"!==m&&"p"!==m||PMW.util.initSmoothScroll();break;case"manageapp":try{$("#facebooklikeresults").tablesorter()}catch(e){}break;case"teams":function pollForAddMemberPayment(invoiceId){return PMW.pollingAjaxCallAsync(function(){return new Promise(resolve=>resolve({invoiceId:invoiceId}))},function(paymentData){return PMW.readLocal("premium/hasSuccessfulSubscriptionPaymentWebhookProcessed",paymentData)},12e4)}function onJoinTeam(){var idTeam=btnJoinTeam.attr("data-idteam"),invite=btnJoinTeam.attr("data-invite"),name=btnJoinTeam.attr("data-team-name");btnJoinTeam.addClass("disabled"),showLoading&&(PMW.setLoading(i18next.t("pmwjs_processing")),showLoading=!1),1===attemptCount&&(statusContainer.slideUp({duration:250,easing:"swing"}),statusMessage.removeClass("-error")),PMW.write(PMW.util.site_url("teams/addMember"),{idTeam:idTeam,invite:invite,name:name,attemptCount:attemptCount},function(r){"success"===r.status?(PMW.setLoading(i18next.t("pmwjs_finalizing_payment")),showLoading=!0,null!==r.data&&void 0!==r.data.invoiceId&&null!==r.data.invoiceId?pollForAddMemberPayment(r.data.invoiceId).then(function(){window.location=PMW.util.site_url("premium/subscriptions")}).catch(function(){window.location=PMW.util.site_url("premium/subscriptions")}):window.location=PMW.util.site_url("premium/subscriptions")):"error"===r.status?(btnJoinTeam.removeClass("disabled"),PMW.setLoading(null),showLoading=!0,teamMemberConfirmation.find(".confirm-message").addClass("-error").html(r.message),attemptCount=1):function(message){2===attemptCount&&(statusMessage.text(message),statusContainer.slideDown({duration:250,easing:"swing"}));3===attemptCount&&(PMW.setLoading(null),showLoading=!0,btnJoinTeam.removeClass("disabled"),statusContainer.slideUp({duration:250,easing:"swing",complete:function(){statusMessage.text(message).addClass("-error"),statusContainer.slideDown({duration:250,easing:"swing"})}}));++attemptCount<=3?onJoinTeam():attemptCount=1}(r.data.message)})}"confirmmembership"===m&&(teamMemberConfirmation=$("#team-member-confirmation"),btnJoinTeam=teamMemberConfirmation.find(".btn-join-team"),attemptCount=1,showLoading=!0,statusContainer=$("#status"),statusMessage=statusContainer.find(".message"),PMW.onClick(btnJoinTeam,null,onJoinTeam));break;case"designsystem":"premiumUpsellingDialogs"===m&&PMW.showPremiumOnlyFeatureDialog($("#dialog-container").attr("data-feature-name"))}function initGalleryPage(controller,method){PMW.initDropDown("dropdown-poster-type"),PMW.initDropDown("dropdown-poster-type-flyout"),PMW.initSearchResults();var yotpoContainer=$(".js-filter-dialog-extended");PMW.util.setGalleryDropdownToFullWidth(yotpoContainer),PMW.initTemplatesGalleryToggle(yotpoContainer,$(".js-filter-dialog-option")),PMW.util.toggleGalleryPageComponentsForGallery($("#bd"));var pageTopBar=PMW.initFlyOutLimits.bind(this,controller,method),g=$(".js-grid-masonry");PMW.hideForEDU(),function(controller){var gettyImageFormattedPrice=function(controller){let userEligibleCountryCode=PMW.getUserEligibleCountryCode(),pricesData={};"s"===controller?pricesData=JSON.parse($("#gscat").attr("data-getty-image-prices")):"sizes"===controller?pricesData=JSON.parse($("#size-cat").attr("data-getty-image-prices")):"g"===controller&&(pricesData=JSON.parse($("#gcat").attr("data-getty-image-prices")));var gettyImagePriceObj=pricesData[userEligibleCountryCode];return void 0===gettyImagePriceObj||0===Object.keys(gettyImagePriceObj).length?"":PMW.util.currencyFormat(gettyImagePriceObj.amount,gettyImagePriceObj.currencyCode)}(controller);if(0===PMW.getUserPremiumLevel()&&""!==gettyImageFormattedPrice){let nonPremiumGettyPriceLabel=$(".premium-box.-for-non-premium");nonPremiumGettyPriceLabel.attr("data-title",i18next.t("pmwjs_getty_image_costs_x_more_non_premium",{price:gettyImageFormattedPrice})),nonPremiumGettyPriceLabel.find(".premium").text("+"+gettyImageFormattedPrice).data("title")}}(controller),PMW.initializeTemplateGridWithPreviewShortcuts({gridSelector:g,lazyLoadingCallback:pageTopBar}),PMW.initPosterSizesList(),PMW.util.require(void 0===PMW.setupPreviewDialog,"previewDialog",!0,function(){PMW.setupPreviewDialog(!0)}),PMW.setUserPremiumLevel(),PMW.initTextScrollOnHover_(),yotpoContainer=$(".testimony-yotpo-container"),pageTopBar=$(".page-top-bar"),"notloggedin"!==PMW.getUserType()?(yotpoContainer.addClass("_hidden"),pageTopBar.removeClass("-notloggedin")):(yotpoContainer.removeClass("_hidden"),pageTopBar.addClass("-notloggedin")),$(window).scroll(PMW.debounce(PMW.doFlyOut.bind(this,flyParams),10)),PMW.util.appendEmbeddedParamsToURLs(null),PMW.util.require(void 0===PMW.initGalleryFiltersIntroPopup,"galleryFiltersIntroPopup",!0,function(){PMW.initGalleryFiltersIntroPopup()}),PMW.addGalleryTemplateWindowStatsToBeSynced(g)}PMW.showPendingMarketingPopup()},PMW.trackTransaction=function(t){for(var item in _gaq.push(["_addTrans",t.id,t.affiliation,t.total,t.tax,t.shipping,t.city,t.state,t.country]),t.items)_gaq.push(["_addItem",t.id,item.sku,item.name,"",item.price,item.quantity]);_gaq.push(["_trackTrans"])},PMW.initSelectorForChoosingCategories=function(hashIdPoster,selector){function removeCategoryFromList(categories,categoryRemoved){if(categories.includes(categoryRemoved)){var tempCategories=categories,arrayLength=tempCategories.length;categories=[];for(var i=0;i<arrayLength;i++)tempCategories[i]!==categoryRemoved&&categories.push(tempCategories[i])}return categories}void 0!==jQuery().select2&&(selector.select2({width:"100%",maximumSelectionLength:2,multiple:!0,placeholder:i18next.t("pmwjs_select_a_category")}),selector.on("select2:select",function(e){e.params.data.id,0<e.params.data.id&&PMW.write(PMW.util.site_url("sell/posterCategoryHasType"),{hashIdPoster:hashIdPoster,categoryId:e.params.data.id}).done(function(r){if("success"===r.status){var categoryTypeError=$(".category-type-error");if("add"===r.data)categoryTypeError.addClass("hidden"),(0===recommendedCategories.length||recommendedCategories.length&&!recommendedCategories.includes(e.params.data.id))&&designerAddedCategories.push(e.params.data.id);else{categoryTypeError.html(r.data.errorMessage).removeClass("hidden");for(var dataArray=[],i=0;i<selector.val().length;i++)selector.val()[i]!==r.data.categoryId&&dataArray.push(selector.val()[i]);selector.select2("val",dataArray)}}else selector.val(designerAddedCategories).trigger("change")})}),selector.on("select2:unselect",function(e){var categoryRemoved=e.params.data.id,designerCategoriesHaveRemovedCategory=designerAddedCategories.includes(categoryRemoved);designerCategoriesHaveRemovedCategory&&recommendedCategories.length&&recommendedCategories.includes(categoryRemoved)?(designerAddedCategories=removeCategoryFromList(designerAddedCategories,categoryRemoved),recommendedCategories=removeCategoryFromList(recommendedCategories,categoryRemoved)):designerCategoriesHaveRemovedCategory?designerAddedCategories=removeCategoryFromList(designerAddedCategories,categoryRemoved):recommendedCategories=removeCategoryFromList(recommendedCategories,categoryRemoved)}))},PMW.initSubmitTemplate=function(){const PMW_SUPPORT_CONTACT_URL="https://support.postermywall.com/hc/en-us/requests/new";function clear(){var p=$("#submit .panel:visible");$(p.get(0).lastChild).has(".messageBox")&&$(p.get(0).lastChild).remove()}function msg(m,t){var p=$("#submit .panel:visible");$(".alert.messageBox",p).remove(),p.append('<div class="'+t+' alert messageBox">'+m+"</div>"),stopTemplateSubmissionBtnLoading()}function sp(s,cb){$("#submit .panel:visible").hide("slide",{direction:"left",easing:"easeOutQuint"},250,function(){setTimeout(function(){$(s).show("slide",{direction:"left",easing:"easeOutQuint"},250,function(){$.isFunction(cb)&&cb()})},250)})}let submitTemplateBtn=$(".submit-design-template");function displayEmailUnverifiedBanner(doHide=!1){displayBanner(doHide,i18next.t("pmwjs_email_still_not_verified_title"),i18next.t("pmwjs_email_still_not_verified_body"))}function displayErrorSendingVerificationEmail(doHide=!1){displayBanner(doHide,i18next.t("pmwjs_error"),i18next.t("pmwjs_issue_sending_verification_email",{url:PMW_SUPPORT_CONTACT_URL}))}function displayBanner(doHide,title,subtitle){let emailErrorBanner=$(".js-error-banner");doHide?$(emailErrorBanner.parent()).removeClass("-show"):($(emailErrorBanner.find(".title")).text(title),$(emailErrorBanner.find(".subtitle")).html(subtitle),$(emailErrorBanner.parent()).addClass("-show"))}function isFinalSubmissionLoading(){return submitTemplateBtn.is(":visible")&&(submitTemplateBtn.hasClass("-loading")||void(submitTemplateBtn.is(":visible")&&submitTemplateBtn.addClass("-loading")))}function stopTemplateSubmissionBtnLoading(){submitTemplateBtn.is(":visible")&&submitTemplateBtn.removeClass("-loading")}function completeSubmission(){var submitPageSelector=$("#submit"),f=submitPageSelector.find("form"),btn=submitPageSelector.find(".btn.primary > input").attr("data-processing","yes"),selectedCategories=(recommendedCategories.length,submitPageSelector.find("#categories").val());btn.attr("data-oldval",btn.val()).val(i18next.t("pmwjs_please_wait")),$(document).ajaxError(function(e,x,s){s.url===f.attr("action")&&(stopTemplateSubmissionBtnLoading(),btn.attr("data-processing","no").val(btn.attr("data-oldval")),msg(i18next.t("pmwjs_error_processing_request_reload_try_again"),"warning"))}),PMW.write(f.attr("action"),f.serialize(),function(r){if(null==r||void 0===r.s){var m;stopTemplateSubmissionBtnLoading(),btn.attr("data-processing","no").val(btn.attr("data-oldval")),null!==r&&void 0===r.e||(m=i18next.t("pmwjs_error_processing_request_reload_try_again"),null!==r&&(m=r.m,0==r.p||1===$("#submit .step"+r.p+":visible").length?msg(m,"warning"):sp("#submit .step"+r.p,function(){msg(m,"warning")})))}else{sp("#submit .step4",function(){$(".js-submission-progress-bar").removeClass("-out"),PMW.loadAddThisToolbox($("#submit .step4 div[data-url]"))}),PMW.util.smoothScrollTo($("#nav"));for(var i=0;i<selectedCategories.length;i++)recommendedCategories.includes(selectedCategories[i])&&0;stopTemplateSubmissionBtnLoading()}},"json")}function validateStep2(data){for(var i=0;i<data.length;i++)switch(data[i].name){case"displayname":var disallowedWords=$("#displayname").attr("data-disallowedwords").split(",");if(0===$.trim(data[i].value).length)return i18next.t("pmwjs_enter_design_studio_or_name");for(var j=0;j<disallowedWords.length;j++)if(-1!==data[i].value.toLowerCase().indexOf(disallowedWords[j]))return i18next.t("pmwjs_name_disallowed_words");break;case"paypalemailaddress":if(0===$.trim(data[i].value).length)return i18next.t("pmwjs_need_paypal_email");if(!PMW.util.isValidEmail(data[i].value))return i18next.t("pmwjs_valid_email_address")}return!0}async function validatePaypalEmailLimitOnStep2Submit(templateSubmissionData){return PMW.readLocal("designers/hasPaypalEmailLimitExceeded",{paypalEmail:(paypalEmailAddressObject=$.grep(templateSubmissionData,function(userDataType){return"paypalemailaddress"===userDataType.name})[0])?paypalEmailAddressObject.value:""});var paypalEmailAddressObject}function validateStep3(data){for(var i=0;i<data.length;i++)switch(data[i].name){case"businessName":if(0===$.trim(data[i].value).length)return i18next.t("pmwjs_enter_legal_dba_name");break;case"address1":if(0===$.trim(data[i].value).length)return i18next.t("pmwjs_enter_address");break;case"city":if(0===$.trim(data[i].value).length)return i18next.t("pmwjs_enter_city");break;case"region":if(0===$.trim(data[i].value).length)return i18next.t("pmwjs_enter_state");break;case"postalcode":if(0===$.trim(data[i].value).length)return i18next.t("pmwjs_enter_zip_code");break;case"mailingPhone":if(0===$.trim(data[i].value).length)return i18next.t("pmwjs_enter_phone_number")}return!0}function onStep2Submit(data){clear();var r=validateStep2(data);!0===r?validatePaypalEmailLimitOnStep2Submit(data).then((function(response){!1===response.isPaypalLimitReached?sp("#submit .step3",function(){$("#submit .step3 .input:first").focus()}):msg(i18next.t("pmwjs_paypal_email_account_already_exists"),"danger")}).bind(this)).catch(onPaypalEmailLimitVerificationFailed):msg(r,"warning")}function onPaypalEmailLimitVerificationFailed(){msg(i18next.t("pmwjs_something_wrong_reload_page"),"danger")}$("#submit .step2 .input:first").keyup(function(){var str=0<$.trim(this.value.length)?i18next.t("pmwjs_designed_by_x",{name:this.value})+"<br/>":"";$("#submit .bgAttr > strong").html(str).show()}),$("#submit form").submit(function(e){e.preventDefault();var p=$(">.panel:visible",this),data=$(this).serializeArray();return isFinalSubmissionLoading()||(p.hasClass("step1")?function(data){clear();for(var btn=$('#submit .step1 input[type="submit"]'),isCategory=null!=$("#submit #categories").val(),termsAccepted=!1,legalContentTermsAccepted=!1,i=0;i<data.length;i++)switch(data[i].name){case"name":if(0===data[i].value.length)return msg(i18next.t("pmwjs_add_short_descriptive_name"),"warning");break;case"keywords":if(0===data[i].value.length)return msg(i18next.t("pmwjs_add_words_describe_template"),"warning");break;case"legal":termsAccepted="on"===data[i].value;break;case"legal-content":legalContentTermsAccepted="on"===data[i].value}isCategory?termsAccepted&&legalContentTermsAccepted?0<$("#submit .step2").length?!0===validateStep2(data)?!0===validateStep3(data)?completeSubmission():sp("#submit .step3",function(){btn.attr("value",i18next.t("pmwjs_submit_design_template")),$("#submit .step3 .input:first").focus()}):sp("#submit .step2",function(){btn.attr("value",i18next.t("pmwjs_next_mailing_address")),$("#submit .bgAttr").show("slide",{direction:"down",easing:"easeOutQuint"}),$("#submit .step2 .input:first").focus()}):completeSubmission():msg(i18next.t("pmwjs_accept_legal_terms"),"warning"):msg(i18next.t("pmwjs_select_at_least_one_category"),"warning")}(data):p.hasClass("step2")?onStep2Submit(data):p.hasClass("step3")&&function(data){clear();var r=validateStep3(data);!0===r?completeSubmission():msg(r,"warning")}(data)),!1});let resendEmailBtn=$(".js-resend-email-verification-btn"),afterEmailNextBtn=$(".js-next-step-btn");PMW.onClick(resendEmailBtn,null,(async function(){resendEmailBtn.addClass("-loading secondary"),resendEmailBtn.removeClass("primary"),await PMW.write(PMW.util.site_url("Sell/resendVerificationEmail")).done(function(r){return"success"===r.status?(function(){let resendEmailBtnIcon=$(resendEmailBtn.find("i")),resentEmailBtnText=$(resendEmailBtn.find(".btn-text")),resendEmailText=i18next.t("pmwjs_resend_email"),resendEmailTimerSeconds=60;afterEmailNextBtn.addClass("-disabled"),resendEmailBtn.addClass("-verified -icon-left"),resendEmailBtnIcon.addClass("icon-check-circle"),resentEmailBtnText.text(i18next.t("pmwjs_verification_email_sent")),setTimeout(function(){afterEmailNextBtn.removeClass("-disabled"),resendEmailBtn.removeClass("-email-sent -icon-left"),resendEmailBtnIcon.removeClass("icon-check-circle"),resendEmailBtn.addClass("-email-verification-timer -disabled"),resentEmailBtnText.text(resendEmailText+" ("+resendEmailTimerSeconds+"s)");let countdownInterval=setInterval(function(){resendEmailTimerSeconds--,resentEmailBtnText.text(resendEmailText+" ("+resendEmailTimerSeconds+"s)"),resendEmailTimerSeconds<=0&&(clearInterval(countdownInterval),resendEmailBtn.removeClass("-timer -disabled"),resentEmailBtnText.text(resendEmailText))},1e3)},4e3)}(),void displayErrorSendingVerificationEmail(!0)):(function(){let resentEmailBtnText=$(resendEmailBtn.find(".btn-text"));resentEmailBtnText.text(i18next.t("pmwjs_contact_support")),PMW.onClick(resendEmailBtn,null,function(){let win=window.open("mailto:support@postermywall.com","_blank");win.focus()})}(),void("limit_crossed"!==r.message?displayErrorSendingVerificationEmail():displayBanner(!1,i18next.t("pmwjs_send_limit_exceeded"),i18next.t("pmwjs_send_limit_exceeded_body",{url:PMW_SUPPORT_CONTACT_URL}))))}).fail(function(){displayErrorSendingVerificationEmail()}),resendEmailBtn.removeClass("-loading")}).bind(this)),PMW.onClick(afterEmailNextBtn,null,(async function(){afterEmailNextBtn.addClass("-loading"),await PMW.write(PMW.util.site_url("Sell/hasUserVerifiedEmailAddressForTemplateSubmission"),{posterHash:function(){let url=window.location.href,hashedId=url.split("/").pop();return hashedId}()}).done(function(r){if("success"!==r.status)displayEmailUnverifiedBanner();else{let submit=$("#submit");$(submit.find(".email-verification")).remove(),$(submit.find(".step1")).show()}}).fail(function(r){displayEmailUnverifiedBanner()}),afterEmailNextBtn.removeClass("-loading")}).bind(this)),PMW.initKeywordTags($(".keywordInput")),$("#submit .panel:first").show()},PMW.initShareDialogLinks=function(){var $b=$(document.body);PMW.onClick($b,"a.opensharedialog",function(){PMW.openCollaboratorsDialog(this.getAttribute("pid"))}),PMW.onClick($b,"a.opens-public-sharing",function(){var title=i18next.t("pmwjs_share_design");PMW.openModalDialog("public-share-modal",title,null,!0,"-modal-400",!0),PMW.loadAddThisToolbox($("#public-share-modal .content").attr({"data-url":this.getAttribute("data-url"),"data-title":title,"data-count":0,"data-compact":0,"data-track":1,"data-style":"-centered"}))})},PMW.initDownloadDialogLinks=function(){var $b=$(document.body);PMW.onClick($b,".open-download-dialog",function(){var data={idPosterHash:this.getAttribute("data-pid"),isPosterMaker:0,panelToSelect:"download"};PMW.openDownloadDialog(data)}),PMW.onClick($b,".open-publish-dialog",function(){var data={idPosterHash:this.getAttribute("data-pid"),isPosterMaker:0,panelToSelect:"publish"};PMW.openDownloadDialog(data)})},PMW.showMessageDialog=function(title,message,icon){void 0===icon&&(icon=!0);var messageModal={};messageModal[i18next.t("pmwjs_ok")]=function(){PMW.closeModalDialog("message-modal")};messageModal=PMW.openModalDialog("message-modal",title,messageModal,!0);messageModal.find(".content").html('<div class="icon-wrapper"><i class="icon-info"></i></div><p class="message">'+message+"</p>"),messageModal.find(".icon-wrapper").toggle(icon)},PMW.onManageContributors=function(){var modalButton=$(this),hashedId=modalButton.attr("data-id"),type=modalButton.attr("data-type"),t="poster"==type?i18next.t("pmwjs_contributors_to_design"):i18next.t("pmwjs_contributors_to_folder"),modalButton={};"folder"==type&&(modalButton[i18next.t("pmwjs_save_changes_all_caps")]=function(){PMW.setLoading(i18next.t("pmwjs_saving"));for(var a=modal.find(".content .permissions"),data=[],i=0;i<a.length;i++)data.push({idFolder:$(a[i]).attr("data-id"),idUser:$(a[i]).attr("data-iduser"),canEdit:$(a[i]).find(".can-edit").is(":checked"),canAdd:$(a[i]).find(".can-add").is(":checked"),canCopy:$(a[i]).find(".can-copy").is(":checked"),canInvite:$(a[i]).find(".can-invite").is(":checked")});PMW.write(PMW.util.site_url("folder/updateContributorPermission"),{data:JSON.stringify(data)},function(r){"error"===r.status&&PMW.showMessageDialog(i18next.t("pmwjs_something_went_wrong"),i18next.t("pmwjs_save_settings_error")),PMW.setLoading(null),PMW.closeModalDialog("manage-contributors-modal")})});var modal=PMW.openModalDialog("manage-contributors-modal",t,modalButton,!0,"-modal-570 -modal-h-570",!1);PMW.load(modal.find(".content"),PMW.util.site_url("user/manageContributorsDialog/"+hashedId+"/"+type),null,function(){var content=$(this);PMW.onClick(modal,".btn-delete",function(e){e.stopPropagation(),$(this).closest(".delete-options").addClass("-confirm-state").siblings(".address-detail").addClass("-delete-mode")}),PMW.onClick(modal,".btn-cancel-delete",function(e){e.stopPropagation(),$(this).closest(".delete-options").removeClass("-confirm-state").siblings(".address-detail").removeClass("-delete-mode")}),PMW.onClick(modal,".btn-confirm-delete",function(){var confirmDelete=$(this).closest(".confirm-delete");PMW.setLoading(i18next.t("pmwjs_deleting")),PMW.write(PMW.util.site_url("user/removecontributor"),{id:confirmDelete.attr("data-id"),idUser:confirmDelete.attr("data-iduser"),type:confirmDelete.attr("data-type")},function(r){var li;PMW.setLoading(null),"success"===r.status?(li=confirmDelete.parents("li").addClass("-removed"),setTimeout(function(){li.remove(),0===content.find("li").length&&content.html('<h4 class="please-wait">'+i18next.t("pmwjs_all_contributors_removed")+"</h4>")},400)):"fail"===r.status?alert(r.data.message):alert(i18next.t("pmwjs_error_processing_request_try_again"))}).fail(function(){alert(i18next.t("pmwjs_error_processing_request_try_again"))})})})},PMW.onViewPosterActivity=function(){var hashedId=$(this).attr("data-idposter"),target=PMW.openModalDialog("activity-log-modal",i18next.t("pmwjs_activity_log"),{},!0,"-modal-550 -modal-h-570",!1).find(".content");PMW.load(target,PMW.util.site_url("poster/activitylogdialog/"+hashedId),function(){for(var activityList=$(".userlist").find(".activity-date"),i=0;i<activityList.length;i++){var activity=$(activityList[i]),dateTimeObj=1e3*activity.attr("data-timestamp"),dateTimeObj=PMW.util.getLocalFormattedDateTime(dateTimeObj);activity.html(i18next.t("pmwjs_date_at_time",{date:dateTimeObj.date,time:dateTimeObj.time})).removeClass("_invisible")}})},PMW.initConfirmLinks=function(){$(document).on("click","[data-confirm]",function(){var url=this.getAttribute("data-actionurl"),msg=this.getAttribute("data-confirm");url&&msg&&confirm(msg)&&(window.location.href=url)})},PMW.customizeForUser=function(){"notloggedin"!==PMW.getUserType()&&($("html").addClass("-loggedin"),$("#btn-my-stuff").removeClass("_hidden"))},PMW.setupMultiPosterDialog=function(){PMW.onClick($(document.body),"a.multiposter",function(){return PMW.load(PMW.openModalDialog("multi-poster-modal",i18next.t("pmwjs_designs_in_this_item"),{},!0,"-modal-500",!0).find(".content"),PMW.util.site_url("posters/multiposterdialog/"+$(this).attr("data-shoppingcartitemid")),{}),!1})},PMW.setupMultiPosterSelectionDialog=function(){$(document.body).on("click","a.posterselection",function(){var link=$(this);PMW.load(PMW.openModalDialog("multi-poster-selection-modal",i18next.t("pmwjs_select_a_design"),{},!0,"-modal-550 -modal-h-570",!1).find(".content"),PMW.util.site_url("posters/getuserpostersforselection"),{width:link.attr("data-width"),height:link.attr("data-height"),itemId:link.attr("data-itemid"),order:link.attr("data-order"),o:link.attr("data-orientation"),mode:link.attr("data-mode"),offset:0,limit:16,view:"ompsd"},function(){var spdlg=$("#spdlg");PMW.initGrid($("#previewcontent").find(".grid"),$("#spdlgm"),spdlg.parent(),{width:link.attr("data-width"),height:link.attr("data-height"),itemId:link.attr("data-itemid"),order:link.attr("data-order"),o:link.attr("data-orientation"),mode:link.attr("data-mode"),view:"cmpsd"}),spdlg.on("click",".selectposter",function(){var $this=$(this);PMW.load($("#cart").find('.itemposter a[data-itemid="'+$this.attr("data-itemid")+'"][data-order="'+$this.attr("data-order")+'"]').parent(),PMW.util.site_url("cart/setposteronshoppingcartitem/"+$this.attr("data-itemid")+"/"+$this.attr("data-posterid")+"/"+$this.attr("data-order")+"/"+$this.attr("data-mode")),null,function(data,status){"error"===status?alert(i18next.t("pmwjs_error_processing_request")):($(this).parents("tr").removeClass("highlight"),PMW.closeModalDialog("multi-poster-selection-modal"))})})})})},PMW.getGlobalDialogHolder=function(){var d=$("#gdh");return 0===d.length&&((d=document.createElement("div")).setAttribute("id","gdh"),document.body.appendChild(d),d=$(d)),d},PMW.cleanGlobalDialogHolder=function(addWaitMessage,customMessage){var m,d=PMW.getGlobalDialogHolder().empty();return addWaitMessage&&(m=document.createElement("h4"),m=$(m),void 0===customMessage&&(customMessage=i18next.t("pmwjs_please_wait")),m.html(customMessage),m.addClass("wait"),d.append(m)),d},PMW.initTabs=function(tabRoot,tabContentLoader,onTabClickHandler){PMW.onClick(tabRoot,".tab",function(){PMW.loadTabContent($(this),tabContentLoader,onTabClickHandler)})},PMW.loadTabContent=function($tab,tabContentLoader,onTabClickHandler){$($tab.attr("data-tab-content")).removeClass("hide-grid").siblings().addClass("hide-grid"),$tab.addClass("-selected").siblings().removeClass("-selected"),1==$tab.attr("data-loaded")&&$.isFunction(onTabClickHandler)&&onTabClickHandler($tab),null!=$tab.attr("data-loaded")&&0==$tab.attr("data-loaded")&&$.isFunction(tabContentLoader)&&(tabContentLoader($tab),$tab.attr("data-loaded",1))},PMW.asyncSetupCheckoutAnalytics=function(){var formid="gcaform_"+(new Date).getTime(),data='<form id="'+formid+'"> <input type="hidden" name="analyticsdata" value="" /> </form>';$("body").append(data),PMW.setupCheckoutAnalytics();data=$("#"+formid+' input[name="analyticsdata"]').val();return $("#"+formid).remove(),data},PMW.setupCheckoutAnalytics=function(){"undefined"!=typeof _gaq&&_gaq.push(function(){var pageTracker=_gaq._getAsyncTracker();setUrchinInputCode(pageTracker)})},PMW.initKeywordTags=function(inpt){var keywordCache={},tagLimit=5;$("#submit").find("#categories");$(".edit-tags").hasClass("is-super")&&(tagLimit=10),inpt.tagit({allowSpaces:!0,autocomplete:{delay:200,minLength:2,source:function(request,response){var term=request.term.split(/,\s*/).pop();term in keywordCache?response(keywordCache[term]):$.getJSON(PMW.util.site_url("poster/getKeywordsForAutocomplete"),{term:term},function(data){keywordCache[term]=data,response(data)})}},beforeTagAdded:function(e,tag){var keywords=tag.tagLabel.split(/,\s*/);if(1<keywords.length){for(var i=0;i<keywords.length;i++)$(this).tagit("createTag",keywords[i]);return!1}},afterTagAdded:function(){tagAdded=1},tagLimit:tagLimit})},PMW.addCategories=function(categorySelector,keywordsArray){var hashIdPoster=$("#submit input[name=posterhashid]").val(),consolidatedCategories=[],lengthDesignerAddedCategories=designerAddedCategories.length;if(2===lengthDesignerAddedCategories)return categorySelector.val(designerAddedCategories).trigger("change"),$("#categories").prop("disabled",!1),void(tagAdded=0);PMW.setLoading(),PMW.write(PMW.util.site_url("sell/addRecommendedCategory"),{hashIdPoster:hashIdPoster,keywords:keywordsArray}).done(function(r){PMW.setLoading(null),"success"===r.status?(recommendedCategories=r.data.categoryIds,1===lengthDesignerAddedCategories?(consolidatedCategories.push(designerAddedCategories[0]),recommendedCategories&&consolidatedCategories.push(recommendedCategories[0]),categorySelector.val(consolidatedCategories).trigger("change")):categorySelector.val(recommendedCategories).trigger("change")):categorySelector.val(designerAddedCategories).trigger("change")}).always(function(){$("#categories").prop("disabled",!1),tagAdded=0})},PMW.invoice=function(m){var controller,type,order=$("#order"),orderId=order.attr("data-id");"invoice"===m?(controller="premium",type=order.attr("data-invoice-type")):controller="cart",PMW.initEditableTextArea(orderId,PMW.util.site_url(controller+"/addCommentsToPurchase"),{type:type},function(){order.find(".notes-section").removeClass("-no-notes")})};
PMW.mergePMW(PMW.util,{getFormattedDate:function(dateFormat,milliseconds,opts={}){void 0===milliseconds&&(milliseconds=(new Date).getTime()),void 0===opts.isUTC&&(opts.isUTC=!0),"string"==typeof milliseconds&&(milliseconds=parseInt(milliseconds));var formattedDate="",dateObj=new Date(milliseconds),self=PMW.util,formats={d:function(){var day=formats.j();return day<10?"0"+day:day},D:function(){return self.CALENDER_DATA.weekdays.shorthand[formats.w()]},j:function(){return opts.isUTC?dateObj.getUTCDate():dateObj.getDate()},l:function(){return self.CALENDER_DATA.weekdays.longhand[formats.w()]},w:function(){return opts.isUTC?dateObj.getUTCDay():dateObj.getDay()},F:function(){return self.monthToStr(formats.n()-1,!1)},m:function(){var month=formats.n();return month<10?"0"+month:month},M:function(){return self.monthToStr(formats.n()-1,!0)},n:function(){return(opts.isUTC?dateObj.getUTCMonth():dateObj.getMonth())+1},U:function(){return dateObj.getTime()/1e3},y:function(){return String(formats.Y()).substring(2)},Y:function(){return opts.isUTC?dateObj.getUTCFullYear():dateObj.getFullYear()},h:function(){var hours=dateObj.getHours();return 12<(hours=0===hours?12:hours)&&(hours-=12),hours},i:function(){var minutes=dateObj.getMinutes().toString();return 1===minutes.length?"0"+minutes:minutes},A:function(){return 12<=dateObj.getHours()?"PM":"AM"}},formatPieces=dateFormat.split("");return self.forEach(formatPieces,function(formatPiece,index){formats[formatPiece]&&"\\"!==formatPieces[index-1]?formattedDate+=formats[formatPiece]():"\\"!==formatPiece&&(formattedDate+=formatPiece)}),formattedDate},forEach:function(items,callBack){[].forEach.call(items,callBack)},monthToStr:function(date,shorthand){return(!0===shorthand?PMW.util.CALENDER_DATA.months.shorthand:PMW.util.CALENDER_DATA.months.longhand)[date]},isSameYear:function(milliseconds){return new Date(milliseconds).getFullYear()===(new Date).getFullYear()},getLocalFormattedDateTime:function(milliseconds){var time=PMW.util.getFormattedDate("h:i A",milliseconds);return{date:PMW.util.isSameYear(milliseconds)?PMW.util.getFormattedDate("F j",milliseconds):PMW.util.getFormattedDate("F j, Y",milliseconds),time:time}},initCalendari18n:function(){this.initCalendar||(this.CALENDER_DATA.weekdays={shorthand:[i18next.t("pmwjs_calendar_sun"),i18next.t("pmwjs_calendar_mon"),i18next.t("pmwjs_calendar_tue"),i18next.t("pmwjs_calendar_wed"),i18next.t("pmwjs_calendar_thu"),i18next.t("pmwjs_calendar_fri"),i18next.t("pmwjs_calendar_sat")],longhand:[i18next.t("pmwjs_calendar_sunday"),i18next.t("pmwjs_calendar_monday"),i18next.t("pmwjs_calendar_tuesday"),i18next.t("pmwjs_calendar_wednesday"),i18next.t("pmwjs_calendar_thursday"),i18next.t("pmwjs_calendar_friday"),i18next.t("pmwjs_calendar_saturday")]},this.CALENDER_DATA.months={shorthand:[i18next.t("pmwjs_calendar_jan"),i18next.t("pmwjs_calendar_feb"),i18next.t("pmwjs_calendar_mar"),i18next.t("pmwjs_calendar_apr"),i18next.t("pmwjs_calendar_may"),i18next.t("pmwjs_calendar_jun"),i18next.t("pmwjs_calendar_jul"),i18next.t("pmwjs_calendar_aug"),i18next.t("pmwjs_calendar_sep"),i18next.t("pmwjs_calendar_oct"),i18next.t("pmwjs_calendar_nov"),i18next.t("pmwjs_calendar_dec")],longhand:[i18next.t("pmwjs_calendar_january"),i18next.t("pmwjs_calendar_february"),i18next.t("pmwjs_calendar_march"),i18next.t("pmwjs_calendar_april"),i18next.t("pmwjs_calendar_may"),i18next.t("pmwjs_calendar_june"),i18next.t("pmwjs_calendar_july"),i18next.t("pmwjs_calendar_august"),i18next.t("pmwjs_calendar_september"),i18next.t("pmwjs_calendar_october"),i18next.t("pmwjs_calendar_november"),i18next.t("pmwjs_calendar_december")]},this.initCalendar=!0)},initCalendar:!1,CALENDER_DATA:{weekdays:{shorthand:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],longhand:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"]},months:{shorthand:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],longhand:["January","February","March","April","May","June","July","August","September","October","November","December"]},daysInMonth:[31,28,31,30,31,30,31,31,30,31,30,31],firstDayOfWeek:0}});
const ONE_HOUR_IN_MILLISECONDS=36e5;PMW.mergePMW(PMW,{marketing:{MARKETING_POPUP_BLOCKED_COOKIE:"pmwmpb",MARKETING_POPUP_TIMEOUT_CHECK_INDEX:"marketing_popup_timeout",POPUP_ID_HALLOWEEN_CALENDAR:"popup-halloween-calendar",POPUP_ID_CHRISTMAS_CALENDAR:"popup-christmas-calendar",POPUP_ID_CHURCH_WEBINAR:"popup-church-webinar",POPUP_ID_PENDING_PERSONA:"popup-pending-persona",POPUP_ID_DESIGN_REQUEST:"popup-design-request",POPUP_ID_RESTAURANTS_HELP:"popup-restaurants-help",BANNER_ID_EDUCATION_CLASS:"education-live-class",BANNER_ID_RESTAURANT_MARKETING:"restaurant-marketing-banner",BANNER_ID_POSTERBOOKING_CLASS:"posterbooking-class-banner",POPUP_TEMPLATE_COUNT_OFFSET_DESIGN_REQUEST:180,POPUP_FIRST_LAZY_LOAD_TEMPLATE_COUNT:50,POPUP_ELAPSED_TIME_SEARCH_DESIGN_REQUEST:65e3,POPUP_ELAPSED_TIME_GALLERY_DESIGN_REQUEST:6e4,POPUP_ELAPSED_TIME_SUBCATEGORY_DESIGN_REQUEST:66e3,POPUP_ELAPSED_TIME_SIZES_DESIGN_REQUEST:49e3,POPUP_ELAPSED_TIME_RESTAURANTS_HELP:15e3,POPUP_EXPIRY_TYPE_DEFAULT:"default",POPUP_EXPIRY_TYPE_CLOSE:"close",POPUP_EXPIRY_TYPE_VISIT:"visit",INTERACTION_TYPE_POSITIVE:1,INTERACTION_TYPE_NEGATIVE:0,isPopupBeingShown:!1,getDesignRequestPopUpElapsedTime:function(){let path=this.getCurrentPagePath().split("/"),elapsedTime;return 2<=path.length&&("sizes"===path[1]?elapsedTime=this.POPUP_ELAPSED_TIME_SIZES_DESIGN_REQUEST:"g"===path[1]?elapsedTime=this.POPUP_ELAPSED_TIME_GALLERY_DESIGN_REQUEST:"s"===path[1]?elapsedTime=this.POPUP_ELAPSED_TIME_SUBCATEGORY_DESIGN_REQUEST:3<=path.length&&"search"===path[2]&&(elapsedTime=this.POPUP_ELAPSED_TIME_SEARCH_DESIGN_REQUEST)),elapsedTime},showDesignRequestPopup:function(){var popUpId=this.POPUP_ID_DESIGN_REQUEST;return!!this.canPopupBeShown(popUpId)&&(this.showPopup("marketing/parts/getDesignRequestPopupHTML",popUpId),!0)},canShowHalloweenMarketingBanner:function(m){return PMW.isPAYGUser()&&this.isHalloweenSeason()&&["halloween-flyers","halloween-party-invitations","trunk-or-treat-flyer","costume-contest-flyer","halloween-kids-party-flyer","pumpkin-carving-party-invitation","halloween-sale-flyer","halloween-karaoke-flyer","halloween-potluck-flyer","halloween-bingo-poster","halloween-menu-template","halloween-bake-sale-flyer"].includes(m)&&"1"===PMW.util.readCookie("pmwhdcd")},isHalloweenSeason:function(){return 9===(new Date).getMonth()},isHalloweenBannerBeingShown:function(){return 0<$("#halloween-banner").length},initCloseButtonForHalloweenBanner:function(){PMW.onClick($(".js-icon-close-halloween-banner"),null,()=>{$("#halloween-banner").remove(),PMW.write(PMW.util.site_url("marketing/parts/markHalloweenDiscountCodeBannerClosed"))})},initCopyForSeasonalUpsellDialogDiscountCode:function(){initResponsiveToolTips("click","js-copy-seasonal-upselling-discount-code"),PMW.onClick($(".js-copy-seasonal-upselling-discount-code"),null,()=>{navigator.clipboard.writeText($(".js-seasonal-upselling-discount-code").text().trim())})},showHalloweenMarketingBanner:function(){$.get(PMW.util.site_url("marketing/parts/halloweenDiscountCodeBanner"),{}).done(r=>{"success"===r.status&&($(r.data.html).insertBefore("#nav"),this.initCopyForSeasonalUpsellDialogDiscountCode(),this.initCloseButtonForHalloweenBanner())})},showPostDownloadHalloweenUpsellDialog:function(){PMW.openDialogV2("premium-post-free-download-dialog","-standard",PMW.util.site_url("premium/halloweenDesignDownloadUpsellingDialog"),{},null,!0,"",!0)},showPostDownloadChristmasUpsellDialog:function(){PMW.openDialogV2("premium-post-free-download-dialog","-standard",PMW.util.site_url("premium/christmasDesignDownloadUpsellingDialog"),{},PMW.marketing.initCopyForSeasonalUpsellDialogDiscountCode,!0,"",!0)},showHalloweenDiscountCodeDialog:function(){PMW.openDialogV2("premium-post-free-download-dialog","-standard",PMW.util.site_url("marketing/parts/halloweenDiscountCodeDialog"),{},PMW.marketing.initCopyForSeasonalUpsellDialogDiscountCode,!0,"",!0)},showMarketingBanner:function(dateToCompare){if(dateToCompare>new Date){let ptb=$(".page-top-bar");0<ptb.length&&(ptb.addClass("-no-border"),ptb.after('<a href="https://bit.ly/3koGcqg" target="_blank" class="base-banner">Want to elevate your brand\'s engagement? Learn how to create head-turning dynamic digital content in our FREE Facebook Live class <span class="link">Sign up now.</span></a>'))}},showPendingMarketingPopups:function(){this.canMarketingPopupBeShown()&&(this.recordGetPendingMarketingPopupAttempt(),this.showPopup("marketing/popups/getPendingPopup"))},showPendingPersonaPopup:function(){var popUpId=this.POPUP_ID_PENDING_PERSONA;this.canPopupBeShown(popUpId)&&(this.showPopup("user/getPersonaPopupHTML",popUpId),this.initPendingPersonaPopup())},showRestaurantsHelpPopup:function(){var popUpId=this.POPUP_ID_RESTAURANTS_HELP;this.canPopupBeShown(popUpId)&&this.showPopup("marketing/parts/getRestaurantsHelpPopupHTML",popUpId)},canPopupBeShown:function(popUpId){return PMW.isUserLoggedIn()&&!this.isPopupBeingShown&&!this.hasUserRecentlySeenPopup(popUpId)},canMarketingPopupBeShown:function(popUpId){return this.canPopupBeShown(popUpId)&&this.hasHourPassedSinceLastGetPendingPopupAttempt()},getCurrentPagePath:function(){return PMW.util.getCurrentPagePath()},getCookieExpiryDataAttributeName:function(expiryType){return"data-"+expiryType+"-expiry-s"},getCookieExpiryInDays:function(expiryInSeconds){return expiryInSeconds/60/60/24},hasUserRecentlySeenPopup:function(popUpId){return"undefined"===popUpId&&PMW.util.readCookie(this.MARKETING_POPUP_BLOCKED_COOKIE)||"undefined"!==popUpId&&PMW.util.readCookie(popUpId)},hasHourPassedSinceLastGetPendingPopupAttempt:function(){return null===PMW.getCacheItem(this.MARKETING_POPUP_TIMEOUT_CHECK_INDEX)},recordGetPendingMarketingPopupAttempt:function(){var currentTimestamp=(new Date).getTime();PMW.setCacheItem(this.MARKETING_POPUP_TIMEOUT_CHECK_INDEX,currentTimestamp,ONE_HOUR_IN_MILLISECONDS)},hidePopup:function(popup){popup.removeClass("-open")},initPendingPersonaPopup:function(){let popup=$("#"+this.POPUP_ID_PENDING_PERSONA);PMW.onClick(popup.find(".-persona-cta"),null,function(){PMW.premiumDialogs.onSkipPersonPendingPopup(),PMW.premiumDialogs.openPersonaDialogOnly(),popup.removeClass("-open")}),PMW.onClick(popup.find(".-popup-close"),null,function(){PMW.premiumDialogs.onSkipPersonPendingPopup()})},initPopup:function(popUpId){let popup=$("#"+popUpId);setTimeout(function(){popup.addClass("-open")},1e3),this.setExpiryCookie(popUpId,this.POPUP_EXPIRY_TYPE_DEFAULT),this.setBlockMarketingPopupsCookie(popUpId),PMW.onClick(popup.find(".-popup-close"),null,PMW.marketing.onClosePopup.bind(this,popup)),PMW.onClick(popup.find(".-popup-cta"),null,PMW.marketing.onClickPopupCTA.bind(this,popup))},onClosePopup:function(popup){PMW.marketing.hidePopup(popup),popup.attr("data-id-popup")&&this.recordInteraction(popup.attr("data-id-popup"),PMW.marketing.INTERACTION_TYPE_NEGATIVE),PMW.marketing.setExpiryCookie(popup.attr("id"),PMW.marketing.POPUP_EXPIRY_TYPE_CLOSE),PMW.marketing.isPopupBeingShown=!1},onClickPopupCTA:function(popup,e){var url=e.currentTarget.querySelector(".js-popup-cta-link").getAttribute("data-url"),idPopup=popup.attr("id");PMW.gtm.trackGA4EventForClickedPopupCta(idPopup),PMW.marketing.hidePopup(popup),popup.attr("data-id-popup")&&PMW.marketing.recordInteraction(popup.attr("data-id-popup"),PMW.marketing.INTERACTION_TYPE_POSITIVE),PMW.marketing.setExpiryCookie(idPopup,PMW.marketing.POPUP_EXPIRY_TYPE_CLOSE),url&&"javascript:void(0);"!==url&&window.open(url,"_blank")},recordInteraction:function(idPopup,isPositive){PMW.write(PMW.util.site_url("marketing/popups/recordInteraction"),{id:idPopup,urlPath:this.getCurrentPagePath(),isPositive:isPositive})},setBlockMarketingPopupsCookie:function(popUpId){let popup=$("#"+popUpId);void 0!==popup.attr("data-block-marketing-popups")&&PMW.util.setCookie(this.MARKETING_POPUP_BLOCKED_COOKIE,"1",1)},setExpiryCookie:function(popUpId,expiryType){let popup=$("#"+popUpId),expiryInSeconds=popup.attr(this.getCookieExpiryDataAttributeName(expiryType));var expiryInDays;void 0!==expiryInSeconds&&(expiryInDays=this.getCookieExpiryInDays(expiryInSeconds),PMW.util.setCookie(popUpId,"1",expiryInDays))},showBanner:function(dateStr,url,textContent){if(new Date(dateStr)>new Date){let ptb=$(".page-top-bar");0<ptb.length&&(ptb.addClass("-no-border"),ptb.after('<a href="'+url+'" target="_blank" class="base-banner">'+textContent+"</a>"))}},showPopup:function(viewURI,popUpId){PMW.isMobileOS()||(void 0!==popUpId&&PMW.getCacheItem(popUpId)?PMW.marketing.renderPopUp(popUpId,PMW.getCacheItem(popUpId)):PMW.getRequest(viewURI,{urlPath:this.getCurrentPagePath()}).done((function(popUpId,r){var html;"success"===r.status&&r.data&&r.data.html&&(html=r.data.html,void 0!==popUpId?PMW.setCacheItem(popUpId,html):r.data.popUpId&&(popUpId=r.data.popUpId),PMW.marketing.renderPopUp(popUpId,html))}).bind(this,popUpId)))},renderPopUp:function(popUpId,html){void 0!==popUpId&&void 0!==html&&""!==popUpId&&""!==html&&this.canPopupBeShown(popUpId)&&(0===$("#"+popUpId).length&&$("body").append(html),this.initPopup(popUpId),this.isPopupBeingShown=!0)}}});
PMW.mergePMW(PMW.util,{getEmbeddedURLSegment:function(){var embeddedURLSegment="",embeddedParamsObj=window.location.href,embeddedParamsObj=this.getEmbeddedParamsFromURL(embeddedParamsObj);return 1===parseInt(embeddedParamsObj.isEmbedded)&&(embeddedURLSegment+="&lg=1&wid="+embeddedParamsObj.customWidth+"&hig="+embeddedParamsObj.customHeight+"&un="+embeddedParamsObj.customUnits+"&he="+embeddedParamsObj.elementsToHide),embeddedURLSegment},appendEmbeddedParamsToURLs:function(embeddedDataSelector){var embeddedParams,newHref,anchorTags=$("body.-embedded").find("a"),currentURL=window.location.href;null!==embeddedDataSelector&&0<embeddedDataSelector.length&&(anchorTags=embeddedDataSelector.find("a")),void 0!==currentURL&&0<currentURL.length&&(embeddedParams=this.getEmbeddedParamsFromURL(currentURL),1<Object.keys(embeddedParams).length&&(anchorTags.each(function(){var href=$(this).attr("href");void 0!==href&&""!==href&&null!==embeddedParams.isEmbedded&&(href+=(href.includes("?")?"&":"?")+"lg="+embeddedParams.isEmbedded,null!==embeddedParams.customWidth&&null!==embeddedParams.customHeight&&(href+="&wid="+embeddedParams.customWidth+"&hig="+embeddedParams.customHeight+"&un="+embeddedParams.customUnits),null!==embeddedParams.elementsToHide&&(href+="&he="+embeddedParams.elementsToHide),void 0!==(newHref=href)&&""!==newHref&&$(this).attr("href",newHref))}),this.addEmbeddedParamsInputTagsToSearches(embeddedParams)))},getEmbeddedParamsFromURL:function(embeddedURL){var url=new URL(embeddedURL),embeddedParams={};if(void 0!==url)for(var key in embeddedParams.lg=url.searchParams.get("lg"),embeddedParams.wid=url.searchParams.get("wid"),embeddedParams.hig=url.searchParams.get("hig"),embeddedParams.un=url.searchParams.get("un"),embeddedParams.he=url.searchParams.get("he"),embeddedParams)null!==embeddedParams[key]&&-1<embeddedParams[key].indexOf("#")&&(embeddedParams[key]=embeddedParams[key].substring(0,embeddedParams[key].indexOf("#")));return new EmbeddedParams(embeddedParams.lg,embeddedParams.wid,embeddedParams.hig,embeddedParams.un,embeddedParams.he)},addEmbeddedParamsInputTagsToSearches:function(embeddedParams){$(".js-form-search-form").each(function(){null!==embeddedParams.isEmbedded&&(this.innerHTML+='<input type="hidden" name="lg" value="'+embeddedParams.isEmbedded+'">',null!==embeddedParams.customWidth&&null!==embeddedParams.customHeight&&(this.innerHTML+='<input type="hidden" name="wid" value="'+embeddedParams.customWidth+'">',this.innerHTML+='<input type="hidden" name="hig" value="'+embeddedParams.customHeight+'">',this.innerHTML+='<input type="hidden" name="un" value="'+embeddedParams.customUnits+'">'),null!==embeddedParams.elementsToHide&&(this.innerHTML+='<input type="hidden" name="he" value="'+embeddedParams.elementsToHide+'">'))})},getEmbeddedURLSegmentWhenPosterLoadFails:function(currentURL){var wid,hig,un,he=new URL(currentURL),urlPaths=he.pathname.split("/"),embeddedURLSegment="",isEmbedded=he.searchParams.get("lg"),he=he.searchParams.get("he");return 1===parseInt(isEmbedded)&&(embeddedURLSegment="?lg=1",9<Object.keys(urlPaths).length&&(wid=urlPaths[7],hig=urlPaths[8],un=urlPaths[9]),void 0!==wid&&void 0!==hig&&void 0!==un&&(embeddedURLSegment+="&wid="+wid+"&hig="+hig+"&un="+un),null!==he&&(embeddedURLSegment+="&he="+he)),embeddedURLSegment}});
PMW.mergePMW(PMW.util,{isInGalleryDialog:function(){return window.location!==window.parent.location&&this.isGalleryDialogOpenInSameOrigin()},isGalleryDialogOpenInSameOrigin:function(){try{return null!==window.parent.document.getElementById("galleryDialogContainer")}catch{return!1}},getGalleryDialogUrlSegment:function(){if(!0===this.isInGalleryDialog())return"&gd=1"},initGalleryTopBarToggleMobile:function(el){if(PMW.isMobileScreenWidth()){let topBar=$(el).find(".gallery-dialog-top-bar");el[0].getBoundingClientRect().y<0?topBar.addClass("-sticky-top-bar"):topBar.removeClass("-sticky-top-bar")}},toggleGalleryPageComponentsForGallery:function(page){PMW.util.toggleAllTemplatesGalleryDropdown(page),PMW.util.toggleTopPageSearch(),PMW.util.togglePageTopbar(),PMW.util.isInGalleryDialog()&&($(".flyoutcontainer").addClass("hidden"),$(".carousel-nav").addClass("_hidden"),window.addEventListener("scroll",PMW.debounce(PMW.util.initGalleryTopBarToggleMobile.bind(this,page),{passive:!0})))},togglePageTopbar:function(){const pageTopBar=$(".page-top-bar"),isGalleryDialog=PMW.util.isInGalleryDialog();pageTopBar.toggleClass("-in-gallery-dialog",isGalleryDialog),$("header").toggleClass("hidden",isGalleryDialog),pageTopBar.find(".js-gallery-dialog-mobile-dropdown").toggleClass("darksecondary",!isGalleryDialog).toggleClass("secondary",isGalleryDialog),pageTopBar.removeClass("hidden")},togglePageFooter:function(){$("#footer-primary-section").toggleClass("hidden",PMW.util.isInGalleryDialog())},toggleEmailGallerySearchBar:function(){const topSearchBar=$(".js-search-form");topSearchBar.toggleClass("hidden",!PMW.util.shouldShowGallerySearchBar(topSearchBar)),topSearchBar.toggleClass("spacing-p-t-4",PMW.util.shouldShowGallerySearchBar(topSearchBar))},shouldShowGallerySearchBar:function(searchBar){return PMW.util.isInGalleryDialog()&&0<searchBar.length},toggleAllTemplatesGalleryDropdown:function(templates){let dropdown=templates.find(".js-top-bar-dropdown");PMW.util.isInGalleryDialog()?(dropdown.addClass("dropdown-gallery-dialog-top-bar body-s-bold"),dropdown.find(".js-top-bar-dropdown-option").addClass("body-xs"),dropdown.find(".js-gallery-dialog-dropdown-options").removeClass("hidden"),dropdown.find(".js-main-gallery-dropdown-options").addClass("hidden"),dropdown.removeClass("hidden-phone")):(dropdown.find(".js-gallery-dialog-dropdown-options").addClass("hidden"),dropdown.find(".js-main-gallery-dropdown-options").removeClass("hidden"))},setGalleryDropdownToFullWidth:function(dropdown){PMW.util.isInGalleryDialog()&&dropdown.addClass("-full-width-mobile")},togglePopularSizesContainer:function(page){let popularSizes=page.find(".js-popular-sizes-container");if(PMW.util.isInGalleryDialog()){popularSizes.addClass("-secondary-colors -in-gallery-dialog"),popularSizes.removeClass("mobile-hidden");var popularPosterTypes=popularSizes.find(".js-poster-thumbnail");for(let i=2;i<popularPosterTypes.length;i++)$(popularPosterTypes[i]).addClass("-in-gallery-dialog")}else popularSizes.addClass("mobile-hidden")},toggleTopPageSearch:function(){let topPageSearch=$(".js-page-top-search");PMW.util.isInGalleryDialog()&&(topPageSearch.addClass("search-bar-container"),topPageSearch.find(".js-page-top-search-field").addClass("search-bar-container"))}});
function initEmojiElements(){window.emojiPicker=new EmojiPicker({emojiable_selector:"[data-emojiable=true]",assetsPath:PMW.util.asset_url("images/emoji_picker/"),popupButtonClasses:"icon icon-sentiment-very-satisfied emoji-selector-icon blockable"}),window.emojiPicker.discover=function(){return $(this.options.emojiable_selector).emojiarea($.extend({emojiPopup:this,norealTime:!0},this.options))},_attachMutationObserver($("[data-emojiable=true]").parent()),window.emojiPicker.discover()}function _attachMutationObserver(emojiParentDiv){const observer=new MutationObserver(function(mutations_list){mutations_list.forEach(function(mutation){mutation.addedNodes.forEach(function(addedNode){_updatePlaceholder(observer,$(addedNode))})})});emojiParentDiv.each(function(_,val){observer.observe(val,{attributes:!0,subtree:!1,childList:!0})})}function _updatePlaceholder(observer,addedElement){if(addedElement.hasClass("emoji-wysiwyg-editor")){let placeholder=addedElement.attr("placeholder");addedElement.mousedown(function(){addedElement.attr("placeholder",""),addedElement.focus()}),addedElement.blur(function(){addedElement.attr("placeholder",placeholder)}),observer.disconnect()}}PMW.mergePMW(PMW.util,{loadEmojiSources:function(){"undefined"==typeof EmojiPicker?PMW.getJsAndCssAssetGroup("emojisLib",function(){initEmojiElements()}):initEmojiElements()}});
PMW.mergePMW(PMW.util,{initSmoothScroll:function(){$('a[href^="#"]').bind("click.smoothscroll",function(e){e.preventDefault(),PMW.util.smoothScrollTo(this.hash)})},smoothScrollTo:function(target,cb,offset=0){var $target="string"==typeof target?$(target):target;$("html, body").stop().animate({scrollTop:$target.offset().top-offset},1e3,"swing",function(){"string"==typeof target&&(window.location.hash=target),$.isFunction(cb)&&cb()})}});
