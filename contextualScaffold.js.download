"use strict";(()=>{var oe=Object.create;var T=Object.defineProperty;var ne=Object.getOwnPropertyDescriptor;var se=Object.getOwnPropertyNames,S=Object.getOwnPropertySymbols,le=Object.getPrototypeOf,M=Object.prototype.hasOwnProperty,ae=Object.prototype.propertyIsEnumerable;var F=(e,t,r)=>t in e?T(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,I=(e,t)=>{for(var r in t||={})M.call(t,r)&&F(e,r,t[r]);if(S)for(var r of S(t))ae.call(t,r)&&F(e,r,t[r]);return e};var de=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports);var ue=(e,t,r,i)=>{if(t&&typeof t=="object"||typeof t=="function")for(let o of se(t))!M.call(e,o)&&o!==r&&T(e,o,{get:()=>t[o],enumerable:!(i=ne(t,o))||i.enumerable});return e};var ce=(e,t,r)=>(r=e!=null?oe(le(e)):{},ue(t||!e||!e.__esModule?T(r,"default",{value:e,enumerable:!0}):r,e));var Y=de((lt,J)=>{"use strict";var L=Object.defineProperty,he=Object.defineProperties,pe=Object.getOwnPropertyDescriptor,ge=Object.getOwnPropertyDescriptors,me=Object.getOwnPropertyNames,b=Object.getOwnPropertySymbols,C=Object.prototype.hasOwnProperty,B=Object.prototype.propertyIsEnumerable,D=(e,t,r)=>t in e?L(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,f=(e,t)=>{for(var r in t||={})C.call(t,r)&&D(e,r,t[r]);if(b)for(var r of b(t))B.call(t,r)&&D(e,r,t[r]);return e},x=(e,t)=>he(e,ge(t)),ve=(e,t)=>{var r={};for(var i in e)C.call(e,i)&&t.indexOf(i)<0&&(r[i]=e[i]);if(e!=null&&b)for(var i of b(e))t.indexOf(i)<0&&B.call(e,i)&&(r[i]=e[i]);return r},fe=(e,t)=>{for(var r in t)L(e,r,{get:t[r],enumerable:!0})},ye=(e,t,r,i)=>{if(t&&typeof t=="object"||typeof t=="function")for(let o of me(t))!C.call(e,o)&&o!==r&&L(e,o,{get:()=>t[o],enumerable:!(i=pe(t,o))||i.enumerable});return e},we=e=>ye(L({},"__esModule",{value:!0}),e),p=(e,t,r)=>new Promise((i,o)=>{var n=a=>{try{l(r.next(a))}catch(u){o(u)}},s=a=>{try{l(r.throw(a))}catch(u){o(u)}},l=a=>a.done?i(a.value):Promise.resolve(a.value).then(n,s);l((r=r.apply(e,t)).next())}),N={};fe(N,{createContextualWidget:()=>rt});J.exports=we(N);var q=e=>{var t,r,i,o;if(!e.amplitude)return{userId:null,deviceId:null};let n=e.amplitude.getInstance();return{userId:(r=(t=n?.options)==null?void 0:t.userId)!=null?r:null,deviceId:(o=(i=n?.options)==null?void 0:i.deviceId)!=null?o:null}},We=500,Ue=5,E=null,Ie=(e,t)=>{let{delay:r=We,times:i=Ue}=t||{},o=0;return n=>{n.cohortUserId||(E&&e.removeEventListener("load",E),E=()=>{let s=setInterval(()=>{o+=1;let{userId:l}=q(e);if(l){n.identifyUser({cohortUserId:l}),clearInterval(s);return}o>=i&&clearInterval(s)},r)},e.addEventListener("load",E))}},Ee={apiKey:"",snippetCdnUrl:"https://snippet.maze.co",apiUrl:"https://prompts.maze.co/api/widgets",testingPagesUrl:"https://t.maze.co"},Re=480,be=e=>f(f({},Ee),e.mazeContextualSettings||{}),G=e=>(t,r={})=>{let i=e.createElement("script");return i.src=t,i.async=r.async||!1,i.defer=r.defer||!1,i.id=r.id||"",e.getElementsByTagName("head")[0].appendChild(i),i},Ae="https://snippet.maze.co",Le="maze-widget-app-script",Pe=(e,t,r={})=>{let{snippetCdnUrl:i=Ae}=r,o=Le;if(e.getElementById(o))return e.getElementById(o);let n=`${i}/contextualWidgetAppScaffold.js`;return G(e)(n,{id:o,async:!0})},Te="__contextual-widget__",xe=({type:e,action:t,payload:r,channel:i})=>({type:e,action:t,payload:r,channel:i}),z=e=>`${Te}${e}`,Ce=(e,t={})=>{let{id:r="PROMPT"}=t,i=[];return{send:o=>{let n=xe(f({channel:z(r)},o));e.postMessage(n,"*")},listen:o=>{let n=l=>{let{data:a}=l,u=a,{channel:v}=u,g=ve(u,["channel"]);v===z(r)&&o(g)};e.addEventListener("message",n);let s=()=>{e.removeEventListener("message",n)};i.push(s)},close:()=>{i.forEach(o=>{o()}),i=[]}}},Se=(e,t)=>{let r=e.location.href;return i=>{let o=t.body||t,{location:n}=e;function s(){n.href!==r&&(r=n.href,i(n.href))}let l=new MutationObserver(s);o&&l.observe(o,{subtree:!0,childList:!0})}};function Fe({apiUrl:e,apiKey:t}){return function(r){return fetch(e,{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json","x-api-key":t,"x-maze-snippet-src":"contextual-widget"},body:JSON.stringify(r)}).then(i=>{if(i.ok)return i.json();throw new Error("Network response was not ok.")})}}var Me=({apiUrl:e,apiKey:t})=>{let r=Fe({apiUrl:e,apiKey:t});return{getWidgetsForVisitor:i=>p(void 0,[i],function*({cohortProvider:o,cohortUserId:n}){try{return yield r({cohortProvider:o,cohortUserId:n})}catch(s){return console.error("Error fetching contextual prompts.",s.message),[]}})}},K=class{constructor(e){this.cacheClearTimeouts={},this.cachedItems=new Set,this.storage=e}getValue(e){let t=this.storage.getItem(e);if(!t)return null;let r=JSON.parse(t);return this.isValueExpired(r)?(this.removeValue(e),null):r.value}setValue(e,t,r=0){let i={value:t,expiresIn:r>0?Date.now()+r*60*1e3:0};this.storage.setItem(e,JSON.stringify(i)),this.cachedItems.add(e),this.cacheClearTimeouts[e]&&clearTimeout(this.cacheClearTimeouts[e]),r>0&&(this.cacheClearTimeouts[e]=setTimeout(()=>{this.removeValue(e)},r*60*1e3))}removeValue(e){this.storage.removeItem(e),this.cachedItems.delete(e),this.cacheClearTimeouts[e]&&(clearTimeout(this.cacheClearTimeouts[e]),delete this.cacheClearTimeouts[e])}clearAll(){this.cachedItems.forEach(e=>{this.removeValue(e)})}isValueExpired(e){return e.expiresIn>0&&e.expiresIn<Date.now()}},k=class{constructor(e=!1){this.supportsExipresIn=e,this.cacheClearTimeouts={},this.storage={}}getValue(e){return this.storage[e]||null}setValue(e,t,r=0){this.storage[e]=t,this.cacheClearTimeouts[e]&&clearTimeout(this.cacheClearTimeouts[e]),r>0&&this.supportsExipresIn&&(this.cacheClearTimeouts[e]=setTimeout(()=>{this.removeValue(e)},r*60*1e3))}removeValue(e){delete this.storage[e],this.cacheClearTimeouts[e]&&(clearTimeout(this.cacheClearTimeouts[e]),delete this.cacheClearTimeouts[e])}clearAll(){Object.keys(this.storage).forEach(e=>{this.removeValue(e)})}},De=typeof window<"u"&&window.localStorage?new K(window.localStorage):new k,O=e=>De.getValue(e)||[],ze=()=>{let e=O("maze-contextual-widget-dismissed"),t=O("maze-contextual-widget-started");return[...e,...t]},Oe=(e,t)=>{var r,i,o,n;let s="maze-contextual-widget-fonts";if((i=(r=t.contentWindow)==null?void 0:r.document)!=null&&i.querySelector(`link#${s}`))return;let l=e.createElement("link");l.href="https://assets-cdn.maze.co/fonts/roobert-pro.css",l.rel="stylesheet",l.type="text/css",l.id=s,(n=(o=t?.contentWindow)==null?void 0:o.document)==null||n.head.appendChild(l)},R=e=>`${e}px`;function Ve(e,{id:t}){return e.querySelector(`#${t}`)}function _e(e,{id:t,tag:r}){let i=Ve(e,{id:t});if(i)return i;let o=e.createElement(r);return o.id=t,e.body.appendChild(o),o}var Z=({id:e,_document:t=document})=>t.querySelector(`#${e}`),He=(e,t,{id:r,className:i})=>{var o;let n=Z({_document:(o=t.contentWindow)==null?void 0:o.document,id:r});return n||(n=e.createElement("div"),n.id=r),n.classList.contains(i)||n.classList.add(i),n.style.cssText=`
    width: 100%;
    height: 100%;
    position:relative;
  `,n},$e=(e,t)=>({id:r})=>{var i,o,n;let s=`${r}-host`,l=`${r}-container`,a=_e(t,{id:s,tag:"iframe"}),u=He(t,a,{id:l,className:l});return(n=(o=(i=a.contentWindow)==null?void 0:i.document)==null?void 0:o.body)==null||n.appendChild(u),a.addEventListener("load",()=>{var v,g,y,c;Z({_document:(v=a.contentWindow)==null?void 0:v.document,id:l})||(c=(y=(g=a.contentWindow)==null?void 0:g.document)==null?void 0:y.body)==null||c.appendChild(u)}),{host:a,container:u}},je={promptHostElement:{self:{default:2147483647},children:{contextualWidgetBranding:{self:{default:10}}}},mediaHostElement:{self:{hidden:0,shown:2147483647},children:{imageZoomControlButtons:{self:{default:10}}}}},Be="maze-contextual-widget",V=80,_={compact:{height:R(430),width:R(420+V)},expanded:{height:R(680),width:R(420+V)}},Ne=`
  height: ${_.compact.height};
  width: ${_.compact.width};
  max-width: 100%;
  position: fixed;
  border: none;
  overflow: hidden;
  z-index: ${je.promptHostElement.self.default};
  color-scheme: normal;
`,H={BOTTOM_LEFT:{left:"0",bottom:"0",transform:"initial",right:"initial",top:"initial"},BOTTOM_RIGHT:{right:"0",bottom:"0",transform:"initial",left:"initial",top:"initial"},MIDDLE_LEFT:{left:"0",top:"50%",transform:"translateY(-50%)",right:" initial",bottom:"initial"},MIDDLE_RIGHT:{right:"0",top:"50%",transform:"translateY(-50%)",left:"initial",bottom:"initial"}},qe={left:"0",right:"0",bottom:"0",top:"initial",transform:"initial"},$=e=>Object.entries(e).reduce((t,[r,i])=>`${t}${r}:${i};
`,""),Ge=e=>{if(e.hostMaxWidth<Re)return $(qe);let t=H[e.position]||H.BOTTOM_RIGHT;return $(t)},Ke=(e,{position:t,hostMaxWidth:r})=>(e.style.cssText=Ne+Ge({position:t,hostMaxWidth:r}),e),ke=(e,t)=>({position:r})=>{let{host:i,container:o}=$e(window,document)({id:Be});return Ke(i,{position:r,hostMaxWidth:window.outerWidth}),Oe(t,i),{host:i,container:o}};function Ze(e,t,r){return function(i){let{container:o,host:n}=ke(e,t)({position:i?.styles.position||"BOTTOM_RIGHT"});if(!o)throw new Error("Cannot mount app");return r?r({host:n,container:o},i):(console.warn("mountApp is not defined"),null)}}var j={[0]:void 0,[1]:"color: cyan",[3]:void 0,[5]:"color: yellow",[9]:"color: red"};function Je(e){try{if(!(e!=null&&e.localStorage))return;let t=e.localStorage.getItem("maze-log-level");return t?parseInt(t,10):void 0}catch{return}}var A=class{static initializeLoggerMode(e){var t;e&&(A._window=e,e.MAZE_LOG_LEVEL=(t=Je(e))!=null?t:5)}getCurrentLogLevel(){var e,t;return(t=(e=A._window)==null?void 0:e.MAZE_LOG_LEVEL)!=null?t:5}verbose(e,t){this.logEvent(e,1,t)}info(e,t){this.logEvent(e,3,t)}warning(e,t){this.logEvent(e,5,t)}error(e,t){this.logEvent(e,9,t)}logEvent(e,t=3,r){let i=this.getCurrentLogLevel();t>=i&&(r===void 0?console.log(`%c maze-snippet: ${e}`,j[t]):console.log(`%c maze-snippet: ${e}`,j[t],r))}},d=new A,Ye=class{constructor(e,t){this.config=e,this.cacheManager=t,this.unmountWidgetApp=null,this.widgetApp=null,this.identifyUser=r=>{var i,o;return r.cohortUserId?(this.cohortUserId=r.cohortUserId,this.cohortProvider="AMPLITUDE",this.hasIdentifiedUser()&&(this.clearWidgetsForDomain(),(o=(i=this.config).onUserIdentified)==null||o.call(i,{cohortUserId:this.cohortUserId})),!0):!1},this.registerWidgetApp=r=>{this.widgetApp=r},this.deregisterWidgetApp=()=>{this.unMountApp(),this.widgetApp=null},this.renderWidget=(r,i,...o)=>p(this,[r,i,...o],function*(n,s,{forceRequest:l}={}){var a,u;let{shouldRender:v,widgetsForRoute:g,widgetsForDomain:y}=yield this.shouldRenderWidget({forceRequest:l});if(d.verbose("[renderWidget] shouldRenderWidget",{shouldRender:v,widgetsForRoute:g,widgetsForDomain:y,widgetApp:this.widgetApp}),this.widgetApp||(yield(u=(a=this.config).onShouldRegisterWidgetApp)==null?void 0:u.call(a,{widgets:y,filteredWidgets:g})),!v){this.unMountApp();return}let[c]=g;if(this.unMountApp(),!this.widgetApp)return;let P=yield this.executeGetVariablesFromRouteLazy({url:this.url,paths:c.paths});this.unmountWidgetApp=Ze(n,s,this.widgetApp)(x(f({},c),{testingPagesUrl:this.config.testingPagesUrl,cohortUserId:this.cohortUserId,cohortProvider:this.cohortProvider,routeVariables:P,apiKey:this.config.apiKey}))}),this.setUrl=r=>{this.url=r},this.hasIdentifiedUser=()=>!!this.cohortUserId,this.clearWidgetsForDomain=()=>{this.widgetsForDomain=null},this.getWidgetsForDomain=()=>p(this,null,function*(){return d.verbose("[getWidgetsForDomain] START",{currentWidgetsForDomain:this.widgetsForDomain}),this.widgetsForDomain?(d.verbose("[getWidgetsForDomain] returned widgets from cache"),this.widgetsForDomain):(this.widgetsForDomain=yield this.mazeApi.getWidgetsForVisitor({cohortProvider:this.cohortProvider,cohortUserId:this.cohortUserId}),d.verbose("[getWidgetsForDomain] API result",{widgetsForDomain:this.widgetsForDomain}),this.widgetsForDomain)}),this.getWidgetsToRender=(...r)=>p(this,[...r],function*({forceRequest:i}={}){i&&this.clearWidgetsForDomain();let o=yield this.getWidgetsForDomain(),n=ze();return o.filter(s=>!n.includes(s.uuid))}),this.filterWidgetsForRoute=r=>p(this,null,function*(){let i=r.map(o=>p(this,null,function*(){let{paths:n=[]}=o;return n.length===0||(yield this.executePathMatchesPatternLazy({url:this.url,paths:n}))?o:null}));return(yield Promise.all(i)).filter(Boolean)}),this.shouldRenderWidget=(...r)=>p(this,[...r],function*({forceRequest:i}={}){let o=yield this.getWidgetsToRender({forceRequest:i});if(d.verbose("[shouldRenderWidget] filteredWidgetsForDomain",{filteredWidgetsForDomain:o,forceRequest:i}),!o.length)return{shouldRender:!1,widgetsForRoute:o,widgetsForDomain:o};let n=yield this.filterWidgetsForRoute(o);return{shouldRender:!!n.length,widgetsForRoute:n,widgetsForDomain:o}}),this.unMountApp=()=>{this.unmountWidgetApp&&(this.unmountWidgetApp(),this.unmountWidgetApp=null)},this.initHelpers=()=>p(this,null,function*(){var r,i;this.helpersLoadPromise&&(yield this.helpersLoadPromise),!this.helpers&&(this.helpersLoadPromise=(i=(r=this.config).onLoadWidgetHelper)==null?void 0:i.call(r),this.helpers=yield this.helpersLoadPromise,d.verbose("[initHelpers] helpers",{helpers:this.helpers}))}),this.cohortUserId=e.cohortUserId,this.cohortProvider=e.cohortProvider,this.url=e.url,this.mazeApi=Me({apiUrl:e.apiUrl,apiKey:e.apiKey})}get widgetsForDomain(){return this.cacheManager.getValue("maze:widgets")}set widgetsForDomain(e){try{this.cacheManager.setValue("maze:widgets",e,15),d.verbose("[set widgetsForDomain] cached widgets",{value:e})}catch(t){d.error("[set widgetsForDomain] error while saving to cache",{error:t,value:e})}}executeGetVariablesFromRouteLazy(e){return p(this,arguments,function*({url:t,paths:r}){var i;return this.helpers||(yield this.initHelpers()),(i=this.helpers)!=null&&i.getVariablesFromRoute?this.helpers.getVariablesFromRoute({url:t,paths:r}):(d.error("[executeGetVariablesFromRouteLazy] helpers not initialized"),{})})}executePathMatchesPatternLazy(e){return p(this,arguments,function*({url:t,paths:r}){var i;return this.helpers||(yield this.initHelpers()),(i=this.helpers)!=null&&i.pathMatchesPattern?this.helpers.pathMatchesPattern({url:t,paths:r}):(d.error("[executePathMatchesPatternLazy] helpers not initialized"),!1)})}},Qe="https://snippet.maze.co",Xe="maze-scaffold-helper-script",et=(e,t,...r)=>p(void 0,[e,t,...r],function*(i,o,n={}){return new Promise((s,l)=>{let{snippetCdnUrl:a=Qe}=n,u=Xe;if(i.getElementById(u)){s(i.getElementById(u));return}let v=`${a}/contextualScaffoldHelpers.js`,g=G(i)(v,{id:u,async:!0});g.addEventListener("load",s),g.addEventListener("error",l)})}),tt=(e,t)=>{let r=be(e),i=f(f({},r),t||{}),{userId:o}=q(e);return!i.cohortUserId&&o&&(i.cohortUserId=o,i.cohortProvider="AMPLITUDE"),i};function rt(e,t){let r=Ce(e),i=typeof e<"u"&&e.sessionStorage?new K(e.sessionStorage):new k;A.initializeLoggerMode(e);let o=window.location.href;return function(n){let s=tt(e,n),l=Ie(e),a=!1,u=h=>{c.setUrl(h),c.renderWidget(e,t).catch(m=>{d.error("[handleRouteChange] renderWidget",{error:m})})},v=({widgets:h,filteredWidgets:m})=>new Promise(W=>{if(d.verbose("[onShouldRegisterWidgetApp] START",{attachedRouteChangeListener:a,widgetsForDomain:h,widgetsForPath:m}),h!=null&&h.length&&!a){a=!0;let ie=Se(e,t);e.addEventListener("hashchange",U=>{d.verbose("[onShouldRegisterWidgetApp] hashChange event",{url:U.newURL}),u(U.newURL)}),ie(U=>{d.verbose("[onShouldRegisterWidgetApp] onRouteChange",{url:U}),u(U)})}if(!m||m.length===0){W(!1);return}d.verbose("[onShouldRegisterWidgetApp] loadWidgetAppScript",{snippetCdnUrl:s.snippetCdnUrl});let w=Pe(t,e,{snippetCdnUrl:s.snippetCdnUrl});w.onload=()=>{d.verbose("[onShouldRegisterWidgetApp] loadWidgetAppScript onLoad event"),W(!0)}}),g=()=>p(this,null,function*(){return d.verbose("[onLoadWidgetHelper] load helper script",{snippetCdnUrl:s.snippetCdnUrl}),yield et(t,e,{snippetCdnUrl:s.snippetCdnUrl}),e.mazeHelpers});r.listen(({type:h})=>{if(h==="registerWidgetApp"){d.verbose("[onWidgetEvent] registerWidgetApp",{type:h}),c.renderWidget(e,t).catch(m=>{d.error("[onWidgetEvent] renderWidget",{type:h,error:m})});return}h==="deregisterWidgetApp"&&(d.verbose("[onWidgetEvent] deregisterWidgetApp",{type:h}),c.deregisterWidgetApp())});let y=()=>p(this,null,function*(){yield c.renderWidget(e,t)}),c=new Ye(x(f({},s),{communicate:r,onShouldRegisterWidgetApp:v,onLoadWidgetHelper:g,onUserIdentified:y,url:o}),i);l(c),e.addEventListener("load",()=>p(this,null,function*(){d.verbose("[window] onLoad"),yield c.renderWidget(e,t)}));let P=({forceRequest:h=!1,forRoute:m}={})=>{if(d.verbose("[render] START",{forceRequest:h,forRoute:m}),m){let W=new URL(e.location.href).origin;try{let w=new URL(W+m);d.verbose("[render] set new URL",{newUrl:w}),c.setUrl(w.href)}catch(w){d.error("[render] Invalid URL",{baseUrl:W,forRoute:m,error:w});return}}c.renderWidget(e,t,{forceRequest:h})};return x(f({},c),{render:P})}}});var Q=ce(Y());var X=(e,t)=>{let r=(e==null?void 0:e.mazeUniversalSnippetApiKey)||"",i=I({},(e==null?void 0:e.mazePromptsSettings)||{apiKey:r});return(o={})=>{!i.apiKey&&r&&(i.apiKey=r),e.mazePrompts=(0,Q.createContextualWidget)(e,t)(I(I({},i),o))}};var it=(e,t)=>e&&t?`${e}/static/${t}`:"",ot="d8601ae",ee=it("https://snippet.maze.co",ot);var te="https://prompts.maze.co/api/widgets",re="https://t.maze.co";var nt={apiUrl:te,testingPagesUrl:re,snippetCdnUrl:ee};X(window,document)(nt);})();
